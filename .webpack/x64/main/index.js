(()=>{var t={11:(t,e,n)=>{"use strict";var r=n(744);t.exports=function(t){t.addOutput=t.output=function(t,e){var n=!1;if(!t&&this._currentOutput)throw new Error("Invalid output");if(t&&"string"!=typeof t){if(!("writable"in t)||!t.writable)throw new Error("Invalid output")}else if("string"==typeof t){var o=t.match(/^([a-z]{2,}):/i);n=!o||"file"===o[0]}if(t&&!("target"in this._currentOutput))this._currentOutput.target=t,this._currentOutput.isFile=n,this._currentOutput.pipeopts=e||{};else{if(t&&"string"!=typeof t&&this._outputs.some(function(t){return"string"!=typeof t.target}))throw new Error("Only one output stream is supported");this._outputs.push(this._currentOutput={target:t,isFile:n,flags:{},pipeopts:e||{}});var i=this;["audio","audioFilters","video","videoFilters","sizeFilters","options"].forEach(function(t){i._currentOutput[t]=r.args()}),t||delete this._currentOutput.target}return this},t.seekOutput=t.seek=function(t){return this._currentOutput.options("-ss",t),this},t.withDuration=t.setDuration=t.duration=function(t){return this._currentOutput.options("-t",t),this},t.toFormat=t.withOutputFormat=t.outputFormat=t.format=function(t){return this._currentOutput.options("-f",t),this},t.map=function(t){return this._currentOutput.options("-map",t.replace(r.streamRegexp,"[$1]")),this},t.updateFlvMetadata=t.flvmeta=function(){return this._currentOutput.flags.flvmeta=!0,this}}},18:t=>{"use strict";t.exports=require("tty")},23:t=>{"use strict";t.exports=require("util")},24:t=>{"use strict";t.exports=require("node:fs")},63:(t,e,n)=>{"undefined"!=typeof process&&"renderer"===process.type?t.exports=n(491):t.exports=n(487)},85:(t,e,n)=>{t.exports=n(89)},89:(t,e,n)=>{"use strict";n(928);var r=n(23),o=n(434).EventEmitter,i=n(744);function s(t,e){if(!(this instanceof s))return new s(t,e);o.call(this),"object"!=typeof t||"readable"in t?(e=e||{}).source=t:e=t,this._inputs=[],e.source&&this.input(e.source),this._outputs=[],this.output();var r=this;["_global","_complexFilters"].forEach(function(t){r[t]=i.args()}),e.stdoutLines="stdoutLines"in e?e.stdoutLines:100,e.presets=e.presets||e.preset||n.ab+"presets",e.niceness=e.niceness||e.priority||0,this.options=e,this.logger=e.logger||{debug:function(){},info:function(){},warn:function(){},error:function(){}}}r.inherits(s,o),t.exports=s,s.prototype.clone=function(){var t=new s,e=this;return t.options=this.options,t.logger=this.logger,t._inputs=this._inputs.map(function(t){return{source:t.source,options:t.options.clone()}}),"target"in this._outputs[0]?(t._outputs=[],t.output()):(t._outputs=[t._currentOutput={flags:{}}],["audio","audioFilters","video","videoFilters","sizeFilters","options"].forEach(function(n){t._currentOutput[n]=e._currentOutput[n].clone()}),this._currentOutput.sizeData&&(t._currentOutput.sizeData={},i.copy(this._currentOutput.sizeData,t._currentOutput.sizeData)),i.copy(this._currentOutput.flags,t._currentOutput.flags)),["_global","_complexFilters"].forEach(function(n){t[n]=e[n].clone()}),t},n(751)(s.prototype),n(986)(s.prototype),n(619)(s.prototype),n(430)(s.prototype),n(11)(s.prototype),n(257)(s.prototype),n(770)(s.prototype),n(749)(s.prototype),n(711)(s.prototype),s.setFfmpegPath=function(t){(new s).setFfmpegPath(t)},s.setFfprobePath=function(t){(new s).setFfprobePath(t)},s.setFlvtoolPath=function(t){(new s).setFlvtoolPath(t)},s.availableFilters=s.getAvailableFilters=function(t){(new s).availableFilters(t)},s.availableCodecs=s.getAvailableCodecs=function(t){(new s).availableCodecs(t)},s.availableFormats=s.getAvailableFormats=function(t){(new s).availableFormats(t)},s.availableEncoders=s.getAvailableEncoders=function(t){(new s).availableEncoders(t)},n(627)(s.prototype),s.ffprobe=function(t){var e=new s(t);e.ffprobe.apply(e,Array.prototype.slice.call(arguments,1))},n(982)(s.prototype)},157:t=>{"use strict";t.exports=require("electron")},203:t=>{"use strict";t.exports=require("stream")},257:(t,e,n)=>{"use strict";var r=n(744);t.exports=function(t){t.addInputOption=t.addInputOptions=t.withInputOption=t.withInputOptions=t.inputOption=t.inputOptions=function(t){if(!this._currentInput)throw new Error("No input specified");var e=!0;return arguments.length>1&&(t=[].slice.call(arguments),e=!1),Array.isArray(t)||(t=[t]),this._currentInput.options(t.reduce(function(t,n){var r=String(n).split(" ");return e&&2===r.length?t.push(r[0],r[1]):t.push(n),t},[])),this},t.addOutputOption=t.addOutputOptions=t.addOption=t.addOptions=t.withOutputOption=t.withOutputOptions=t.withOption=t.withOptions=t.outputOption=t.outputOptions=function(t){var e=!0;return arguments.length>1&&(t=[].slice.call(arguments),e=!1),Array.isArray(t)||(t=[t]),this._currentOutput.options(t.reduce(function(t,n){var r=String(n).split(" ");return e&&2===r.length?t.push(r[0],r[1]):t.push(n),t},[])),this},t.filterGraph=t.complexFilter=function(t,e){if(this._complexFilters.clear(),Array.isArray(t)||(t=[t]),this._complexFilters("-filter_complex",r.makeFilterStrings(t).join(";")),Array.isArray(e)){var n=this;e.forEach(function(t){n._complexFilters("-map",t.replace(r.streamRegexp,"[$1]"))})}else"string"==typeof e&&this._complexFilters("-map",e.replace(r.streamRegexp,"[$1]"));return this}}},278:t=>{"use strict";t.exports=require("net")},317:t=>{"use strict";t.exports=require("child_process")},418:(t,e,n)=>{const r=n(928),o=(process.platform,process.arch),i=n(896);function s(t,e){try{i.accessSync(t,i.constants.X_OK)}catch(n){if("EACCES"===n.code)try{i.chmodSync(t,493),i.accessSync(t,i.constants.X_OK),console.info(`[FFmpeg] Added execute permission to ${e} at ${t}`)}catch(n){console.warn(`[FFmpeg] Failed to set execute permission for ${e} at ${t}`,n)}else"ENOENT"===n.code?console.warn(`[FFmpeg] ${e} binary not found at ${t}`):console.warn(`[FFmpeg] Unable to access ${e} at ${t}`,n)}return t}t.exports={getFfmpegBinaryPath:function(){const t=r.join(process.resourcesPath,"ffmpeg",`darwin-${o}`,"ffmpeg");return console.log(`[FFmpegPath] FFmpeg binary path: ${t} (isDev: false)`),s(t,"ffmpeg")},getFfprobeBinaryPath:function(){const t=r.join(process.resourcesPath,"ffmpeg",`darwin-${o}`,"ffprobe");return console.log(`[FFmpegPath] FFprobe binary path: ${t} (isDev: false)`),s(t,"ffprobe")}}},430:t=>{"use strict";function e(t,e,n,r){return[{filter:"scale",options:{w:"if(gt(a,"+n+"),"+t+",trunc("+e+"*a/2)*2)",h:"if(lt(a,"+n+"),"+e+",trunc("+t+"/a/2)*2)"}},{filter:"pad",options:{w:t,h:e,x:"if(gt(a,"+n+"),0,("+t+"-iw)/2)",y:"if(lt(a,"+n+"),0,("+e+"-ih)/2)",color:r}}]}function n(t,n,r){var o=t.sizeData=t.sizeData||{};if(o[n]=r,!("size"in o))return[];var i,s,a,u=o.size.match(/([0-9]+)x([0-9]+)/),c=o.size.match(/([0-9]+)x\?/),l=o.size.match(/\?x([0-9]+)/),p=o.size.match(/\b([0-9]{1,3})%/);if(p){var f=Number(p[1])/100;return[{filter:"scale",options:{w:"trunc(iw*"+f+"/2)*2",h:"trunc(ih*"+f+"/2)*2"}}]}if(u)return a=(i=2*Math.round(Number(u[1])/2))/(s=2*Math.round(Number(u[2])/2)),o.pad?e(i,s,a,o.pad):[{filter:"scale",options:{w:i,h:s}}];if(c||l)return"aspect"in o?(i=c?c[1]:Math.round(Number(l[1])*o.aspect),s=l?l[1]:Math.round(Number(c[1])/o.aspect),i=2*Math.round(i/2),s=2*Math.round(s/2),o.pad?e(i,s,o.aspect,o.pad):[{filter:"scale",options:{w:i,h:s}}]):c?[{filter:"scale",options:{w:2*Math.round(Number(c[1])/2),h:"trunc(ow/a/2)*2"}}]:[{filter:"scale",options:{w:"trunc(oh*a/2)*2",h:2*Math.round(Number(l[1])/2)}}];throw new Error("Invalid size specified: "+o.size)}t.exports=function(t){t.keepPixelAspect=t.keepDisplayAspect=t.keepDisplayAspectRatio=t.keepDAR=function(){return this.videoFilters([{filter:"scale",options:{w:"if(gt(sar,1),iw*sar,iw)",h:"if(lt(sar,1),ih/sar,ih)"}},{filter:"setsar",options:"1"}])},t.withSize=t.setSize=t.size=function(t){var e=n(this._currentOutput,"size",t);return this._currentOutput.sizeFilters.clear(),this._currentOutput.sizeFilters(e),this},t.withAspect=t.withAspectRatio=t.setAspect=t.setAspectRatio=t.aspect=t.aspectRatio=function(t){var e=Number(t);if(isNaN(e)){var r=t.match(/^(\d+):(\d+)$/);if(!r)throw new Error("Invalid aspect ratio: "+t);e=Number(r[1])/Number(r[2])}var o=n(this._currentOutput,"aspect",e);return this._currentOutput.sizeFilters.clear(),this._currentOutput.sizeFilters(o),this},t.applyAutopadding=t.applyAutoPadding=t.applyAutopad=t.applyAutoPad=t.withAutopadding=t.withAutoPadding=t.withAutopad=t.withAutoPad=t.autoPad=t.autopad=function(t,e){"string"==typeof t&&(e=t,t=!0),void 0===t&&(t=!0);var r=n(this._currentOutput,"pad",!!t&&(e||"black"));return this._currentOutput.sizeFilters.clear(),this._currentOutput.sizeFilters(r),this}}},434:t=>{"use strict";t.exports=require("events")},487:(t,e,n)=>{var r=n(18),o=n(23);(e=t.exports=n(584)).init=function(t){t.inspectOpts={};for(var n=Object.keys(e.inspectOpts),r=0;r<n.length;r++)t.inspectOpts[n[r]]=e.inspectOpts[n[r]]},e.log=function(){return s.write(o.format.apply(o,arguments)+"\n")},e.formatArgs=function(t){var n=this.namespace;if(this.useColors){var r=this.color,o="  [3"+r+";1m"+n+" [0m";t[0]=o+t[0].split("\n").join("\n"+o),t.push("[3"+r+"m+"+e.humanize(this.diff)+"[0m")}else t[0]=(new Date).toUTCString()+" "+n+" "+t[0]},e.save=function(t){null==t?delete process.env.DEBUG:process.env.DEBUG=t},e.load=a,e.useColors=function(){return"colors"in e.inspectOpts?Boolean(e.inspectOpts.colors):r.isatty(i)},e.colors=[6,2,3,4,5,1],e.inspectOpts=Object.keys(process.env).filter(function(t){return/^debug_/i.test(t)}).reduce(function(t,e){var n=e.substring(6).toLowerCase().replace(/_([a-z])/g,function(t,e){return e.toUpperCase()}),r=process.env[e];return r=!!/^(yes|on|true|enabled)$/i.test(r)||!/^(no|off|false|disabled)$/i.test(r)&&("null"===r?null:Number(r)),t[n]=r,t},{});var i=parseInt(process.env.DEBUG_FD,10)||2;1!==i&&2!==i&&o.deprecate(function(){},"except for stderr(2) and stdout(1), any other usage of DEBUG_FD is deprecated. Override debug.log if you want to use a different log function (https://git.io/debug_fd)")();var s=1===i?process.stdout:2===i?process.stderr:function(t){var e;switch(process.binding("tty_wrap").guessHandleType(t)){case"TTY":(e=new r.WriteStream(t))._type="tty",e._handle&&e._handle.unref&&e._handle.unref();break;case"FILE":(e=new(n(896).SyncWriteStream)(t,{autoClose:!1}))._type="fs";break;case"PIPE":case"TCP":(e=new(n(278).Socket)({fd:t,readable:!1,writable:!0})).readable=!1,e.read=null,e._type="pipe",e._handle&&e._handle.unref&&e._handle.unref();break;default:throw new Error("Implement me. Unknown stream file type!")}return e.fd=t,e._isStdio=!0,e}(i);function a(){return process.env.DEBUG}e.formatters.o=function(t){return this.inspectOpts.colors=this.useColors,o.inspect(t,this.inspectOpts).split("\n").map(function(t){return t.trim()}).join(" ")},e.formatters.O=function(t){return this.inspectOpts.colors=this.useColors,o.inspect(t,this.inspectOpts)},e.enable(a())},491:(t,e,n)=>{function r(){var t;try{t=e.storage.debug}catch(t){}return!t&&"undefined"!=typeof process&&"env"in process&&(t=process.env.DEBUG),t}(e=t.exports=n(584)).log=function(){return"object"==typeof console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)},e.formatArgs=function(t){var n=this.useColors;if(t[0]=(n?"%c":"")+this.namespace+(n?" %c":" ")+t[0]+(n?"%c ":" ")+"+"+e.humanize(this.diff),n){var r="color: "+this.color;t.splice(1,0,r,"color: inherit");var o=0,i=0;t[0].replace(/%[a-zA-Z%]/g,function(t){"%%"!==t&&(o++,"%c"===t&&(i=o))}),t.splice(i,0,r)}},e.save=function(t){try{null==t?e.storage.removeItem("debug"):e.storage.debug=t}catch(t){}},e.load=r,e.useColors=function(){return!("undefined"==typeof window||!window.process||"renderer"!==window.process.type)||("undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/))},e.storage="undefined"!=typeof chrome&&void 0!==chrome.storage?chrome.storage.local:function(){try{return window.localStorage}catch(t){}}(),e.colors=["lightseagreen","forestgreen","goldenrod","dodgerblue","darkorchid","crimson"],e.formatters.j=function(t){try{return JSON.stringify(t)}catch(t){return"[UnexpectedJSONParseError]: "+t.message}},e.enable(r())},567:t=>{var e=1e3,n=60*e,r=60*n,o=24*r;function i(t,e,n){if(!(t<e))return t<1.5*e?Math.floor(t/e)+" "+n:Math.ceil(t/e)+" "+n+"s"}t.exports=function(t,s){s=s||{};var a,u=typeof t;if("string"===u&&t.length>0)return function(t){if(!((t=String(t)).length>100)){var i=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(t);if(i){var s=parseFloat(i[1]);switch((i[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return 315576e5*s;case"days":case"day":case"d":return s*o;case"hours":case"hour":case"hrs":case"hr":case"h":return s*r;case"minutes":case"minute":case"mins":case"min":case"m":return s*n;case"seconds":case"second":case"secs":case"sec":case"s":return s*e;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return s;default:return}}}}(t);if("number"===u&&!1===isNaN(t))return s.long?i(a=t,o,"day")||i(a,r,"hour")||i(a,n,"minute")||i(a,e,"second")||a+" ms":function(t){return t>=o?Math.round(t/o)+"d":t>=r?Math.round(t/r)+"h":t>=n?Math.round(t/n)+"m":t>=e?Math.round(t/e)+"s":t+"ms"}(t);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(t))}},584:(t,e,n)=>{var r;function o(t){function n(){if(n.enabled){var t=n,o=+new Date,i=o-(r||o);t.diff=i,t.prev=r,t.curr=o,r=o;for(var s=new Array(arguments.length),a=0;a<s.length;a++)s[a]=arguments[a];s[0]=e.coerce(s[0]),"string"!=typeof s[0]&&s.unshift("%O");var u=0;s[0]=s[0].replace(/%([a-zA-Z%])/g,function(n,r){if("%%"===n)return n;u++;var o=e.formatters[r];if("function"==typeof o){var i=s[u];n=o.call(t,i),s.splice(u,1),u--}return n}),e.formatArgs.call(t,s),(n.log||e.log||console.log.bind(console)).apply(t,s)}}return n.namespace=t,n.enabled=e.enabled(t),n.useColors=e.useColors(),n.color=function(t){var n,r=0;for(n in t)r=(r<<5)-r+t.charCodeAt(n),r|=0;return e.colors[Math.abs(r)%e.colors.length]}(t),"function"==typeof e.init&&e.init(n),n}(e=t.exports=o.debug=o.default=o).coerce=function(t){return t instanceof Error?t.stack||t.message:t},e.disable=function(){e.enable("")},e.enable=function(t){e.save(t),e.names=[],e.skips=[];for(var n=("string"==typeof t?t:"").split(/[\s,]+/),r=n.length,o=0;o<r;o++)n[o]&&("-"===(t=n[o].replace(/\*/g,".*?"))[0]?e.skips.push(new RegExp("^"+t.substr(1)+"$")):e.names.push(new RegExp("^"+t+"$")))},e.enabled=function(t){var n,r;for(n=0,r=e.skips.length;n<r;n++)if(e.skips[n].test(t))return!1;for(n=0,r=e.names.length;n<r;n++)if(e.names[n].test(t))return!0;return!1},e.humanize=n(567),e.names=[],e.skips=[],e.formatters={}},589:t=>{!function(){var e,n,r={};function o(t){var n=!1;return function(){if(n)throw new Error("Callback was already called.");n=!0,t.apply(e,arguments)}}null!=(e=this)&&(n=e.async),r.noConflict=function(){return e.async=n,r};var i=function(t,e){if(t.forEach)return t.forEach(e);for(var n=0;n<t.length;n+=1)e(t[n],n,t)},s=function(t,e){if(t.map)return t.map(e);var n=[];return i(t,function(t,r,o){n.push(e(t,r,o))}),n},a=function(t){if(Object.keys)return Object.keys(t);var e=[];for(var n in t)t.hasOwnProperty(n)&&e.push(n);return e};"undefined"!=typeof process&&process.nextTick?(r.nextTick=process.nextTick,"undefined"!=typeof setImmediate?r.setImmediate=function(t){setImmediate(t)}:r.setImmediate=r.nextTick):"function"==typeof setImmediate?(r.nextTick=function(t){setImmediate(t)},r.setImmediate=r.nextTick):(r.nextTick=function(t){setTimeout(t,0)},r.setImmediate=r.nextTick),r.each=function(t,e,n){if(n=n||function(){},!t.length)return n();var r=0;i(t,function(i){e(i,o(function(e){e?(n(e),n=function(){}):(r+=1)>=t.length&&n(null)}))})},r.forEach=r.each,r.eachSeries=function(t,e,n){if(n=n||function(){},!t.length)return n();var r=0,o=function(){e(t[r],function(e){e?(n(e),n=function(){}):(r+=1)>=t.length?n(null):o()})};o()},r.forEachSeries=r.eachSeries,r.eachLimit=function(t,e,n,r){u(e).apply(null,[t,n,r])},r.forEachLimit=r.eachLimit;var u=function(t){return function(e,n,r){if(r=r||function(){},!e.length||t<=0)return r();var o=0,i=0,s=0;!function a(){if(o>=e.length)return r();for(;s<t&&i<e.length;)s+=1,n(e[(i+=1)-1],function(t){t?(r(t),r=function(){}):(s-=1,(o+=1)>=e.length?r():a())})}()}},c=function(t){return function(){var e=Array.prototype.slice.call(arguments);return t.apply(null,[r.each].concat(e))}},l=function(t){return function(){var e=Array.prototype.slice.call(arguments);return t.apply(null,[r.eachSeries].concat(e))}},p=function(t,e,n,r){var o=[];t(e=s(e,function(t,e){return{index:e,value:t}}),function(t,e){n(t.value,function(n,r){o[t.index]=r,e(n)})},function(t){r(t,o)})};r.map=c(p),r.mapSeries=l(p),r.mapLimit=function(t,e,n,r){return f(e)(t,n,r)};var f=function(t){return function(t,e){return function(){var n=Array.prototype.slice.call(arguments);return e.apply(null,[u(t)].concat(n))}}(t,p)};r.reduce=function(t,e,n,o){r.eachSeries(t,function(t,r){n(e,t,function(t,n){e=n,r(t)})},function(t){o(t,e)})},r.inject=r.reduce,r.foldl=r.reduce,r.reduceRight=function(t,e,n,o){var i=s(t,function(t){return t}).reverse();r.reduce(i,e,n,o)},r.foldr=r.reduceRight;var d=function(t,e,n,r){var o=[];t(e=s(e,function(t,e){return{index:e,value:t}}),function(t,e){n(t.value,function(n){n&&o.push(t),e()})},function(t){r(s(o.sort(function(t,e){return t.index-e.index}),function(t){return t.value}))})};r.filter=c(d),r.filterSeries=l(d),r.select=r.filter,r.selectSeries=r.filterSeries;var h=function(t,e,n,r){var o=[];t(e=s(e,function(t,e){return{index:e,value:t}}),function(t,e){n(t.value,function(n){n||o.push(t),e()})},function(t){r(s(o.sort(function(t,e){return t.index-e.index}),function(t){return t.value}))})};r.reject=c(h),r.rejectSeries=l(h);var m=function(t,e,n,r){t(e,function(t,e){n(t,function(n){n?(r(t),r=function(){}):e()})},function(t){r()})};r.detect=c(m),r.detectSeries=l(m),r.some=function(t,e,n){r.each(t,function(t,r){e(t,function(t){t&&(n(!0),n=function(){}),r()})},function(t){n(!1)})},r.any=r.some,r.every=function(t,e,n){r.each(t,function(t,r){e(t,function(t){t||(n(!1),n=function(){}),r()})},function(t){n(!0)})},r.all=r.every,r.sortBy=function(t,e,n){r.map(t,function(t,n){e(t,function(e,r){e?n(e):n(null,{value:t,criteria:r})})},function(t,e){if(t)return n(t);n(null,s(e.sort(function(t,e){var n=t.criteria,r=e.criteria;return n<r?-1:n>r?1:0}),function(t){return t.value}))})},r.auto=function(t,e){e=e||function(){};var n=a(t);if(!n.length)return e(null);var o={},s=[],u=function(t){s.unshift(t)},c=function(){i(s.slice(0),function(t){t()})};u(function(){a(o).length===n.length&&(e(null,o),e=function(){})}),i(n,function(n){var l=t[n]instanceof Function?[t[n]]:t[n],p=function(t){var s=Array.prototype.slice.call(arguments,1);if(s.length<=1&&(s=s[0]),t){var u={};i(a(o),function(t){u[t]=o[t]}),u[n]=s,e(t,u),e=function(){}}else o[n]=s,r.setImmediate(c)},f=l.slice(0,Math.abs(l.length-1))||[],d=function(){return e=function(t,e){return t&&o.hasOwnProperty(e)},r=!0,((t=f).reduce?t.reduce(e,r):(i(t,function(t,n,o){r=e(r,t)}),r))&&!o.hasOwnProperty(n);var t,e,r};if(d())l[l.length-1](p,o);else{var h=function(){d()&&(function(t){for(var e=0;e<s.length;e+=1)if(s[e]===t)return void s.splice(e,1)}(h),l[l.length-1](p,o))};u(h)}})},r.waterfall=function(t,e){if(e=e||function(){},t.constructor!==Array){var n=new Error("First argument to waterfall must be an array of functions");return e(n)}if(!t.length)return e();var o=function(t){return function(n){if(n)e.apply(null,arguments),e=function(){};else{var i=Array.prototype.slice.call(arguments,1),s=t.next();s?i.push(o(s)):i.push(e),r.setImmediate(function(){t.apply(null,i)})}}};o(r.iterator(t))()};var g=function(t,e,n){if(n=n||function(){},e.constructor===Array)t.map(e,function(t,e){t&&t(function(t){var n=Array.prototype.slice.call(arguments,1);n.length<=1&&(n=n[0]),e.call(null,t,n)})},n);else{var r={};t.each(a(e),function(t,n){e[t](function(e){var o=Array.prototype.slice.call(arguments,1);o.length<=1&&(o=o[0]),r[t]=o,n(e)})},function(t){n(t,r)})}};r.parallel=function(t,e){g({map:r.map,each:r.each},t,e)},r.parallelLimit=function(t,e,n){g({map:f(e),each:u(e)},t,n)},r.series=function(t,e){if(e=e||function(){},t.constructor===Array)r.mapSeries(t,function(t,e){t&&t(function(t){var n=Array.prototype.slice.call(arguments,1);n.length<=1&&(n=n[0]),e.call(null,t,n)})},e);else{var n={};r.eachSeries(a(t),function(e,r){t[e](function(t){var o=Array.prototype.slice.call(arguments,1);o.length<=1&&(o=o[0]),n[e]=o,r(t)})},function(t){e(t,n)})}},r.iterator=function(t){var e=function(n){var r=function(){return t.length&&t[n].apply(null,arguments),r.next()};return r.next=function(){return n<t.length-1?e(n+1):null},r};return e(0)},r.apply=function(t){var e=Array.prototype.slice.call(arguments,1);return function(){return t.apply(null,e.concat(Array.prototype.slice.call(arguments)))}};var v=function(t,e,n,r){var o=[];t(e,function(t,e){n(t,function(t,n){o=o.concat(n||[]),e(t)})},function(t){r(t,o)})};r.concat=c(v),r.concatSeries=l(v),r.whilst=function(t,e,n){t()?e(function(o){if(o)return n(o);r.whilst(t,e,n)}):n()},r.doWhilst=function(t,e,n){t(function(o){if(o)return n(o);e()?r.doWhilst(t,e,n):n()})},r.until=function(t,e,n){t()?n():e(function(o){if(o)return n(o);r.until(t,e,n)})},r.doUntil=function(t,e,n){t(function(o){if(o)return n(o);e()?n():r.doUntil(t,e,n)})},r.queue=function(t,e){function n(t,n,o,s){n.constructor!==Array&&(n=[n]),i(n,function(n){var i={data:n,callback:"function"==typeof s?s:null};o?t.tasks.unshift(i):t.tasks.push(i),t.saturated&&t.tasks.length===e&&t.saturated(),r.setImmediate(t.process)})}void 0===e&&(e=1);var s=0,a={tasks:[],concurrency:e,saturated:null,empty:null,drain:null,push:function(t,e){n(a,t,!1,e)},unshift:function(t,e){n(a,t,!0,e)},process:function(){if(s<a.concurrency&&a.tasks.length){var e=a.tasks.shift();a.empty&&0===a.tasks.length&&a.empty(),s+=1;var n=o(function(){s-=1,e.callback&&e.callback.apply(e,arguments),a.drain&&a.tasks.length+s===0&&a.drain(),a.process()});t(e.data,n)}},length:function(){return a.tasks.length},running:function(){return s}};return a},r.cargo=function(t,e){var n=!1,o=[],a={tasks:o,payload:e,saturated:null,empty:null,drain:null,push:function(t,n){t.constructor!==Array&&(t=[t]),i(t,function(t){o.push({data:t,callback:"function"==typeof n?n:null}),a.saturated&&o.length===e&&a.saturated()}),r.setImmediate(a.process)},process:function r(){if(!n)if(0!==o.length){var u="number"==typeof e?o.splice(0,e):o.splice(0),c=s(u,function(t){return t.data});a.empty&&a.empty(),n=!0,t(c,function(){n=!1;var t=arguments;i(u,function(e){e.callback&&e.callback.apply(null,t)}),r()})}else a.drain&&a.drain()},length:function(){return o.length},running:function(){return n}};return a};var w=function(t){return function(e){var n=Array.prototype.slice.call(arguments,1);e.apply(null,n.concat([function(e){var n=Array.prototype.slice.call(arguments,1);"undefined"!=typeof console&&(e?console.error&&console.error(e):console[t]&&i(n,function(e){console[t](e)}))}]))}};r.log=w("log"),r.dir=w("dir"),r.memoize=function(t,e){var n={},r={};e=e||function(t){return t};var o=function(){var o=Array.prototype.slice.call(arguments),i=o.pop(),s=e.apply(null,o);s in n?i.apply(null,n[s]):s in r?r[s].push(i):(r[s]=[i],t.apply(null,o.concat([function(){n[s]=arguments;var t=r[s];delete r[s];for(var e=0,o=t.length;e<o;e++)t[e].apply(null,arguments)}])))};return o.memo=n,o.unmemoized=t,o},r.unmemoize=function(t){return function(){return(t.unmemoized||t).apply(null,arguments)}},r.times=function(t,e,n){for(var o=[],i=0;i<t;i++)o.push(i);return r.map(o,e,n)},r.timesSeries=function(t,e,n){for(var o=[],i=0;i<t;i++)o.push(i);return r.mapSeries(o,e,n)},r.compose=function(){var t=Array.prototype.reverse.call(arguments);return function(){var e=this,n=Array.prototype.slice.call(arguments),o=n.pop();r.reduce(t,n,function(t,n,r){n.apply(e,t.concat([function(){var t=arguments[0],e=Array.prototype.slice.call(arguments,1);r(t,e)}]))},function(t,n){o.apply(e,[t].concat(n))})}};var y=function(t,e){var n=function(){var n=this,r=Array.prototype.slice.call(arguments),o=r.pop();return t(e,function(t,e){t.apply(n,r.concat([e]))},o)};if(arguments.length>2){var r=Array.prototype.slice.call(arguments,2);return n.apply(this,r)}return n};r.applyEach=c(y),r.applyEachSeries=l(y),r.forever=function(t,e){!function n(r){if(r){if(e)return e(r);throw r}t(n)}()},"undefined"!=typeof define&&define.amd?define([],function(){return r}):t.exports?t.exports=r:e.async=r}()},590:(t,e,n)=>{t.exports=o,o.sync=function(t,e){return i(r.statSync(t),e)};var r=n(896);function o(t,e,n){r.stat(t,function(t,r){n(t,!t&&i(r,e))})}function i(t,e){return t.isFile()&&function(t,e){var n=t.mode,r=t.uid,o=t.gid,i=void 0!==e.uid?e.uid:process.getuid&&process.getuid(),s=void 0!==e.gid?e.gid:process.getgid&&process.getgid(),a=parseInt("100",8),u=parseInt("010",8);return n&parseInt("001",8)||n&u&&o===s||n&a&&r===i||n&(a|u)&&0===i}(t,e)}},619:(t,e,n)=>{"use strict";var r=n(744);t.exports=function(t){t.withNoVideo=t.noVideo=function(){return this._currentOutput.video.clear(),this._currentOutput.videoFilters.clear(),this._currentOutput.video("-vn"),this},t.withVideoCodec=t.videoCodec=function(t){return this._currentOutput.video("-vcodec",t),this},t.withVideoBitrate=t.videoBitrate=function(t,e){return t=(""+t).replace(/k?$/,"k"),this._currentOutput.video("-b:v",t),e&&this._currentOutput.video("-maxrate",t,"-minrate",t,"-bufsize","3M"),this},t.withVideoFilter=t.withVideoFilters=t.videoFilter=t.videoFilters=function(t){return arguments.length>1&&(t=[].slice.call(arguments)),Array.isArray(t)||(t=[t]),this._currentOutput.videoFilters(r.makeFilterStrings(t)),this},t.withOutputFps=t.withOutputFPS=t.withFpsOutput=t.withFPSOutput=t.withFps=t.withFPS=t.outputFPS=t.outputFps=t.fpsOutput=t.FPSOutput=t.fps=t.FPS=function(t){return this._currentOutput.video("-r",t),this},t.takeFrames=t.withFrames=t.frames=function(t){return this._currentOutput.video("-vframes",t),this}}},623:(t,e,n)=>{t.exports=c,c.sync=function(t,e){for(var n=u(t,e=e||{}),r=n.env,i=n.ext,c=n.extExe,l=[],p=0,f=r.length;p<f;p++){var d=r[p];'"'===d.charAt(0)&&'"'===d.slice(-1)&&(d=d.slice(1,-1));var h=o.join(d,t);!d&&/^\.[\\\/]/.test(t)&&(h=t.slice(0,2)+h);for(var m=0,g=i.length;m<g;m++){var v=h+i[m];try{if(s.sync(v,{pathExt:c})){if(!e.all)return v;l.push(v)}}catch(t){}}}if(e.all&&l.length)return l;if(e.nothrow)return null;throw a(t)};var r="win32"===process.platform||"cygwin"===process.env.OSTYPE||"msys"===process.env.OSTYPE,o=n(928),i=r?";":":",s=n(813);function a(t){var e=new Error("not found: "+t);return e.code="ENOENT",e}function u(t,e){var n=e.colon||i,o=e.path||process.env.PATH||"",s=[""];o=o.split(n);var a="";return r&&(o.unshift(process.cwd()),s=(a=e.pathExt||process.env.PATHEXT||".EXE;.CMD;.BAT;.COM").split(n),-1!==t.indexOf(".")&&""!==s[0]&&s.unshift("")),(t.match(/\//)||r&&t.match(/\\/))&&(o=[""]),{env:o,ext:s,extExe:a}}function c(t,e,n){"function"==typeof e&&(n=e,e={});var r=u(t,e),i=r.env,c=r.ext,l=r.extExe,p=[];!function r(u,f){if(u===f)return e.all&&p.length?n(null,p):n(a(t));var d=i[u];'"'===d.charAt(0)&&'"'===d.slice(-1)&&(d=d.slice(1,-1));var h=o.join(d,t);!d&&/^\.[\\\/]/.test(t)&&(h=t.slice(0,2)+h),function t(o,i){if(o===i)return r(u+1,f);var a=c[o];s(h+a,{pathExt:l},function(r,s){if(!r&&s){if(!e.all)return n(null,h+a);p.push(h+a)}return t(o+1,i)})}(0,c.length)}(0,i.length)}},627:(t,e,n)=>{"use strict";var r=n(317).spawn;function o(t){return t.match(/^TAG:/)}function i(t){return t.match(/^DISPOSITION:/)}t.exports=function(t){t.ffprobe=function(){var t,e=null,n=[],s=arguments[arguments.length-1],a=!1;function u(t,e){a||(a=!0,s(t,e))}switch(arguments.length){case 3:e=arguments[0],n=arguments[1];break;case 2:"number"==typeof arguments[0]?e=arguments[0]:Array.isArray(arguments[0])&&(n=arguments[0])}if(null===e){if(!this._currentInput)return u(new Error("No input specified"));t=this._currentInput}else if(!(t=this._inputs[e]))return u(new Error("Invalid input index"));this._getFfprobePath(function(e,a){if(e)return u(e);if(!a)return u(new Error("Cannot find ffprobe"));var c="",l=!1,p="",f=!1,d=t.isStream?"pipe:0":t.source,h=r(a,["-show_streams","-show_format"].concat(n,d),{windowsHide:!0});t.isStream&&(h.stdin.on("error",function(t){["ECONNRESET","EPIPE","EOF"].indexOf(t.code)>=0||u(t)}),h.stdin.on("close",function(){t.source.pause(),t.source.unpipe(h.stdin)}),t.source.pipe(h.stdin)),h.on("error",s);var m=null;function g(t){if(t&&(m=t),v&&l&&f){if(m)return p&&(m.message+="\n"+p),u(m);var e=function(t){var e=t.split(/\r\n|\r|\n/);e=e.filter(function(t){return t.length>0});var n={streams:[],format:{},chapters:[]};function r(t){for(var n={},r=e.shift();void 0!==r;){if(r.toLowerCase()=="[/"+t+"]")return n;if(r.match(/^\[/))r=e.shift();else{var o=r.match(/^([^=]+)=(.*)$/);o&&(!o[1].match(/^TAG:/)&&o[2].match(/^[0-9]+(\.[0-9]+)?$/)?n[o[1]]=Number(o[2]):n[o[1]]=o[2]),r=e.shift()}}return n}for(var o=e.shift();void 0!==o;){if(o.match(/^\[stream/i)){var i=r("stream");n.streams.push(i)}else if(o.match(/^\[chapter/i)){var s=r("chapter");n.chapters.push(s)}else"[format]"===o.toLowerCase()&&(n.format=r("format"));o=e.shift()}return n}(c);[e.format].concat(e.streams).forEach(function(t){if(t){var e=Object.keys(t).filter(o);e.length&&(t.tags=t.tags||{},e.forEach(function(e){t.tags[e.substr(4)]=t[e],delete t[e]}));var n=Object.keys(t).filter(i);n.length&&(t.disposition=t.disposition||{},n.forEach(function(e){t.disposition[e.substr(12)]=t[e],delete t[e]}))}}),u(null,e)}}var v=!1;h.on("exit",function(t,e){v=!0,t?g(new Error("ffprobe exited with code "+t)):e?g(new Error("ffprobe was killed with signal "+e)):g()}),h.stdout.on("data",function(t){c+=t}),h.stdout.on("close",function(){l=!0,g()}),h.stderr.on("data",function(t){p+=t}),h.stderr.on("close",function(){f=!0,g()})})}}},653:(t,e,n)=>{const r=n(928),o=n(85),{getFfmpegBinaryPath:i,getFfprobeBinaryPath:s}=n(418),a=n(896),u=n(857);o.setFfmpegPath(i()),o.setFfprobePath(s());const c="FFMPEG_ERROR",l="CORRUPT_VIDEO",p="FILE_NOT_FOUND",f="PERMISSION_DENIED";function d(t){return new Promise((e,n)=>setTimeout(()=>n(new Error("TIMEOUT")),t))}async function h(t,e){return new Promise((n,i)=>{console.debug("[Thumbnail] Attempting screenshot",{filePath:t,timestamp:e});const s=r.join(u.tmpdir(),`thumb_${Date.now()}_${Math.random().toString(36).substr(2,9)}.jpg`);o(t).on("start",t=>{console.debug("[Thumbnail] ffmpeg command started",{timestamp:e,cmdLine:t})}).on("stderr",t=>{console.debug("[Thumbnail][stderr]",t.trim())}).screenshots({timestamps:[e],filename:r.basename(s),folder:r.dirname(s),size:"320x180"}).on("end",()=>{try{console.debug("[Thumbnail] Screenshot succeeded",{tempPath:s});const t=a.readFileSync(s).toString("base64");a.unlinkSync(s),n(`data:image/jpeg;base64,${t}`)}catch(t){console.error("[Thumbnail] Error reading generated image",{message:t.message,code:t.code,errno:t.errno,path:t.path}),i(new Error(c))}}).on("error",t=>{console.error("[Thumbnail] Generation error",{message:t.message,code:t.code,errno:t.errno,path:t.path,spawnargs:t.spawnargs}),a.existsSync(s)&&a.unlinkSync(s),i(new Error(c))})})}t.exports={getMetadata:async function(t){try{if(console.log("[Metadata] ========== Starting metadata extraction =========="),console.log("[Metadata] File path:",t),!a.existsSync(t))throw console.warn("[Metadata] File not found at path",t),new Error(p);try{const e=a.statSync(t);console.log("[Metadata] File info:",{size:`${(e.size/1024/1024).toFixed(2)} MB`,sizeBytes:e.size,modified:e.mtime.toISOString(),created:e.birthtime.toISOString(),isFile:e.isFile(),extension:r.extname(t)})}catch(t){console.warn("[Metadata] Could not read file stats:",t.message)}try{a.accessSync(t,a.constants.R_OK),console.log("[Metadata] File is readable ✓")}catch(e){throw console.warn("[Metadata] Permission denied when accessing file",{filePath:t,err:e}),new Error(f)}const e=async function(t){return new Promise((e,n)=>{console.debug("[Metadata] Starting ffprobe for",t),o.ffprobe(t,(t,r)=>{if(t){const e=t.message||"";let r=c,o="Failed to read video file";e.includes("moov atom not found")||e.includes("Invalid data found")?(r=l,o="Video file is corrupted or incomplete. The file may not have finished uploading/downloading."):e.includes("No such file")||e.includes("does not exist")?(r=p,o="Video file not found"):e.includes("Permission denied")?(r=f,o="Permission denied when accessing video file"):e.includes("not a valid")&&(r="INVALID_FORMAT",o="Video format not supported"),console.error("[Metadata] ffprobe error",{errorType:r,userMessage:o,rawMessage:t.message,code:t.code,errno:t.errno,path:t.path,spawnargs:t.spawnargs});const i=new Error(r);return i.userMessage=o,i.details=e,i.raw=t,void n(i)}const o=r.streams.find(t=>"video"===t.codec_type);if(!o){console.warn("[Metadata] No video stream detected in ffprobe response");const t=new Error(l);return t.userMessage="No video stream found in file",void n(t)}console.debug("[Metadata] ffprobe raw response snapshot",{formatName:r.format?.format_name,duration:r.format?.duration,size:r.format?.size,bitRate:r.format?.bit_rate,videoCodec:o.codec_name,audioStreamCount:r.streams.filter(t=>"audio"===t.codec_type).length}),console.debug("[Metadata] ffprobe succeeded, video stream found",{codec:o.codec_name,resolution:`${o.width}x${o.height}`,duration:r.format.duration}),e({duration:parseFloat(r.format.duration)||0,width:o.width||0,height:o.height||0,codec:o.codec_name||"unknown",bitrate:parseInt(r.format.bit_rate)||0})})})}(t),n=await Promise.race([e,d(3e4)]);console.debug("[Metadata] Core data extracted",n);const i=async function(t){const e=["00:00:01","00:00:00","00:00:05"];for(const n of e)try{return await h(t,n)}catch(t){console.warn("[Thumbnail] Failed attempt, trying next timestamp",{timestamp:n,reason:t.message});continue}throw new Error(c)}(t),s=await Promise.race([i,d(3e4)]);return console.log("[Metadata] Thumbnail generated successfully ✓"),console.log("[Metadata] ========== Metadata extraction complete =========="),console.log("[Metadata] Final metadata package:",{duration:n.duration,width:n.width,height:n.height,codec:n.codec,hasThumbnail:!!s}),{...n,thumbnail:s}}catch(t){throw console.error("[Metadata] ========== Metadata extraction FAILED =========="),console.error("[Metadata] Error details:",{type:t.message,userMessage:t.userMessage||"Unknown error",hasDetails:!!t.details,details:t.details,stack:t.stack}),t}}}},711:(t,e,n)=>{"use strict";var r=n(896),o=n(928),i=n(589),s=n(744),a=/^\s*([D ])([E ])([VAS])([S ])([D ])([T ]) ([^ ]+) +(.*)$/,u=/^\s*([D\.])([E\.])([VAS])([I\.])([L\.])([S\.]) ([^ ]+) +(.*)$/,c=/\(encoders:([^\)]+)\)/,l=/\(decoders:([^\)]+)\)/,p=/^\s*([VAS\.])([F\.])([S\.])([X\.])([B\.])([D\.]) ([^ ]+) +(.*)$/,f=/^\s*([D ])([E ])\s+([^ ]+)\s+(.*)$/,d=/\r\n|\r|\n/,h=/^(?: [T\.][S\.][C\.] )?([^ ]+) +(AA?|VV?|\|)->(AA?|VV?|\|) +(.*)$/,m={};t.exports=function(t){t.setFfmpegPath=function(t){return m.ffmpegPath=t,this},t.setFfprobePath=function(t){return m.ffprobePath=t,this},t.setFlvtoolPath=function(t){return m.flvtoolPath=t,this},t._forgetPaths=function(){delete m.ffmpegPath,delete m.ffprobePath,delete m.flvtoolPath},t._getFfmpegPath=function(t){if("ffmpegPath"in m)return t(null,m.ffmpegPath);i.waterfall([function(t){process.env.FFMPEG_PATH?r.exists(process.env.FFMPEG_PATH,function(e){t(null,e?process.env.FFMPEG_PATH:"")}):t(null,"")},function(t,e){if(t.length)return e(null,t);s.which("ffmpeg",function(t,n){e(t,n)})}],function(e,n){e?t(e):t(null,m.ffmpegPath=n||"")})},t._getFfprobePath=function(t){var e=this;if("ffprobePath"in m)return t(null,m.ffprobePath);i.waterfall([function(t){process.env.FFPROBE_PATH?r.exists(process.env.FFPROBE_PATH,function(e){t(null,e?process.env.FFPROBE_PATH:"")}):t(null,"")},function(t,e){if(t.length)return e(null,t);s.which("ffprobe",function(t,n){e(t,n)})},function(t,n){if(t.length)return n(null,t);e._getFfmpegPath(function(t,e){if(t)n(t);else if(e.length){var i=s.isWindows?"ffprobe.exe":"ffprobe",a=o.join(o.dirname(e),i);r.exists(a,function(t){n(null,t?a:"")})}else n(null,"")})}],function(e,n){e?t(e):t(null,m.ffprobePath=n||"")})},t._getFlvtoolPath=function(t){if("flvtoolPath"in m)return t(null,m.flvtoolPath);i.waterfall([function(t){process.env.FLVMETA_PATH?r.exists(process.env.FLVMETA_PATH,function(e){t(null,e?process.env.FLVMETA_PATH:"")}):t(null,"")},function(t,e){if(t.length)return e(null,t);process.env.FLVTOOL2_PATH?r.exists(process.env.FLVTOOL2_PATH,function(t){e(null,t?process.env.FLVTOOL2_PATH:"")}):e(null,"")},function(t,e){if(t.length)return e(null,t);s.which("flvmeta",function(t,n){e(t,n)})},function(t,e){if(t.length)return e(null,t);s.which("flvtool2",function(t,n){e(t,n)})}],function(e,n){e?t(e):t(null,m.flvtoolPath=n||"")})},t.availableFilters=t.getAvailableFilters=function(t){if("filters"in m)return t(null,m.filters);this._spawnFfmpeg(["-filters"],{captureStdout:!0,stdoutLines:0},function(e,n){if(e)return t(e);var r=n.get().split("\n"),o={},i={A:"audio",V:"video","|":"none"};r.forEach(function(t){var e=t.match(h);e&&(o[e[1]]={description:e[4],input:i[e[2].charAt(0)],multipleInputs:e[2].length>1,output:i[e[3].charAt(0)],multipleOutputs:e[3].length>1})}),t(null,m.filters=o)})},t.availableCodecs=t.getAvailableCodecs=function(t){if("codecs"in m)return t(null,m.codecs);this._spawnFfmpeg(["-codecs"],{captureStdout:!0,stdoutLines:0},function(e,n){if(e)return t(e);var r=n.get().split(d),o={};r.forEach(function(t){var e=t.match(a);if(e&&"="!==e[7]&&(o[e[7]]={type:{V:"video",A:"audio",S:"subtitle"}[e[3]],description:e[8],canDecode:"D"===e[1],canEncode:"E"===e[2],drawHorizBand:"S"===e[4],directRendering:"D"===e[5],weirdFrameTruncation:"T"===e[6]}),(e=t.match(u))&&"="!==e[7]){var n=o[e[7]]={type:{V:"video",A:"audio",S:"subtitle"}[e[3]],description:e[8],canDecode:"D"===e[1],canEncode:"E"===e[2],intraFrameOnly:"I"===e[4],isLossy:"L"===e[5],isLossless:"S"===e[6]},r=n.description.match(c);r=r?r[1].trim().split(" "):[];var i=n.description.match(l);if(i=i?i[1].trim().split(" "):[],r.length||i.length){var p={};s.copy(n,p),delete p.canEncode,delete p.canDecode,r.forEach(function(t){o[t]={},s.copy(p,o[t]),o[t].canEncode=!0}),i.forEach(function(t){t in o||(o[t]={},s.copy(p,o[t])),o[t].canDecode=!0})}}}),t(null,m.codecs=o)})},t.availableEncoders=t.getAvailableEncoders=function(t){if("encoders"in m)return t(null,m.encoders);this._spawnFfmpeg(["-encoders"],{captureStdout:!0,stdoutLines:0},function(e,n){if(e)return t(e);var r=n.get().split(d),o={};r.forEach(function(t){var e=t.match(p);e&&"="!==e[7]&&(o[e[7]]={type:{V:"video",A:"audio",S:"subtitle"}[e[1]],description:e[8],frameMT:"F"===e[2],sliceMT:"S"===e[3],experimental:"X"===e[4],drawHorizBand:"B"===e[5],directRendering:"D"===e[6]})}),t(null,m.encoders=o)})},t.availableFormats=t.getAvailableFormats=function(t){if("formats"in m)return t(null,m.formats);this._spawnFfmpeg(["-formats"],{captureStdout:!0,stdoutLines:0},function(e,n){if(e)return t(e);var r=n.get().split(d),o={};r.forEach(function(t){var e=t.match(f);e&&e[3].split(",").forEach(function(t){t in o||(o[t]={description:e[4],canDemux:!1,canMux:!1}),"D"===e[1]&&(o[t].canDemux=!0),"E"===e[2]&&(o[t].canMux=!0)})}),t(null,m.formats=o)})},t._checkCapabilities=function(t){var e=this;i.waterfall([function(t){e.availableFormats(t)},function(t,n){var r;return 1===(r=e._outputs.reduce(function(e,n){var r=n.options.find("-f",1);return r&&(r[0]in t&&t[r[0]].canMux||e.push(r)),e},[])).length?n(new Error("Output format "+r[0]+" is not available")):r.length>1?n(new Error("Output formats "+r.join(", ")+" are not available")):1===(r=e._inputs.reduce(function(e,n){var r=n.options.find("-f",1);return r&&(r[0]in t&&t[r[0]].canDemux||e.push(r[0])),e},[])).length?n(new Error("Input format "+r[0]+" is not available")):r.length>1?n(new Error("Input formats "+r.join(", ")+" are not available")):void n()},function(t){e.availableEncoders(t)},function(t,n){var r;return 1===(r=e._outputs.reduce(function(e,n){var r=n.audio.find("-acodec",1);return r&&"copy"!==r[0]&&(r[0]in t&&"audio"===t[r[0]].type||e.push(r[0])),e},[])).length?n(new Error("Audio codec "+r[0]+" is not available")):r.length>1?n(new Error("Audio codecs "+r.join(", ")+" are not available")):1===(r=e._outputs.reduce(function(e,n){var r=n.video.find("-vcodec",1);return r&&"copy"!==r[0]&&(r[0]in t&&"video"===t[r[0]].type||e.push(r[0])),e},[])).length?n(new Error("Video codec "+r[0]+" is not available")):r.length>1?n(new Error("Video codecs "+r.join(", ")+" are not available")):void n()}],t)}}},734:(t,e,n)=>{const r=n(85),{getFfmpegBinaryPath:o,getFfprobeBinaryPath:i}=n(418),s=n(896),a=n(928),u=n(857);r.setFfmpegPath(o()),r.setFfprobePath(i());const c={ENOSPC:"Not enough disk space",EACCES:"Permission denied. Check file permissions.",ENOENT:"Output directory not found",ffmpeg:"Video processing failed",TIMEOUT:"Export timed out. Try a shorter video.",INVALID_CLIPS:"No clips to export",EXPORT_FAILED:"Export failed"};function l(t){return new Promise((e,n)=>setTimeout(()=>n(new Error("TIMEOUT")),t))}async function p(t,e,n,o){return new Promise((i,s)=>{const a=t.trimEnd-t.trimStart;let u=0;console.log(`[Export] Extracting segment: ${t.fileName} (${t.trimStart}s - ${t.trimEnd}s)`),r(t.filePath).on("start",t=>{console.log("[Export] FFmpeg command:",t)}).on("stderr",t=>{console.debug("[Export][stderr]",t.trim())}).on("progress",t=>{const e=Math.min(Math.round(t.percent||0),100);e>u+2&&(u=e,o(e))}).on("end",()=>{console.log("[Export] Segment extraction complete:",e),i()}).on("error",t=>{console.error("[Export] Segment extraction failed:",t.message),s(t)}).seekInput(t.trimStart).setDuration(a).outputOptions(["-vf",`scale=${n.width}:${n.height}:force_original_aspect_ratio=decrease,pad=${n.width}:${n.height}:(ow-iw)/2:(oh-ih)/2,setpts=PTS-STARTPTS`]).outputOptions(["-af","asetpts=PTS-STARTPTS"]).outputOptions(["-c:v","libx264","-preset","fast","-crf","23"]).outputOptions(["-c:a","pcm_s16le","-ar","48000","-ac","2"]).outputOptions(["-r","30","-vsync","cfr"]).outputOptions(["-fflags","+genpts","-async","1"]).outputOptions(["-map","0:v:0","-map","0:a:0?"]).output(e).run()})}async function f(t,e,n){return new Promise((o,i)=>{let s=0;const a=t.map((t,e)=>`[${e}:v][${e}:a]`).join("")+`concat=n=${t.length}:v=1:a=1[vcat][acat]`;console.log("[Export] Using filter_complex concatenation"),console.log("[Export] Filter:",a),console.log("[Export] Segments to concatenate:",t.length);let u=r();t.forEach(t=>{u=u.input(t)}),u.on("start",t=>{console.log("[Export] Concat command:",t),n(0)}).on("stderr",t=>{console.debug("[Export][concat stderr]",t.trim())}).on("progress",t=>{const e=Math.min(Math.round(t.percent||0),100);e>s+2&&(s=e,n(e))}).on("end",()=>{console.log("[Export] Concatenation complete"),n(100),o()}).on("error",t=>{console.error("[Export] Concatenation failed:",t.message),i(t)}).complexFilter(a).outputOptions(["-map","[vcat]","-map","[acat]"]).outputOptions(["-c:v","libx264","-preset","fast","-crf","23"]).outputOptions(["-c:a","aac","-b:a","192k","-ar","48000","-ac","2"]).outputOptions(["-r","30"]).outputOptions(["-fflags","+genpts","-async","1"]).output(e).run()})}function d(t){t.forEach(t=>{try{s.existsSync(t)&&(s.unlinkSync(t),console.log("[Export] Cleaned up temp file:",t))}catch(e){console.warn("[Export] Failed to clean up temp file:",t,e.message)}})}t.exports={exportTimeline:async function(t,e,n=()=>{}){if(!t||0===t.length)throw new Error("INVALID_CLIPS");console.log("[Export] ========== Starting timeline export =========="),console.log("[Export] Clips count:",t.length),console.log("[Export] Output path:",e);const r=[...t].sort((t,e)=>t.order-e.order);console.log("[Export] Sorted clips by order:",r.map(t=>({name:t.fileName,order:t.order})));const o=r.reduce((t,e)=>e.width*e.height>t.width*t.height?{width:e.width,height:e.height}:t,{width:r[0].width,height:r[0].height});console.log("[Export] Target resolution:",o);const i=u.tmpdir(),h=[];try{const t=a.dirname(e);try{s.accessSync(t,s.constants.W_OK)}catch(t){throw new Error("EACCES")}console.log("[Export] Step 1: Extracting trimmed segments..."),n(5);const u=[];for(let t=0;t<r.length;t++){const e=r[t],s=a.join(i,`segment_${t}_${Date.now()}.mkv`);h.push(s),console.log(`[Export] Processing clip ${t+1}/${r.length}: ${e.fileName}`);const c=5+50*t/r.length,f=5+50*(t+1)/r.length;await Promise.race([p(e,s,o,t=>{const e=c+t*(f-c)/100;n(Math.round(e))}),l(6e4)]),u.push(s),n(Math.round(f))}return console.log("[Export] Step 2: Concatenating segments..."),n(55),await Promise.race([f(u,e,t=>{const e=Math.min(55+.35*t,90);n(Math.round(e))}),l(3e5)]),console.log("[Export] Step 3: Finalizing export..."),n(90),await new Promise(t=>setTimeout(t,500)),n(100),console.log("[Export] ========== Export completed successfully =========="),console.log("[Export] Final output:",e),e}catch(t){console.error("[Export] ========== Export FAILED =========="),console.error("[Export] Error:",t.message),d(h);const e=t.message||"EXPORT_FAILED",n=c[e]||c.EXPORT_FAILED,r=new Error(e);throw r.userMessage=n,r}finally{d(h)}}}},744:(t,e,n)=>{"use strict";n(317).exec;var r=n(857).platform().match(/win(32|64)/),o=n(623),i=/\r\n|\r|\n/g,s=/^\[?(.*?)\]?$/,a=/[,]/,u={},c=t.exports={isWindows:r,streamRegexp:s,copy:function(t,e){Object.keys(t).forEach(function(n){e[n]=t[n]})},args:function(){var t=[],e=function(){t=1===arguments.length&&Array.isArray(arguments[0])?t.concat(arguments[0]):t.concat([].slice.call(arguments))};return e.clear=function(){t=[]},e.get=function(){return t},e.find=function(e,n){var r=t.indexOf(e);if(-1!==r)return t.slice(r+1,r+1+(n||0))},e.remove=function(e,n){var r=t.indexOf(e);-1!==r&&t.splice(r,(n||0)+1)},e.clone=function(){var e=c.args();return e(t),e},e},makeFilterStrings:function(t){return t.map(function(t){if("string"==typeof t)return t;var e="";return Array.isArray(t.inputs)?e+=t.inputs.map(function(t){return t.replace(s,"[$1]")}).join(""):"string"==typeof t.inputs&&(e+=t.inputs.replace(s,"[$1]")),e+=t.filter,t.options&&("string"==typeof t.options||"number"==typeof t.options?e+="="+t.options:Array.isArray(t.options)?e+="="+t.options.map(function(t){return"string"==typeof t&&t.match(a)?"'"+t+"'":t}).join(":"):Object.keys(t.options).length&&(e+="="+Object.keys(t.options).map(function(e){var n=t.options[e];return"string"==typeof n&&n.match(a)&&(n="'"+n+"'"),e+"="+n}).join(":"))),Array.isArray(t.outputs)?e+=t.outputs.map(function(t){return t.replace(s,"[$1]")}).join(""):"string"==typeof t.outputs&&(e+=t.outputs.replace(s,"[$1]")),e})},which:function(t,e){if(t in u)return e(null,u[t]);o(t,function(n,r){if(n)return e(null,u[t]="");e(null,u[t]=r)})},timemarkToSeconds:function(t){if("number"==typeof t)return t;if(-1===t.indexOf(":")&&t.indexOf(".")>=0)return Number(t);var e=t.split(":"),n=Number(e.pop());return e.length&&(n+=60*Number(e.pop())),e.length&&(n+=3600*Number(e.pop())),n},extractCodecData:function(t,e,n){"inputStack"in n||(n.inputStack=[],n.inputIndex=-1,n.inInput=!1);var r,o,i,s,a=n.inputStack,u=n.inputIndex,c=n.inInput;if(r=e.match(/Input #[0-9]+, ([^ ]+),/))c=n.inInput=!0,a[u=n.inputIndex=n.inputIndex+1]={format:r[1],audio:"",video:"",duration:""};else if(c&&(o=e.match(/Duration\: ([^,]+)/)))a[u].duration=o[1];else if(c&&(i=e.match(/Audio\: (.*)/)))i=i[1].split(", "),a[u].audio=i[0],a[u].audio_details=i;else if(c&&(s=e.match(/Video\: (.*)/)))s=s[1].split(", "),a[u].video=s[0],a[u].video_details=s;else if(/Output #\d+/.test(e))c=n.inInput=!1;else if(/Stream mapping:|Press (\[q\]|ctrl-c) to stop/.test(e))return t.emit.apply(t,["codecData"].concat(a)),!0;return!1},extractProgress:function(t,e){var n=function(t){for(var e={},n=(t=t.replace(/=\s+/g,"=").trim()).split(" "),r=0;r<n.length;r++){var o=n[r].split("=",2),i=o[0],s=o[1];if(void 0===s)return null;e[i]=s}return e}(e);if(n){var r={frames:parseInt(n.frame,10),currentFps:parseInt(n.fps,10),currentKbps:n.bitrate?parseFloat(n.bitrate.replace("kbits/s","")):0,targetSize:parseInt(n.size||n.Lsize,10),timemark:n.time};if(t._ffprobeData&&t._ffprobeData.format&&t._ffprobeData.format.duration){var o=Number(t._ffprobeData.format.duration);isNaN(o)||(r.percent=c.timemarkToSeconds(r.timemark)/o*100)}t.emit("progress",r)}},extractError:function(t){return t.split(i).reduce(function(t,e){return" "===e.charAt(0)||"["===e.charAt(0)?[]:(t.push(e),t)},[]).join("\n")},linesRing:function(t){var e=[],n=[],r=null,o=!1,s=t-1;function a(t){e.forEach(function(e){e(t)})}return{callback:function(t){n.forEach(function(e){t(e)}),e.push(t)},append:function(t){if(!o&&(t instanceof Buffer&&(t=""+t),t&&0!==t.length)){var e=t.split(i);1===e.length?null!==r?r+=e.shift():r=e.shift():(null!==r&&(a(r+=e.shift()),n.push(r)),r=e.pop(),e.forEach(function(t){a(t),n.push(t)}),s>-1&&n.length>s&&n.splice(0,n.length-s))}},get:function(){return null!==r?n.concat([r]).join("\n"):n.join("\n")},close:function(){o||(null!==r&&(a(r),n.push(r),s>-1&&n.length>s&&n.shift(),r=null),o=!0)}}}}},749:(t,e,n)=>{"use strict";var r=n(317).spawn,o=(n(928),n(896),n(589)),i=n(744);function s(t){t._inputs[0].isStream||t.ffprobe(0,function(e,n){t._ffprobeData=n})}t.exports=function(t){t._spawnFfmpeg=function(t,e,n,o){"function"==typeof e&&(o=n,n=e,e={}),void 0===o&&(o=n,n=function(){});var s="stdoutLines"in e?e.stdoutLines:this.options.stdoutLines;this._getFfmpegPath(function(a,u){if(a)return o(a);if(!u||0===u.length)return o(new Error("Cannot find ffmpeg"));e.niceness&&0!==e.niceness&&!i.isWindows&&(t.unshift("-n",e.niceness,u),u="nice");var c=i.linesRing(s),l=!1,p=i.linesRing(s),f=!1,d=r(u,t,e);d.stderr&&d.stderr.setEncoding("utf8"),d.on("error",function(t){o(t)});var h=null;function m(t){t&&(h=t),g&&(l||!e.captureStdout)&&f&&o(h,c,p)}var g=!1;d.on("exit",function(t,e){g=!0,e?m(new Error("ffmpeg was killed with signal "+e)):t?m(new Error("ffmpeg exited with code "+t)):m()}),e.captureStdout&&(d.stdout.on("data",function(t){c.append(t)}),d.stdout.on("close",function(){c.close(),l=!0,m()})),d.stderr.on("data",function(t){p.append(t)}),d.stderr.on("close",function(){p.close(),f=!0,m()}),n(d,c,p)})},t._getArguments=function(){var t=this._complexFilters.get(),e=this._outputs.some(function(t){return t.isFile});return[].concat(this._inputs.reduce(function(t,e){var n="string"==typeof e.source?e.source:"pipe:0";return t.concat(e.options.get(),["-i",n])},[]),this._global.get(),e?["-y"]:[],t,this._outputs.reduce(function(t,e){var n,r=i.makeFilterStrings(e.sizeFilters.get()),o=e.audioFilters.get(),s=e.videoFilters.get().concat(r);return n=e.target?"string"==typeof e.target?[e.target]:["pipe:1"]:[],t.concat(e.audio.get(),o.length?["-filter:a",o.join(",")]:[],e.video.get(),s.length?["-filter:v",s.join(",")]:[],e.options.get(),n)},[]))},t._prepare=function(t,e){var n=this;o.waterfall([function(t){n._checkCapabilities(t)},function(t){if(!e)return t();n.ffprobe(0,function(e,r){e||(n._ffprobeData=r),t()})},function(t){n._outputs.some(function(t){return t.flags.flvmeta&&!t.isFile&&(n.logger.warn("Updating flv metadata is only supported for files"),t.flags.flvmeta=!1),t.flags.flvmeta})?n._getFlvtoolPath(function(e){t(e)}):t()},function(t){var e;try{e=n._getArguments()}catch(e){return t(e)}t(null,e)},function(t,e){n.availableEncoders(function(n,r){for(var o=0;o<t.length;o++)"-acodec"!==t[o]&&"-vcodec"!==t[o]||(o++,t[o]in r&&r[t[o]].experimental&&(t.splice(o+1,0,"-strict","experimental"),o+=2));e(null,t)})}],t),e||(this.listeners("progress").length>0?s(this):this.once("newListener",function(t){"progress"===t&&s(this)}))},t.exec=t.execute=t.run=function(){var t=this;if(!this._outputs.some(function(t){return"target"in t}))throw new Error("No output specified");var e=this._outputs.filter(function(t){return"string"!=typeof t.target})[0],n=this._inputs.filter(function(t){return"string"!=typeof t.source})[0],s=!1;function a(e,n,r){s||(s=!0,e?t.emit("error",e,n,r):t.emit("end",n,r))}return t._prepare(function(s,u){if(s)return a(s);t._spawnFfmpeg(u,{captureStdout:!e,niceness:t.options.niceness,cwd:t.options.cwd,windowsHide:!0},function(r,o,s){if(t.ffmpegProc=r,t.emit("start","ffmpeg "+u.join(" ")),n&&(n.source.on("error",function(t){var e=new Error("Input stream error: "+t.message);e.inputStreamError=t,a(e),r.kill()}),n.source.resume(),n.source.pipe(r.stdin),r.stdin.on("error",function(){})),t.options.timeout&&(t.processTimer=setTimeout(function(){var e="process ran into a timeout ("+t.options.timeout+"s)";a(new Error(e),o.get(),s.get()),r.kill()},1e3*t.options.timeout)),e&&(r.stdout.pipe(e.target,e.pipeopts),e.target.on("close",function(){t.logger.debug("Output stream closed, scheduling kill for ffmpeg process"),setTimeout(function(){a(new Error("Output stream closed")),r.kill()},20)}),e.target.on("error",function(e){t.logger.debug("Output stream error, killing ffmpeg process");var n=new Error("Output stream error: "+e.message);n.outputStreamError=e,a(n,o.get(),s.get()),r.kill("SIGKILL")})),s){if(t.listeners("stderr").length&&s.callback(function(e){t.emit("stderr",e)}),t.listeners("codecData").length){var c=!1,l={};s.callback(function(e){c||(c=i.extractCodecData(t,e,l))})}t.listeners("progress").length&&s.callback(function(e){i.extractProgress(t,e)})}},function(e,n,s){if(clearTimeout(t.processTimer),delete t.ffmpegProc,e)e.message.match(/ffmpeg exited with code/)&&(e.message+=": "+i.extractError(s.get())),a(e,n.get(),s.get());else{var u=t._outputs.filter(function(t){return t.flags.flvmeta});u.length?t._getFlvtoolPath(function(t,e){if(t)return a(t);o.each(u,function(t,n){r(e,["-U",t.target],{windowsHide:!0}).on("error",function(r){n(new Error("Error running "+e+" on "+t.target+": "+r.message))}).on("exit",function(r,o){0!==r||o?n(new Error(e+" "+(o?"received signal "+o:"exited with code "+r))+" when running on "+t.target):n()})},function(t){t?a(t):a(null,n.get(),s.get())})}):a(null,n.get(),s.get())}})}),this},t.renice=function(t){if(!i.isWindows&&(((t=t||0)<-20||t>20)&&this.logger.warn("Invalid niceness value: "+t+", must be between -20 and 20"),t=Math.min(20,Math.max(-20,t)),this.options.niceness=t,this.ffmpegProc)){var e=this.logger,n=this.ffmpegProc.pid,o=r("renice",[t,"-p",n],{windowsHide:!0});o.on("error",function(t){e.warn("could not renice process "+n+": "+t.message)}),o.on("exit",function(r,o){o?e.warn("could not renice process "+n+": renice was killed by signal "+o):r?e.warn("could not renice process "+n+": renice exited with "+r):e.info("successfully reniced process "+n+" to "+t+" niceness")})}return this},t.kill=function(t){return this.ffmpegProc?this.ffmpegProc.kill(t||"SIGKILL"):this.logger.warn("No running ffmpeg process, cannot send signal"),this}}},751:(t,e,n)=>{"use strict";var r=n(744);t.exports=function(t){t.mergeAdd=t.addInput=t.input=function(t){var e=!1,n=!1;if("string"!=typeof t){if(!("readable"in t)||!t.readable)throw new Error("Invalid input");if(this._inputs.some(function(t){return t.isStream}))throw new Error("Only one input stream is supported");n=!0,t.pause()}else{var o=t.match(/^([a-z]{2,}):/i);e=!o||"file"===o[0]}return this._inputs.push(this._currentInput={source:t,isFile:e,isStream:n,options:r.args()}),this},t.withInputFormat=t.inputFormat=t.fromFormat=function(t){if(!this._currentInput)throw new Error("No input specified");return this._currentInput.options("-f",t),this},t.withInputFps=t.withInputFPS=t.withFpsInput=t.withFPSInput=t.inputFPS=t.inputFps=t.fpsInput=t.FPSInput=function(t){if(!this._currentInput)throw new Error("No input specified");return this._currentInput.options("-r",t),this},t.nativeFramerate=t.withNativeFramerate=t.native=function(){if(!this._currentInput)throw new Error("No input specified");return this._currentInput.options("-re"),this},t.setStartTime=t.seekInput=function(t){if(!this._currentInput)throw new Error("No input specified");return this._currentInput.options("-ss",t),this},t.loop=function(t){if(!this._currentInput)throw new Error("No input specified");return this._currentInput.options("-loop","1"),void 0!==t&&this.duration(t),this}}},760:t=>{"use strict";t.exports=require("node:path")},770:(t,e,n)=>{"use strict";var r=n(928);t.exports=function(t){t.usingPreset=t.preset=function(t){if("function"==typeof t)t(this);else try{var e=r.join(this.options.presets,t),n=require(e);if("function"!=typeof n.load)throw new Error("preset "+e+" has no load() function");n.load(this)}catch(t){throw new Error("preset "+e+" could not be loaded: "+t.message)}return this}}},813:(t,e,n)=>{var r;function o(t,e,n){if("function"==typeof e&&(n=e,e={}),!n){if("function"!=typeof Promise)throw new TypeError("callback not provided");return new Promise(function(n,r){o(t,e||{},function(t,e){t?r(t):n(e)})})}r(t,e||{},function(t,r){t&&("EACCES"===t.code||e&&e.ignoreErrors)&&(t=null,r=!1),n(t,r)})}n(896),r="win32"===process.platform||global.TESTING_WINDOWS?n(824):n(590),t.exports=o,o.sync=function(t,e){try{return r.sync(t,e||{})}catch(t){if(e&&e.ignoreErrors||"EACCES"===t.code)return!1;throw t}}},824:(t,e,n)=>{t.exports=i,i.sync=function(t,e){return o(r.statSync(t),t,e)};var r=n(896);function o(t,e,n){return!(!t.isSymbolicLink()&&!t.isFile())&&function(t,e){var n=void 0!==e.pathExt?e.pathExt:process.env.PATHEXT;if(!n)return!0;if(-1!==(n=n.split(";")).indexOf(""))return!0;for(var r=0;r<n.length;r++){var o=n[r].toLowerCase();if(o&&t.substr(-o.length).toLowerCase()===o)return!0}return!1}(e,n)}function i(t,e,n){r.stat(t,function(r,i){n(r,!r&&o(i,t,e))})}},857:t=>{"use strict";t.exports=require("os")},896:t=>{"use strict";t.exports=require("fs")},928:t=>{"use strict";t.exports=require("path")},982:(t,e,n)=>{"use strict";var r=n(896),o=n(928),i=n(203).PassThrough,s=n(589),a=n(744);t.exports=function(t){t.saveToFile=t.save=function(t){return this.output(t).run(),this},t.writeToStream=t.pipe=t.stream=function(t,e){if(t&&!("writable"in t)&&(e=t,t=void 0),!t){if(process.version.match(/v0\.8\./))throw new Error("PassThrough stream is not supported on node v0.8");t=new i}return this.output(t,e).run(),t},t.takeScreenshots=t.thumbnail=t.thumbnails=t.screenshot=t.screenshots=function(t,e){var n,i=this,u=this._currentInput.source;if("number"==typeof(t=t||{count:1})&&(t={count:t}),"folder"in t||(t.folder=e||"."),"timestamps"in t&&(t.timemarks=t.timestamps),!("timemarks"in t)){if(!t.count)throw new Error("Cannot take screenshots: neither a count nor a timemark list are specified");var c=100/(1+t.count);t.timemarks=[];for(var l=0;l<t.count;l++)t.timemarks.push(c*(l+1)+"%")}if("size"in t){var p=t.size.match(/^(\d+)x(\d+)$/),f=t.size.match(/^(\d+)x\?$/),d=t.size.match(/^\?x(\d+)$/),h=t.size.match(/^(\d+)%$/);if(!(p||f||d||h))throw new Error("Invalid size parameter: "+t.size)}function m(t){n?t(null,n):i.ffprobe(function(e,r){n=r,t(e,r)})}return s.waterfall([function(e){if(t.timemarks.some(function(t){return(""+t).match(/^[\d.]+%$/)})){if("string"!=typeof u)return e(new Error("Cannot compute screenshot timemarks with an input stream, please specify fixed timemarks"));m(function(n,r){if(n)e(n);else{var o=r.streams.reduce(function(t,e){return"video"===e.codec_type&&e.width*e.height>t.width*t.height?e:t},{width:0,height:0});if(0===o.width)return e(new Error("No video stream in input, cannot take screenshots"));var i=Number(o.duration);if(isNaN(i)&&(i=Number(r.format.duration)),isNaN(i))return e(new Error("Could not get input duration, please specify fixed timemarks"));t.timemarks=t.timemarks.map(function(t){return(""+t).match(/^([\d.]+)%$/)?i*parseFloat(t)/100:t}),e()}})}else e()},function(e){t.timemarks=t.timemarks.map(function(t){return a.timemarkToSeconds(t)}).sort(function(t,e){return t-e}),e()},function(e){var n=t.filename||"tn.png";if(-1===n.indexOf(".")&&(n+=".png"),t.timemarks.length>1&&!n.match(/%(s|0*i)/)){var r=o.extname(n);n=o.join(o.dirname(n),o.basename(n,r)+"_%i"+r)}e(null,n)},function(t,e){if(t.match(/%[bf]/)){if("string"!=typeof u)return e(new Error("Cannot replace %f or %b when using an input stream"));t=t.replace(/%f/g,o.basename(u)).replace(/%b/g,o.basename(u,o.extname(u)))}e(null,t)},function(t,e){if(t.match(/%[whr]/)){if(p)return e(null,t,p[1],p[2]);m(function(n,r){if(n)return e(new Error("Could not determine video resolution to replace %w, %h or %r"));var o=r.streams.reduce(function(t,e){return"video"===e.codec_type&&e.width*e.height>t.width*t.height?e:t},{width:0,height:0});if(0===o.width)return e(new Error("No video stream in input, cannot replace %w, %h or %r"));var i=o.width,s=o.height;f?(s=s*Number(f[1])/i,i=Number(f[1])):d?(i=i*Number(d[1])/s,s=Number(d[1])):h&&(i=i*Number(h[1])/100,s=s*Number(h[1])/100),e(null,t,2*Math.round(i/2),2*Math.round(s/2))})}else e(null,t,-1,-1)},function(t,e,n,r){r(null,t=t.replace(/%r/g,"%wx%h").replace(/%w/g,e).replace(/%h/g,n))},function(e,n){var r=t.timemarks.map(function(t,n){return e.replace(/%s/g,a.timemarkToSeconds(t)).replace(/%(0*)i/g,function(t,e){var r=""+(n+1);return e.substr(0,Math.max(0,e.length+1-r.length))+r})});i.emit("filenames",r),n(null,r)},function(e,n){r.exists(t.folder,function(o){o?n(null,e):r.mkdir(t.folder,function(t){t?n(t):n(null,e)})})}],function(e,n){if(e)return i.emit("error",e);var r,s=t.timemarks.length,a=[r={filter:"split",options:s,outputs:[]}];if("size"in t){i.size(t.size);var u=i._currentOutput.sizeFilters.get().map(function(t,e){return e>0&&(t.inputs="size"+(e-1)),t.outputs="size"+e,t});r.inputs="size"+(u.length-1),a=u.concat(a),i._currentOutput.sizeFilters.clear()}for(var c=0,l=0;l<s;l++){var p="screen"+l;r.outputs.push(p),0===l&&(c=t.timemarks[l],i.seekInput(c)),i.output(o.join(t.folder,n[l])).frames(1).map(p),l>0&&i.seek(t.timemarks[l]-c)}i.complexFilter(a),i.run()}),this},t.mergeToFile=t.concatenate=t.concat=function(t,e){var n=this._inputs.filter(function(t){return!t.isStream})[0],r=this;return this.ffprobe(this._inputs.indexOf(n),function(n,o){if(n)return r.emit("error",n);var i=o.streams.some(function(t){return"audio"===t.codec_type}),s=o.streams.some(function(t){return"video"===t.codec_type});r.output(t,e).complexFilter({filter:"concat",options:{n:r._inputs.length,v:s?1:0,a:i?1:0}}).run()}),this}}},986:(t,e,n)=>{"use strict";var r=n(744);t.exports=function(t){t.withNoAudio=t.noAudio=function(){return this._currentOutput.audio.clear(),this._currentOutput.audioFilters.clear(),this._currentOutput.audio("-an"),this},t.withAudioCodec=t.audioCodec=function(t){return this._currentOutput.audio("-acodec",t),this},t.withAudioBitrate=t.audioBitrate=function(t){return this._currentOutput.audio("-b:a",(""+t).replace(/k?$/,"k")),this},t.withAudioChannels=t.audioChannels=function(t){return this._currentOutput.audio("-ac",t),this},t.withAudioFrequency=t.audioFrequency=function(t){return this._currentOutput.audio("-ar",t),this},t.withAudioQuality=t.audioQuality=function(t){return this._currentOutput.audio("-aq",t),this},t.withAudioFilter=t.withAudioFilters=t.audioFilter=t.audioFilters=function(t){return arguments.length>1&&(t=[].slice.call(arguments)),Array.isArray(t)||(t=[t]),this._currentOutput.audioFilters(r.makeFilterStrings(t)),this}}},995:(t,e,n)=>{var r=n(928),o=n(317).spawn,i=n(63)("electron-squirrel-startup"),s=n(157).app,a=function(t,e){var n=r.resolve(r.dirname(process.execPath),"..","Update.exe");i("Spawning `%s` with args `%s`",n,t),o(n,t,{detached:!0}).on("close",e)};t.exports=function(){if("win32"===process.platform){var t=process.argv[1];i("processing squirrel command `%s`",t);var e=r.basename(process.execPath);if("--squirrel-install"===t||"--squirrel-updated"===t)return a(["--createShortcut="+e],s.quit),!0;if("--squirrel-uninstall"===t)return a(["--removeShortcut="+e],s.quit),!0;if("--squirrel-obsolete"===t)return s.quit(),!0}return!1}()}},e={};function n(r){var o=e[r];if(void 0!==o)return o.exports;var i=e[r]={exports:{}};return t[r](i,i.exports,n),i.exports}void 0!==n&&(n.ab=__dirname+"/native_modules/");const{app:r,BrowserWindow:o,ipcMain:i,dialog:s,session:a,protocol:u}=n(157),c=n(24);let l;n(760),n(995)&&r.quit(),u.registerSchemesAsPrivileged([{scheme:"local-media",privileges:{standard:!0,secure:!0,stream:!0,supportFetchAPI:!0,corsEnabled:!0}}]);const p=()=>{l=new o({width:1400,height:900,minWidth:1e3,minHeight:600,webPreferences:{preload:require("path").resolve(__dirname,"../renderer","main_window","preload.js"),contextIsolation:!0,nodeIntegration:!1}}),a.defaultSession.webRequest.onHeadersReceived((t,e)=>{const n={...t.responseHeaders};for(const t of Object.keys(n))"content-security-policy"===t.toLowerCase()&&delete n[t];const r="default-src 'self' 'unsafe-inline' data:; media-src 'self' local-media: file: data: blob:; img-src 'self' local-media: file: data: blob:; script-src 'self' 'unsafe-inline' 'unsafe-eval'; style-src 'self' 'unsafe-inline';";n["Content-Security-Policy"]=[r],"mainFrame"===t.resourceType&&console.log("[CSP] Applied CSP to mainFrame:",r),e({responseHeaders:n})}),l.loadURL(`file://${require("path").resolve(__dirname,"..","renderer","main_window","index.html")}`),l.webContents.openDevTools(),l.on("closed",()=>{l=null})},f=n(653),d=n(734);i.handle("read-metadata",async(t,e)=>{try{console.log("[IPC] read-metadata request received for:",e);const t=await f.getMetadata(e);return console.log("[IPC] Metadata extracted successfully, returning to renderer"),{success:!0,data:t}}catch(t){return console.error("[IPC] Error reading metadata:",{errorType:t.message,userMessage:t.userMessage,filePath:e}),{success:!1,error:{type:t.message||"UNKNOWN_ERROR",message:t.userMessage||"Failed to read video file",details:t.details||t.message}}}}),i.handle("select-file",async t=>{const e=await s.showOpenDialog(l,{properties:["openFile","multiSelections"],filters:[{name:"Videos",extensions:["mp4","mov","webm"]},{name:"All Files",extensions:["*"]}]});return e.canceled?[]:e.filePaths}),i.handle("export-timeline",async(t,{clips:e,outputPath:n})=>{try{return console.log("[IPC] export-timeline request received",{clipsCount:e.length,outputPath:n}),await d.exportTimeline(e,n,t=>{l.webContents.send("export-progress",t)}),console.log("[IPC] Export completed successfully"),{success:!0,outputPath:n}}catch(t){return console.error("[IPC] Export failed:",{errorType:t.message,userMessage:t.userMessage,outputPath:n}),{success:!1,error:{type:t.message||"EXPORT_FAILED",message:t.userMessage||"Export failed",details:t.details||t.message}}}}),i.handle("select-save-location",async()=>{try{const t=await s.showSaveDialog(l,{title:"Save Video As",defaultPath:"ClipForge_Export.mp4",filters:[{name:"MP4 Video",extensions:["mp4"]},{name:"All Files",extensions:["*"]}]});return t.canceled?{canceled:!0}:{canceled:!1,filePath:t.filePath}}catch(t){return console.error("[IPC] Save dialog error:",t),{canceled:!0,error:t.message}}}),r.whenReady().then(()=>{try{u.registerFileProtocol("local-media",(t,e)=>{const n=t.url||"",r=decodeURIComponent(n.replace("local-media://","")),o=c.existsSync(r);console.log("[Protocol][local-media] Request",{url:n,filePath:r,exists:o}),o||console.error("[Protocol][local-media] File does not exist",r),e({path:r})}),console.log("[Protocol][local-media] Protocol registered")}catch(t){console.error("[Protocol][local-media] Registration failed",t)}try{const t=n(85),{getFFmpegPath:e,getFFprobePath:r}=n(418),o=e(),i=r();console.log("[FFmpeg] Resolved binary paths",{ffmpegPath:o,ffprobePath:i}),t.setFfmpegPath(o),t.setFfprobePath(i),console.log("[FFmpeg] Paths configured successfully"),t.getAvailableFormats((t,e)=>{if(t)return void console.error("[FFmpeg] Availability check failed",{message:t.message,code:t.code,errno:t.errno,path:t.path,spawnargs:t.spawnargs});const n=Object.keys(e).length,r=Object.keys(e).slice(0,5);console.log("[FFmpeg] Formats available",n),console.debug("[FFmpeg] Sample formats",r)})}catch(t){console.error("[FFmpeg] Setup failed",{message:t.message,stack:t.stack,code:t.code})}p(),r.on("activate",()=>{0===o.getAllWindows().length&&p()})}),r.on("window-all-closed",()=>{"darwin"!==process.platform&&r.quit()}),module.exports={}})();
//# sourceMappingURL=index.js.map