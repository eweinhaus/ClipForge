{"version":3,"file":"index.js","mappings":"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","sources":["webpack://clipforge/./node_modules/fluent-ffmpeg/lib/options/output.js","webpack://clipforge/external node-commonjs \"tty\"","webpack://clipforge/external node-commonjs \"util\"","webpack://clipforge/external node-commonjs \"node:fs\"","webpack://clipforge/./node_modules/electron-squirrel-startup/node_modules/debug/src/index.js","webpack://clipforge/./node_modules/fluent-ffmpeg/index.js","webpack://clipforge/./node_modules/fluent-ffmpeg/lib/fluent-ffmpeg.js","webpack://clipforge/external node-commonjs \"electron\"","webpack://clipforge/external node-commonjs \"stream\"","webpack://clipforge/./node_modules/fluent-ffmpeg/lib/options/custom.js","webpack://clipforge/external node-commonjs \"net\"","webpack://clipforge/external node-commonjs \"child_process\"","webpack://clipforge/./electron/utils/ffmpegPath.js","webpack://clipforge/./node_modules/fluent-ffmpeg/lib/options/videosize.js","webpack://clipforge/external node-commonjs \"events\"","webpack://clipforge/./node_modules/electron-squirrel-startup/node_modules/debug/src/node.js","webpack://clipforge/./node_modules/electron-squirrel-startup/node_modules/debug/src/browser.js","webpack://clipforge/./node_modules/electron-squirrel-startup/node_modules/ms/index.js","webpack://clipforge/./node_modules/electron-squirrel-startup/node_modules/debug/src/debug.js","webpack://clipforge/./node_modules/async/lib/async.js","webpack://clipforge/./node_modules/isexe/mode.js","webpack://clipforge/./node_modules/fluent-ffmpeg/lib/options/video.js","webpack://clipforge/./node_modules/fluent-ffmpeg/node_modules/which/which.js","webpack://clipforge/./node_modules/fluent-ffmpeg/lib/ffprobe.js","webpack://clipforge/./electron/fileManager.js","webpack://clipforge/./node_modules/fluent-ffmpeg/lib/capabilities.js","webpack://clipforge/./electron/mediaProcessor.js","webpack://clipforge/./node_modules/fluent-ffmpeg/lib/utils.js","webpack://clipforge/./node_modules/fluent-ffmpeg/lib/processor.js","webpack://clipforge/./node_modules/fluent-ffmpeg/lib/options/inputs.js","webpack://clipforge/external node-commonjs \"node:path\"","webpack://clipforge/./node_modules/fluent-ffmpeg/lib/options/misc.js","webpack://clipforge/./node_modules/isexe/index.js","webpack://clipforge/./node_modules/isexe/windows.js","webpack://clipforge/external node-commonjs \"os\"","webpack://clipforge/external node-commonjs \"fs\"","webpack://clipforge/external node-commonjs \"path\"","webpack://clipforge/./node_modules/fluent-ffmpeg/lib/recipes.js","webpack://clipforge/./node_modules/fluent-ffmpeg/lib/options/audio.js","webpack://clipforge/./node_modules/electron-squirrel-startup/index.js","webpack://clipforge/webpack/bootstrap","webpack://clipforge/webpack/runtime/compat","webpack://clipforge/./src/main.js"],"sourcesContent":["/*jshint node:true*/\n'use strict';\n\nvar utils = require('../utils');\n\n\n/*\n *! Output-related methods\n */\n\nmodule.exports = function(proto) {\n  /**\n   * Add output\n   *\n   * @method FfmpegCommand#output\n   * @category Output\n   * @aliases addOutput\n   *\n   * @param {String|Writable} target target file path or writable stream\n   * @param {Object} [pipeopts={}] pipe options (only applies to streams)\n   * @return FfmpegCommand\n   */\n  proto.addOutput =\n  proto.output = function(target, pipeopts) {\n    var isFile = false;\n\n    if (!target && this._currentOutput) {\n      // No target is only allowed when called from constructor\n      throw new Error('Invalid output');\n    }\n\n    if (target && typeof target !== 'string') {\n      if (!('writable' in target) || !(target.writable)) {\n        throw new Error('Invalid output');\n      }\n    } else if (typeof target === 'string') {\n      var protocol = target.match(/^([a-z]{2,}):/i);\n      isFile = !protocol || protocol[0] === 'file';\n    }\n\n    if (target && !('target' in this._currentOutput)) {\n      // For backwards compatibility, set target for first output\n      this._currentOutput.target = target;\n      this._currentOutput.isFile = isFile;\n      this._currentOutput.pipeopts = pipeopts || {};\n    } else {\n      if (target && typeof target !== 'string') {\n        var hasOutputStream = this._outputs.some(function(output) {\n          return typeof output.target !== 'string';\n        });\n\n        if (hasOutputStream) {\n          throw new Error('Only one output stream is supported');\n        }\n      }\n\n      this._outputs.push(this._currentOutput = {\n        target: target,\n        isFile: isFile,\n        flags: {},\n        pipeopts: pipeopts || {}\n      });\n\n      var self = this;\n      ['audio', 'audioFilters', 'video', 'videoFilters', 'sizeFilters', 'options'].forEach(function(key) {\n        self._currentOutput[key] = utils.args();\n      });\n\n      if (!target) {\n        // Call from constructor: remove target key\n        delete this._currentOutput.target;\n      }\n    }\n\n    return this;\n  };\n\n\n  /**\n   * Specify output seek time\n   *\n   * @method FfmpegCommand#seek\n   * @category Input\n   * @aliases seekOutput\n   *\n   * @param {String|Number} seek seek time in seconds or as a '[hh:[mm:]]ss[.xxx]' string\n   * @return FfmpegCommand\n   */\n  proto.seekOutput =\n  proto.seek = function(seek) {\n    this._currentOutput.options('-ss', seek);\n    return this;\n  };\n\n\n  /**\n   * Set output duration\n   *\n   * @method FfmpegCommand#duration\n   * @category Output\n   * @aliases withDuration,setDuration\n   *\n   * @param {String|Number} duration duration in seconds or as a '[[hh:]mm:]ss[.xxx]' string\n   * @return FfmpegCommand\n   */\n  proto.withDuration =\n  proto.setDuration =\n  proto.duration = function(duration) {\n    this._currentOutput.options('-t', duration);\n    return this;\n  };\n\n\n  /**\n   * Set output format\n   *\n   * @method FfmpegCommand#format\n   * @category Output\n   * @aliases toFormat,withOutputFormat,outputFormat\n   *\n   * @param {String} format output format name\n   * @return FfmpegCommand\n   */\n  proto.toFormat =\n  proto.withOutputFormat =\n  proto.outputFormat =\n  proto.format = function(format) {\n    this._currentOutput.options('-f', format);\n    return this;\n  };\n\n\n  /**\n   * Add stream mapping to output\n   *\n   * @method FfmpegCommand#map\n   * @category Output\n   *\n   * @param {String} spec stream specification string, with optional square brackets\n   * @return FfmpegCommand\n   */\n  proto.map = function(spec) {\n    this._currentOutput.options('-map', spec.replace(utils.streamRegexp, '[$1]'));\n    return this;\n  };\n\n\n  /**\n   * Run flvtool2/flvmeta on output\n   *\n   * @method FfmpegCommand#flvmeta\n   * @category Output\n   * @aliases updateFlvMetadata\n   *\n   * @return FfmpegCommand\n   */\n  proto.updateFlvMetadata =\n  proto.flvmeta = function() {\n    this._currentOutput.flags.flvmeta = true;\n    return this;\n  };\n};\n","module.exports = require(\"tty\");","module.exports = require(\"util\");","module.exports = require(\"node:fs\");","/**\n * Detect Electron renderer process, which is node, but we should\n * treat as a browser.\n */\n\nif (typeof process !== 'undefined' && process.type === 'renderer') {\n  module.exports = require('./browser.js');\n} else {\n  module.exports = require('./node.js');\n}\n","module.exports = require('./lib/fluent-ffmpeg');\n",null,"module.exports = require(\"electron\");","module.exports = require(\"stream\");","/*jshint node:true*/\n'use strict';\n\nvar utils = require('../utils');\n\n\n/*\n *! Custom options methods\n */\n\nmodule.exports = function(proto) {\n  /**\n   * Add custom input option(s)\n   *\n   * When passing a single string or an array, each string containing two\n   * words is split (eg. inputOptions('-option value') is supported) for\n   * compatibility reasons.  This is not the case when passing more than\n   * one argument.\n   *\n   * @example\n   * command.inputOptions('option1');\n   *\n   * @example\n   * command.inputOptions('option1', 'option2');\n   *\n   * @example\n   * command.inputOptions(['option1', 'option2']);\n   *\n   * @method FfmpegCommand#inputOptions\n   * @category Custom options\n   * @aliases addInputOption,addInputOptions,withInputOption,withInputOptions,inputOption\n   *\n   * @param {...String} options option string(s) or string array\n   * @return FfmpegCommand\n   */\n  proto.addInputOption =\n  proto.addInputOptions =\n  proto.withInputOption =\n  proto.withInputOptions =\n  proto.inputOption =\n  proto.inputOptions = function(options) {\n    if (!this._currentInput) {\n      throw new Error('No input specified');\n    }\n\n    var doSplit = true;\n\n    if (arguments.length > 1) {\n      options = [].slice.call(arguments);\n      doSplit = false;\n    }\n\n    if (!Array.isArray(options)) {\n      options = [options];\n    }\n\n    this._currentInput.options(options.reduce(function(options, option) {\n      var split = String(option).split(' ');\n\n      if (doSplit && split.length === 2) {\n        options.push(split[0], split[1]);\n      } else {\n        options.push(option);\n      }\n\n      return options;\n    }, []));\n    return this;\n  };\n\n\n  /**\n   * Add custom output option(s)\n   *\n   * @example\n   * command.outputOptions('option1');\n   *\n   * @example\n   * command.outputOptions('option1', 'option2');\n   *\n   * @example\n   * command.outputOptions(['option1', 'option2']);\n   *\n   * @method FfmpegCommand#outputOptions\n   * @category Custom options\n   * @aliases addOutputOption,addOutputOptions,addOption,addOptions,withOutputOption,withOutputOptions,withOption,withOptions,outputOption\n   *\n   * @param {...String} options option string(s) or string array\n   * @return FfmpegCommand\n   */\n  proto.addOutputOption =\n  proto.addOutputOptions =\n  proto.addOption =\n  proto.addOptions =\n  proto.withOutputOption =\n  proto.withOutputOptions =\n  proto.withOption =\n  proto.withOptions =\n  proto.outputOption =\n  proto.outputOptions = function(options) {\n    var doSplit = true;\n\n    if (arguments.length > 1) {\n      options = [].slice.call(arguments);\n      doSplit = false;\n    }\n\n    if (!Array.isArray(options)) {\n      options = [options];\n    }\n\n    this._currentOutput.options(options.reduce(function(options, option) {\n      var split = String(option).split(' ');\n\n      if (doSplit && split.length === 2) {\n        options.push(split[0], split[1]);\n      } else {\n        options.push(option);\n      }\n\n      return options;\n    }, []));\n    return this;\n  };\n\n\n  /**\n   * Specify a complex filtergraph\n   *\n   * Calling this method will override any previously set filtergraph, but you can set\n   * as many filters as needed in one call.\n   *\n   * @example <caption>Overlay an image over a video (using a filtergraph string)</caption>\n   *   ffmpeg()\n   *     .input('video.avi')\n   *     .input('image.png')\n   *     .complexFilter('[0:v][1:v]overlay[out]', ['out']);\n   *\n   * @example <caption>Overlay an image over a video (using a filter array)</caption>\n   *   ffmpeg()\n   *     .input('video.avi')\n   *     .input('image.png')\n   *     .complexFilter([{\n   *       filter: 'overlay',\n   *       inputs: ['0:v', '1:v'],\n   *       outputs: ['out']\n   *     }], ['out']);\n   *\n   * @example <caption>Split video into RGB channels and output a 3x1 video with channels side to side</caption>\n   *  ffmpeg()\n   *    .input('video.avi')\n   *    .complexFilter([\n   *      // Duplicate video stream 3 times into streams a, b, and c\n   *      { filter: 'split', options: '3', outputs: ['a', 'b', 'c'] },\n   *\n   *      // Create stream 'red' by cancelling green and blue channels from stream 'a'\n   *      { filter: 'lutrgb', options: { g: 0, b: 0 }, inputs: 'a', outputs: 'red' },\n   *\n   *      // Create stream 'green' by cancelling red and blue channels from stream 'b'\n   *      { filter: 'lutrgb', options: { r: 0, b: 0 }, inputs: 'b', outputs: 'green' },\n   *\n   *      // Create stream 'blue' by cancelling red and green channels from stream 'c'\n   *      { filter: 'lutrgb', options: { r: 0, g: 0 }, inputs: 'c', outputs: 'blue' },\n   *\n   *      // Pad stream 'red' to 3x width, keeping the video on the left, and name output 'padded'\n   *      { filter: 'pad', options: { w: 'iw*3', h: 'ih' }, inputs: 'red', outputs: 'padded' },\n   *\n   *      // Overlay 'green' onto 'padded', moving it to the center, and name output 'redgreen'\n   *      { filter: 'overlay', options: { x: 'w', y: 0 }, inputs: ['padded', 'green'], outputs: 'redgreen'},\n   *\n   *      // Overlay 'blue' onto 'redgreen', moving it to the right\n   *      { filter: 'overlay', options: { x: '2*w', y: 0 }, inputs: ['redgreen', 'blue']},\n   *    ]);\n   *\n   * @method FfmpegCommand#complexFilter\n   * @category Custom options\n   * @aliases filterGraph\n   *\n   * @param {String|Array} spec filtergraph string or array of filter specification\n   *   objects, each having the following properties:\n   * @param {String} spec.filter filter name\n   * @param {String|Array} [spec.inputs] (array of) input stream specifier(s) for the filter,\n   *   defaults to ffmpeg automatically choosing the first unused matching streams\n   * @param {String|Array} [spec.outputs] (array of) output stream specifier(s) for the filter,\n   *   defaults to ffmpeg automatically assigning the output to the output file\n   * @param {Object|String|Array} [spec.options] filter options, can be omitted to not set any options\n   * @param {Array} [map] (array of) stream specifier(s) from the graph to include in\n   *   ffmpeg output, defaults to ffmpeg automatically choosing the first matching streams.\n   * @return FfmpegCommand\n   */\n  proto.filterGraph =\n  proto.complexFilter = function(spec, map) {\n    this._complexFilters.clear();\n\n    if (!Array.isArray(spec)) {\n      spec = [spec];\n    }\n\n    this._complexFilters('-filter_complex', utils.makeFilterStrings(spec).join(';'));\n\n    if (Array.isArray(map)) {\n      var self = this;\n      map.forEach(function(streamSpec) {\n        self._complexFilters('-map', streamSpec.replace(utils.streamRegexp, '[$1]'));\n      });\n    } else if (typeof map === 'string') {\n      this._complexFilters('-map', map.replace(utils.streamRegexp, '[$1]'));\n    }\n\n    return this;\n  };\n};\n","module.exports = require(\"net\");","module.exports = require(\"child_process\");","const path = require('path');\nconst isDev = process.env.NODE_ENV === 'development';\nconst isMac = process.platform === 'darwin';\nconst arch = process.arch;\nconst fs = require('fs'); // Add this import\n\nfunction ensureExecutable(binaryPath, label) {\n  try {\n    fs.accessSync(binaryPath, fs.constants.X_OK);\n  } catch (err) {\n    if (err.code === 'EACCES') {\n      try {\n        fs.chmodSync(binaryPath, 0o755);\n        fs.accessSync(binaryPath, fs.constants.X_OK);\n        console.info(`[FFmpeg] Added execute permission to ${label} at ${binaryPath}`);\n      } catch (chmodErr) {\n        console.warn(`[FFmpeg] Failed to set execute permission for ${label} at ${binaryPath}`, chmodErr);\n      }\n    } else if (err.code === 'ENOENT') {\n      console.warn(`[FFmpeg] ${label} binary not found at ${binaryPath}`);\n    } else {\n      console.warn(`[FFmpeg] Unable to access ${label} at ${binaryPath}`, err);\n    }\n  }\n\n  return binaryPath;\n}\n\nfunction getFfmpegBinaryPath() {\n  const binaryPath = isDev\n    ? path.join(__dirname, '..', '..', '.webpack', 'main', 'resources', 'ffmpeg', `darwin-${arch}`, 'ffmpeg')\n    : path.join(process.resourcesPath, 'ffmpeg', `darwin-${arch}`, 'ffmpeg');\n  console.log(`[FFmpegPath] FFmpeg binary path: ${binaryPath} (isDev: ${isDev})`);\n  return ensureExecutable(binaryPath, 'ffmpeg');\n}\n\nfunction getFfprobeBinaryPath() {\n  const binaryPath = isDev\n    ? path.join(__dirname, '..', '..', '.webpack', 'main', 'resources', 'ffmpeg', `darwin-${arch}`, 'ffprobe')\n    : path.join(process.resourcesPath, 'ffmpeg', `darwin-${arch}`, 'ffprobe');\n  console.log(`[FFmpegPath] FFprobe binary path: ${binaryPath} (isDev: ${isDev})`);\n  return ensureExecutable(binaryPath, 'ffprobe');\n}\n\nmodule.exports = { getFfmpegBinaryPath, getFfprobeBinaryPath };\n","/*jshint node:true*/\n'use strict';\n\n/*\n *! Size helpers\n */\n\n\n/**\n * Return filters to pad video to width*height,\n *\n * @param {Number} width output width\n * @param {Number} height output height\n * @param {Number} aspect video aspect ratio (without padding)\n * @param {Number} color padding color\n * @return scale/pad filters\n * @private\n */\nfunction getScalePadFilters(width, height, aspect, color) {\n  /*\n    let a be the input aspect ratio, A be the requested aspect ratio\n\n    if a > A, padding is done on top and bottom\n    if a < A, padding is done on left and right\n   */\n\n  return [\n    /*\n      In both cases, we first have to scale the input to match the requested size.\n      When using computed width/height, we truncate them to multiples of 2\n     */\n    {\n      filter: 'scale',\n      options: {\n        w: 'if(gt(a,' + aspect + '),' + width + ',trunc(' + height + '*a/2)*2)',\n        h: 'if(lt(a,' + aspect + '),' + height + ',trunc(' + width + '/a/2)*2)'\n      }\n    },\n\n    /*\n      Then we pad the scaled input to match the target size\n      (here iw and ih refer to the padding input, i.e the scaled output)\n     */\n\n    {\n      filter: 'pad',\n      options: {\n        w: width,\n        h: height,\n        x: 'if(gt(a,' + aspect + '),0,(' + width + '-iw)/2)',\n        y: 'if(lt(a,' + aspect + '),0,(' + height + '-ih)/2)',\n        color: color\n      }\n    }\n  ];\n}\n\n\n/**\n * Recompute size filters\n *\n * @param {Object} output\n * @param {String} key newly-added parameter name ('size', 'aspect' or 'pad')\n * @param {String} value newly-added parameter value\n * @return filter string array\n * @private\n */\nfunction createSizeFilters(output, key, value) {\n  // Store parameters\n  var data = output.sizeData = output.sizeData || {};\n  data[key] = value;\n\n  if (!('size' in data)) {\n    // No size requested, keep original size\n    return [];\n  }\n\n  // Try to match the different size string formats\n  var fixedSize = data.size.match(/([0-9]+)x([0-9]+)/);\n  var fixedWidth = data.size.match(/([0-9]+)x\\?/);\n  var fixedHeight = data.size.match(/\\?x([0-9]+)/);\n  var percentRatio = data.size.match(/\\b([0-9]{1,3})%/);\n  var width, height, aspect;\n\n  if (percentRatio) {\n    var ratio = Number(percentRatio[1]) / 100;\n    return [{\n      filter: 'scale',\n      options: {\n        w: 'trunc(iw*' + ratio + '/2)*2',\n        h: 'trunc(ih*' + ratio + '/2)*2'\n      }\n    }];\n  } else if (fixedSize) {\n    // Round target size to multiples of 2\n    width = Math.round(Number(fixedSize[1]) / 2) * 2;\n    height = Math.round(Number(fixedSize[2]) / 2) * 2;\n\n    aspect = width / height;\n\n    if (data.pad) {\n      return getScalePadFilters(width, height, aspect, data.pad);\n    } else {\n      // No autopad requested, rescale to target size\n      return [{ filter: 'scale', options: { w: width, h: height }}];\n    }\n  } else if (fixedWidth || fixedHeight) {\n    if ('aspect' in data) {\n      // Specified aspect ratio\n      width = fixedWidth ? fixedWidth[1] : Math.round(Number(fixedHeight[1]) * data.aspect);\n      height = fixedHeight ? fixedHeight[1] : Math.round(Number(fixedWidth[1]) / data.aspect);\n\n      // Round to multiples of 2\n      width = Math.round(width / 2) * 2;\n      height = Math.round(height / 2) * 2;\n\n      if (data.pad) {\n        return getScalePadFilters(width, height, data.aspect, data.pad);\n      } else {\n        // No autopad requested, rescale to target size\n        return [{ filter: 'scale', options: { w: width, h: height }}];\n      }\n    } else {\n      // Keep input aspect ratio\n\n      if (fixedWidth) {\n        return [{\n          filter: 'scale',\n          options: {\n            w: Math.round(Number(fixedWidth[1]) / 2) * 2,\n            h: 'trunc(ow/a/2)*2'\n          }\n        }];\n      } else {\n        return [{\n          filter: 'scale',\n          options: {\n            w: 'trunc(oh*a/2)*2',\n            h: Math.round(Number(fixedHeight[1]) / 2) * 2\n          }\n        }];\n      }\n    }\n  } else {\n    throw new Error('Invalid size specified: ' + data.size);\n  }\n}\n\n\n/*\n *! Video size-related methods\n */\n\nmodule.exports = function(proto) {\n  /**\n   * Keep display aspect ratio\n   *\n   * This method is useful when converting an input with non-square pixels to an output format\n   * that does not support non-square pixels.  It rescales the input so that the display aspect\n   * ratio is the same.\n   *\n   * @method FfmpegCommand#keepDAR\n   * @category Video size\n   * @aliases keepPixelAspect,keepDisplayAspect,keepDisplayAspectRatio\n   *\n   * @return FfmpegCommand\n   */\n  proto.keepPixelAspect = // Only for compatibility, this is not about keeping _pixel_ aspect ratio\n  proto.keepDisplayAspect =\n  proto.keepDisplayAspectRatio =\n  proto.keepDAR = function() {\n    return this.videoFilters([\n      {\n        filter: 'scale',\n        options: {\n          w: 'if(gt(sar,1),iw*sar,iw)',\n          h: 'if(lt(sar,1),ih/sar,ih)'\n        }\n      },\n      {\n        filter: 'setsar',\n        options: '1'\n      }\n    ]);\n  };\n\n\n  /**\n   * Set output size\n   *\n   * The 'size' parameter can have one of 4 forms:\n   * - 'X%': rescale to xx % of the original size\n   * - 'WxH': specify width and height\n   * - 'Wx?': specify width and compute height from input aspect ratio\n   * - '?xH': specify height and compute width from input aspect ratio\n   *\n   * Note: both dimensions will be truncated to multiples of 2.\n   *\n   * @method FfmpegCommand#size\n   * @category Video size\n   * @aliases withSize,setSize\n   *\n   * @param {String} size size string, eg. '33%', '320x240', '320x?', '?x240'\n   * @return FfmpegCommand\n   */\n  proto.withSize =\n  proto.setSize =\n  proto.size = function(size) {\n    var filters = createSizeFilters(this._currentOutput, 'size', size);\n\n    this._currentOutput.sizeFilters.clear();\n    this._currentOutput.sizeFilters(filters);\n\n    return this;\n  };\n\n\n  /**\n   * Set output aspect ratio\n   *\n   * @method FfmpegCommand#aspect\n   * @category Video size\n   * @aliases withAspect,withAspectRatio,setAspect,setAspectRatio,aspectRatio\n   *\n   * @param {String|Number} aspect aspect ratio (number or 'X:Y' string)\n   * @return FfmpegCommand\n   */\n  proto.withAspect =\n  proto.withAspectRatio =\n  proto.setAspect =\n  proto.setAspectRatio =\n  proto.aspect =\n  proto.aspectRatio = function(aspect) {\n    var a = Number(aspect);\n    if (isNaN(a)) {\n      var match = aspect.match(/^(\\d+):(\\d+)$/);\n      if (match) {\n        a = Number(match[1]) / Number(match[2]);\n      } else {\n        throw new Error('Invalid aspect ratio: ' + aspect);\n      }\n    }\n\n    var filters = createSizeFilters(this._currentOutput, 'aspect', a);\n\n    this._currentOutput.sizeFilters.clear();\n    this._currentOutput.sizeFilters(filters);\n\n    return this;\n  };\n\n\n  /**\n   * Enable auto-padding the output\n   *\n   * @method FfmpegCommand#autopad\n   * @category Video size\n   * @aliases applyAutopadding,applyAutoPadding,applyAutopad,applyAutoPad,withAutopadding,withAutoPadding,withAutopad,withAutoPad,autoPad\n   *\n   * @param {Boolean} [pad=true] enable/disable auto-padding\n   * @param {String} [color='black'] pad color\n   */\n  proto.applyAutopadding =\n  proto.applyAutoPadding =\n  proto.applyAutopad =\n  proto.applyAutoPad =\n  proto.withAutopadding =\n  proto.withAutoPadding =\n  proto.withAutopad =\n  proto.withAutoPad =\n  proto.autoPad =\n  proto.autopad = function(pad, color) {\n    // Allow autopad(color)\n    if (typeof pad === 'string') {\n      color = pad;\n      pad = true;\n    }\n\n    // Allow autopad() and autopad(undefined, color)\n    if (typeof pad === 'undefined') {\n      pad = true;\n    }\n\n    var filters = createSizeFilters(this._currentOutput, 'pad', pad ? color || 'black' : false);\n\n    this._currentOutput.sizeFilters.clear();\n    this._currentOutput.sizeFilters(filters);\n\n    return this;\n  };\n};\n","module.exports = require(\"events\");","/**\n * Module dependencies.\n */\n\nvar tty = require('tty');\nvar util = require('util');\n\n/**\n * This is the Node.js implementation of `debug()`.\n *\n * Expose `debug()` as the module.\n */\n\nexports = module.exports = require('./debug');\nexports.init = init;\nexports.log = log;\nexports.formatArgs = formatArgs;\nexports.save = save;\nexports.load = load;\nexports.useColors = useColors;\n\n/**\n * Colors.\n */\n\nexports.colors = [6, 2, 3, 4, 5, 1];\n\n/**\n * Build up the default `inspectOpts` object from the environment variables.\n *\n *   $ DEBUG_COLORS=no DEBUG_DEPTH=10 DEBUG_SHOW_HIDDEN=enabled node script.js\n */\n\nexports.inspectOpts = Object.keys(process.env).filter(function (key) {\n  return /^debug_/i.test(key);\n}).reduce(function (obj, key) {\n  // camel-case\n  var prop = key\n    .substring(6)\n    .toLowerCase()\n    .replace(/_([a-z])/g, function (_, k) { return k.toUpperCase() });\n\n  // coerce string value into JS value\n  var val = process.env[key];\n  if (/^(yes|on|true|enabled)$/i.test(val)) val = true;\n  else if (/^(no|off|false|disabled)$/i.test(val)) val = false;\n  else if (val === 'null') val = null;\n  else val = Number(val);\n\n  obj[prop] = val;\n  return obj;\n}, {});\n\n/**\n * The file descriptor to write the `debug()` calls to.\n * Set the `DEBUG_FD` env variable to override with another value. i.e.:\n *\n *   $ DEBUG_FD=3 node script.js 3>debug.log\n */\n\nvar fd = parseInt(process.env.DEBUG_FD, 10) || 2;\n\nif (1 !== fd && 2 !== fd) {\n  util.deprecate(function(){}, 'except for stderr(2) and stdout(1), any other usage of DEBUG_FD is deprecated. Override debug.log if you want to use a different log function (https://git.io/debug_fd)')()\n}\n\nvar stream = 1 === fd ? process.stdout :\n             2 === fd ? process.stderr :\n             createWritableStdioStream(fd);\n\n/**\n * Is stdout a TTY? Colored output is enabled when `true`.\n */\n\nfunction useColors() {\n  return 'colors' in exports.inspectOpts\n    ? Boolean(exports.inspectOpts.colors)\n    : tty.isatty(fd);\n}\n\n/**\n * Map %o to `util.inspect()`, all on a single line.\n */\n\nexports.formatters.o = function(v) {\n  this.inspectOpts.colors = this.useColors;\n  return util.inspect(v, this.inspectOpts)\n    .split('\\n').map(function(str) {\n      return str.trim()\n    }).join(' ');\n};\n\n/**\n * Map %o to `util.inspect()`, allowing multiple lines if needed.\n */\n\nexports.formatters.O = function(v) {\n  this.inspectOpts.colors = this.useColors;\n  return util.inspect(v, this.inspectOpts);\n};\n\n/**\n * Adds ANSI color escape codes if enabled.\n *\n * @api public\n */\n\nfunction formatArgs(args) {\n  var name = this.namespace;\n  var useColors = this.useColors;\n\n  if (useColors) {\n    var c = this.color;\n    var prefix = '  \\u001b[3' + c + ';1m' + name + ' ' + '\\u001b[0m';\n\n    args[0] = prefix + args[0].split('\\n').join('\\n' + prefix);\n    args.push('\\u001b[3' + c + 'm+' + exports.humanize(this.diff) + '\\u001b[0m');\n  } else {\n    args[0] = new Date().toUTCString()\n      + ' ' + name + ' ' + args[0];\n  }\n}\n\n/**\n * Invokes `util.format()` with the specified arguments and writes to `stream`.\n */\n\nfunction log() {\n  return stream.write(util.format.apply(util, arguments) + '\\n');\n}\n\n/**\n * Save `namespaces`.\n *\n * @param {String} namespaces\n * @api private\n */\n\nfunction save(namespaces) {\n  if (null == namespaces) {\n    // If you set a process.env field to null or undefined, it gets cast to the\n    // string 'null' or 'undefined'. Just delete instead.\n    delete process.env.DEBUG;\n  } else {\n    process.env.DEBUG = namespaces;\n  }\n}\n\n/**\n * Load `namespaces`.\n *\n * @return {String} returns the previously persisted debug modes\n * @api private\n */\n\nfunction load() {\n  return process.env.DEBUG;\n}\n\n/**\n * Copied from `node/src/node.js`.\n *\n * XXX: It's lame that node doesn't expose this API out-of-the-box. It also\n * relies on the undocumented `tty_wrap.guessHandleType()` which is also lame.\n */\n\nfunction createWritableStdioStream (fd) {\n  var stream;\n  var tty_wrap = process.binding('tty_wrap');\n\n  // Note stream._type is used for test-module-load-list.js\n\n  switch (tty_wrap.guessHandleType(fd)) {\n    case 'TTY':\n      stream = new tty.WriteStream(fd);\n      stream._type = 'tty';\n\n      // Hack to have stream not keep the event loop alive.\n      // See https://github.com/joyent/node/issues/1726\n      if (stream._handle && stream._handle.unref) {\n        stream._handle.unref();\n      }\n      break;\n\n    case 'FILE':\n      var fs = require('fs');\n      stream = new fs.SyncWriteStream(fd, { autoClose: false });\n      stream._type = 'fs';\n      break;\n\n    case 'PIPE':\n    case 'TCP':\n      var net = require('net');\n      stream = new net.Socket({\n        fd: fd,\n        readable: false,\n        writable: true\n      });\n\n      // FIXME Should probably have an option in net.Socket to create a\n      // stream from an existing fd which is writable only. But for now\n      // we'll just add this hack and set the `readable` member to false.\n      // Test: ./node test/fixtures/echo.js < /etc/passwd\n      stream.readable = false;\n      stream.read = null;\n      stream._type = 'pipe';\n\n      // FIXME Hack to have stream not keep the event loop alive.\n      // See https://github.com/joyent/node/issues/1726\n      if (stream._handle && stream._handle.unref) {\n        stream._handle.unref();\n      }\n      break;\n\n    default:\n      // Probably an error on in uv_guess_handle()\n      throw new Error('Implement me. Unknown stream file type!');\n  }\n\n  // For supporting legacy API we put the FD here.\n  stream.fd = fd;\n\n  stream._isStdio = true;\n\n  return stream;\n}\n\n/**\n * Init logic for `debug` instances.\n *\n * Create a new `inspectOpts` object in case `useColors` is set\n * differently for a particular `debug` instance.\n */\n\nfunction init (debug) {\n  debug.inspectOpts = {};\n\n  var keys = Object.keys(exports.inspectOpts);\n  for (var i = 0; i < keys.length; i++) {\n    debug.inspectOpts[keys[i]] = exports.inspectOpts[keys[i]];\n  }\n}\n\n/**\n * Enable namespaces listed in `process.env.DEBUG` initially.\n */\n\nexports.enable(load());\n","/**\n * This is the web browser implementation of `debug()`.\n *\n * Expose `debug()` as the module.\n */\n\nexports = module.exports = require('./debug');\nexports.log = log;\nexports.formatArgs = formatArgs;\nexports.save = save;\nexports.load = load;\nexports.useColors = useColors;\nexports.storage = 'undefined' != typeof chrome\n               && 'undefined' != typeof chrome.storage\n                  ? chrome.storage.local\n                  : localstorage();\n\n/**\n * Colors.\n */\n\nexports.colors = [\n  'lightseagreen',\n  'forestgreen',\n  'goldenrod',\n  'dodgerblue',\n  'darkorchid',\n  'crimson'\n];\n\n/**\n * Currently only WebKit-based Web Inspectors, Firefox >= v31,\n * and the Firebug extension (any Firefox version) are known\n * to support \"%c\" CSS customizations.\n *\n * TODO: add a `localStorage` variable to explicitly enable/disable colors\n */\n\nfunction useColors() {\n  // NB: In an Electron preload script, document will be defined but not fully\n  // initialized. Since we know we're in Chrome, we'll just detect this case\n  // explicitly\n  if (typeof window !== 'undefined' && window.process && window.process.type === 'renderer') {\n    return true;\n  }\n\n  // is webkit? http://stackoverflow.com/a/16459606/376773\n  // document is undefined in react-native: https://github.com/facebook/react-native/pull/1632\n  return (typeof document !== 'undefined' && document.documentElement && document.documentElement.style && document.documentElement.style.WebkitAppearance) ||\n    // is firebug? http://stackoverflow.com/a/398120/376773\n    (typeof window !== 'undefined' && window.console && (window.console.firebug || (window.console.exception && window.console.table))) ||\n    // is firefox >= v31?\n    // https://developer.mozilla.org/en-US/docs/Tools/Web_Console#Styling_messages\n    (typeof navigator !== 'undefined' && navigator.userAgent && navigator.userAgent.toLowerCase().match(/firefox\\/(\\d+)/) && parseInt(RegExp.$1, 10) >= 31) ||\n    // double check webkit in userAgent just in case we are in a worker\n    (typeof navigator !== 'undefined' && navigator.userAgent && navigator.userAgent.toLowerCase().match(/applewebkit\\/(\\d+)/));\n}\n\n/**\n * Map %j to `JSON.stringify()`, since no Web Inspectors do that by default.\n */\n\nexports.formatters.j = function(v) {\n  try {\n    return JSON.stringify(v);\n  } catch (err) {\n    return '[UnexpectedJSONParseError]: ' + err.message;\n  }\n};\n\n\n/**\n * Colorize log arguments if enabled.\n *\n * @api public\n */\n\nfunction formatArgs(args) {\n  var useColors = this.useColors;\n\n  args[0] = (useColors ? '%c' : '')\n    + this.namespace\n    + (useColors ? ' %c' : ' ')\n    + args[0]\n    + (useColors ? '%c ' : ' ')\n    + '+' + exports.humanize(this.diff);\n\n  if (!useColors) return;\n\n  var c = 'color: ' + this.color;\n  args.splice(1, 0, c, 'color: inherit')\n\n  // the final \"%c\" is somewhat tricky, because there could be other\n  // arguments passed either before or after the %c, so we need to\n  // figure out the correct index to insert the CSS into\n  var index = 0;\n  var lastC = 0;\n  args[0].replace(/%[a-zA-Z%]/g, function(match) {\n    if ('%%' === match) return;\n    index++;\n    if ('%c' === match) {\n      // we only are interested in the *last* %c\n      // (the user may have provided their own)\n      lastC = index;\n    }\n  });\n\n  args.splice(lastC, 0, c);\n}\n\n/**\n * Invokes `console.log()` when available.\n * No-op when `console.log` is not a \"function\".\n *\n * @api public\n */\n\nfunction log() {\n  // this hackery is required for IE8/9, where\n  // the `console.log` function doesn't have 'apply'\n  return 'object' === typeof console\n    && console.log\n    && Function.prototype.apply.call(console.log, console, arguments);\n}\n\n/**\n * Save `namespaces`.\n *\n * @param {String} namespaces\n * @api private\n */\n\nfunction save(namespaces) {\n  try {\n    if (null == namespaces) {\n      exports.storage.removeItem('debug');\n    } else {\n      exports.storage.debug = namespaces;\n    }\n  } catch(e) {}\n}\n\n/**\n * Load `namespaces`.\n *\n * @return {String} returns the previously persisted debug modes\n * @api private\n */\n\nfunction load() {\n  var r;\n  try {\n    r = exports.storage.debug;\n  } catch(e) {}\n\n  // If debug isn't set in LS, and we're in Electron, try to load $DEBUG\n  if (!r && typeof process !== 'undefined' && 'env' in process) {\n    r = process.env.DEBUG;\n  }\n\n  return r;\n}\n\n/**\n * Enable namespaces listed in `localStorage.debug` initially.\n */\n\nexports.enable(load());\n\n/**\n * Localstorage attempts to return the localstorage.\n *\n * This is necessary because safari throws\n * when a user disables cookies/localstorage\n * and you attempt to access it.\n *\n * @return {LocalStorage}\n * @api private\n */\n\nfunction localstorage() {\n  try {\n    return window.localStorage;\n  } catch (e) {}\n}\n","/**\n * Helpers.\n */\n\nvar s = 1000;\nvar m = s * 60;\nvar h = m * 60;\nvar d = h * 24;\nvar y = d * 365.25;\n\n/**\n * Parse or format the given `val`.\n *\n * Options:\n *\n *  - `long` verbose formatting [false]\n *\n * @param {String|Number} val\n * @param {Object} [options]\n * @throws {Error} throw an error if val is not a non-empty string or a number\n * @return {String|Number}\n * @api public\n */\n\nmodule.exports = function(val, options) {\n  options = options || {};\n  var type = typeof val;\n  if (type === 'string' && val.length > 0) {\n    return parse(val);\n  } else if (type === 'number' && isNaN(val) === false) {\n    return options.long ? fmtLong(val) : fmtShort(val);\n  }\n  throw new Error(\n    'val is not a non-empty string or a valid number. val=' +\n      JSON.stringify(val)\n  );\n};\n\n/**\n * Parse the given `str` and return milliseconds.\n *\n * @param {String} str\n * @return {Number}\n * @api private\n */\n\nfunction parse(str) {\n  str = String(str);\n  if (str.length > 100) {\n    return;\n  }\n  var match = /^((?:\\d+)?\\.?\\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(\n    str\n  );\n  if (!match) {\n    return;\n  }\n  var n = parseFloat(match[1]);\n  var type = (match[2] || 'ms').toLowerCase();\n  switch (type) {\n    case 'years':\n    case 'year':\n    case 'yrs':\n    case 'yr':\n    case 'y':\n      return n * y;\n    case 'days':\n    case 'day':\n    case 'd':\n      return n * d;\n    case 'hours':\n    case 'hour':\n    case 'hrs':\n    case 'hr':\n    case 'h':\n      return n * h;\n    case 'minutes':\n    case 'minute':\n    case 'mins':\n    case 'min':\n    case 'm':\n      return n * m;\n    case 'seconds':\n    case 'second':\n    case 'secs':\n    case 'sec':\n    case 's':\n      return n * s;\n    case 'milliseconds':\n    case 'millisecond':\n    case 'msecs':\n    case 'msec':\n    case 'ms':\n      return n;\n    default:\n      return undefined;\n  }\n}\n\n/**\n * Short format for `ms`.\n *\n * @param {Number} ms\n * @return {String}\n * @api private\n */\n\nfunction fmtShort(ms) {\n  if (ms >= d) {\n    return Math.round(ms / d) + 'd';\n  }\n  if (ms >= h) {\n    return Math.round(ms / h) + 'h';\n  }\n  if (ms >= m) {\n    return Math.round(ms / m) + 'm';\n  }\n  if (ms >= s) {\n    return Math.round(ms / s) + 's';\n  }\n  return ms + 'ms';\n}\n\n/**\n * Long format for `ms`.\n *\n * @param {Number} ms\n * @return {String}\n * @api private\n */\n\nfunction fmtLong(ms) {\n  return plural(ms, d, 'day') ||\n    plural(ms, h, 'hour') ||\n    plural(ms, m, 'minute') ||\n    plural(ms, s, 'second') ||\n    ms + ' ms';\n}\n\n/**\n * Pluralization helper.\n */\n\nfunction plural(ms, n, name) {\n  if (ms < n) {\n    return;\n  }\n  if (ms < n * 1.5) {\n    return Math.floor(ms / n) + ' ' + name;\n  }\n  return Math.ceil(ms / n) + ' ' + name + 's';\n}\n","\n/**\n * This is the common logic for both the Node.js and web browser\n * implementations of `debug()`.\n *\n * Expose `debug()` as the module.\n */\n\nexports = module.exports = createDebug.debug = createDebug['default'] = createDebug;\nexports.coerce = coerce;\nexports.disable = disable;\nexports.enable = enable;\nexports.enabled = enabled;\nexports.humanize = require('ms');\n\n/**\n * The currently active debug mode names, and names to skip.\n */\n\nexports.names = [];\nexports.skips = [];\n\n/**\n * Map of special \"%n\" handling functions, for the debug \"format\" argument.\n *\n * Valid key names are a single, lower or upper-case letter, i.e. \"n\" and \"N\".\n */\n\nexports.formatters = {};\n\n/**\n * Previous log timestamp.\n */\n\nvar prevTime;\n\n/**\n * Select a color.\n * @param {String} namespace\n * @return {Number}\n * @api private\n */\n\nfunction selectColor(namespace) {\n  var hash = 0, i;\n\n  for (i in namespace) {\n    hash  = ((hash << 5) - hash) + namespace.charCodeAt(i);\n    hash |= 0; // Convert to 32bit integer\n  }\n\n  return exports.colors[Math.abs(hash) % exports.colors.length];\n}\n\n/**\n * Create a debugger with the given `namespace`.\n *\n * @param {String} namespace\n * @return {Function}\n * @api public\n */\n\nfunction createDebug(namespace) {\n\n  function debug() {\n    // disabled?\n    if (!debug.enabled) return;\n\n    var self = debug;\n\n    // set `diff` timestamp\n    var curr = +new Date();\n    var ms = curr - (prevTime || curr);\n    self.diff = ms;\n    self.prev = prevTime;\n    self.curr = curr;\n    prevTime = curr;\n\n    // turn the `arguments` into a proper Array\n    var args = new Array(arguments.length);\n    for (var i = 0; i < args.length; i++) {\n      args[i] = arguments[i];\n    }\n\n    args[0] = exports.coerce(args[0]);\n\n    if ('string' !== typeof args[0]) {\n      // anything else let's inspect with %O\n      args.unshift('%O');\n    }\n\n    // apply any `formatters` transformations\n    var index = 0;\n    args[0] = args[0].replace(/%([a-zA-Z%])/g, function(match, format) {\n      // if we encounter an escaped % then don't increase the array index\n      if (match === '%%') return match;\n      index++;\n      var formatter = exports.formatters[format];\n      if ('function' === typeof formatter) {\n        var val = args[index];\n        match = formatter.call(self, val);\n\n        // now we need to remove `args[index]` since it's inlined in the `format`\n        args.splice(index, 1);\n        index--;\n      }\n      return match;\n    });\n\n    // apply env-specific formatting (colors, etc.)\n    exports.formatArgs.call(self, args);\n\n    var logFn = debug.log || exports.log || console.log.bind(console);\n    logFn.apply(self, args);\n  }\n\n  debug.namespace = namespace;\n  debug.enabled = exports.enabled(namespace);\n  debug.useColors = exports.useColors();\n  debug.color = selectColor(namespace);\n\n  // env-specific initialization logic for debug instances\n  if ('function' === typeof exports.init) {\n    exports.init(debug);\n  }\n\n  return debug;\n}\n\n/**\n * Enables a debug mode by namespaces. This can include modes\n * separated by a colon and wildcards.\n *\n * @param {String} namespaces\n * @api public\n */\n\nfunction enable(namespaces) {\n  exports.save(namespaces);\n\n  exports.names = [];\n  exports.skips = [];\n\n  var split = (typeof namespaces === 'string' ? namespaces : '').split(/[\\s,]+/);\n  var len = split.length;\n\n  for (var i = 0; i < len; i++) {\n    if (!split[i]) continue; // ignore empty strings\n    namespaces = split[i].replace(/\\*/g, '.*?');\n    if (namespaces[0] === '-') {\n      exports.skips.push(new RegExp('^' + namespaces.substr(1) + '$'));\n    } else {\n      exports.names.push(new RegExp('^' + namespaces + '$'));\n    }\n  }\n}\n\n/**\n * Disable debug output.\n *\n * @api public\n */\n\nfunction disable() {\n  exports.enable('');\n}\n\n/**\n * Returns true if the given mode name is enabled, false otherwise.\n *\n * @param {String} name\n * @return {Boolean}\n * @api public\n */\n\nfunction enabled(name) {\n  var i, len;\n  for (i = 0, len = exports.skips.length; i < len; i++) {\n    if (exports.skips[i].test(name)) {\n      return false;\n    }\n  }\n  for (i = 0, len = exports.names.length; i < len; i++) {\n    if (exports.names[i].test(name)) {\n      return true;\n    }\n  }\n  return false;\n}\n\n/**\n * Coerce `val`.\n *\n * @param {Mixed} val\n * @return {Mixed}\n * @api private\n */\n\nfunction coerce(val) {\n  if (val instanceof Error) return val.stack || val.message;\n  return val;\n}\n","/*global setImmediate: false, setTimeout: false, console: false */\n(function () {\n\n    var async = {};\n\n    // global on the server, window in the browser\n    var root, previous_async;\n\n    root = this;\n    if (root != null) {\n      previous_async = root.async;\n    }\n\n    async.noConflict = function () {\n        root.async = previous_async;\n        return async;\n    };\n\n    function only_once(fn) {\n        var called = false;\n        return function() {\n            if (called) throw new Error(\"Callback was already called.\");\n            called = true;\n            fn.apply(root, arguments);\n        }\n    }\n\n    //// cross-browser compatiblity functions ////\n\n    var _each = function (arr, iterator) {\n        if (arr.forEach) {\n            return arr.forEach(iterator);\n        }\n        for (var i = 0; i < arr.length; i += 1) {\n            iterator(arr[i], i, arr);\n        }\n    };\n\n    var _map = function (arr, iterator) {\n        if (arr.map) {\n            return arr.map(iterator);\n        }\n        var results = [];\n        _each(arr, function (x, i, a) {\n            results.push(iterator(x, i, a));\n        });\n        return results;\n    };\n\n    var _reduce = function (arr, iterator, memo) {\n        if (arr.reduce) {\n            return arr.reduce(iterator, memo);\n        }\n        _each(arr, function (x, i, a) {\n            memo = iterator(memo, x, i, a);\n        });\n        return memo;\n    };\n\n    var _keys = function (obj) {\n        if (Object.keys) {\n            return Object.keys(obj);\n        }\n        var keys = [];\n        for (var k in obj) {\n            if (obj.hasOwnProperty(k)) {\n                keys.push(k);\n            }\n        }\n        return keys;\n    };\n\n    //// exported async module functions ////\n\n    //// nextTick implementation with browser-compatible fallback ////\n    if (typeof process === 'undefined' || !(process.nextTick)) {\n        if (typeof setImmediate === 'function') {\n            async.nextTick = function (fn) {\n                // not a direct alias for IE10 compatibility\n                setImmediate(fn);\n            };\n            async.setImmediate = async.nextTick;\n        }\n        else {\n            async.nextTick = function (fn) {\n                setTimeout(fn, 0);\n            };\n            async.setImmediate = async.nextTick;\n        }\n    }\n    else {\n        async.nextTick = process.nextTick;\n        if (typeof setImmediate !== 'undefined') {\n            async.setImmediate = function (fn) {\n              // not a direct alias for IE10 compatibility\n              setImmediate(fn);\n            };\n        }\n        else {\n            async.setImmediate = async.nextTick;\n        }\n    }\n\n    async.each = function (arr, iterator, callback) {\n        callback = callback || function () {};\n        if (!arr.length) {\n            return callback();\n        }\n        var completed = 0;\n        _each(arr, function (x) {\n            iterator(x, only_once(function (err) {\n                if (err) {\n                    callback(err);\n                    callback = function () {};\n                }\n                else {\n                    completed += 1;\n                    if (completed >= arr.length) {\n                        callback(null);\n                    }\n                }\n            }));\n        });\n    };\n    async.forEach = async.each;\n\n    async.eachSeries = function (arr, iterator, callback) {\n        callback = callback || function () {};\n        if (!arr.length) {\n            return callback();\n        }\n        var completed = 0;\n        var iterate = function () {\n            iterator(arr[completed], function (err) {\n                if (err) {\n                    callback(err);\n                    callback = function () {};\n                }\n                else {\n                    completed += 1;\n                    if (completed >= arr.length) {\n                        callback(null);\n                    }\n                    else {\n                        iterate();\n                    }\n                }\n            });\n        };\n        iterate();\n    };\n    async.forEachSeries = async.eachSeries;\n\n    async.eachLimit = function (arr, limit, iterator, callback) {\n        var fn = _eachLimit(limit);\n        fn.apply(null, [arr, iterator, callback]);\n    };\n    async.forEachLimit = async.eachLimit;\n\n    var _eachLimit = function (limit) {\n\n        return function (arr, iterator, callback) {\n            callback = callback || function () {};\n            if (!arr.length || limit <= 0) {\n                return callback();\n            }\n            var completed = 0;\n            var started = 0;\n            var running = 0;\n\n            (function replenish () {\n                if (completed >= arr.length) {\n                    return callback();\n                }\n\n                while (running < limit && started < arr.length) {\n                    started += 1;\n                    running += 1;\n                    iterator(arr[started - 1], function (err) {\n                        if (err) {\n                            callback(err);\n                            callback = function () {};\n                        }\n                        else {\n                            completed += 1;\n                            running -= 1;\n                            if (completed >= arr.length) {\n                                callback();\n                            }\n                            else {\n                                replenish();\n                            }\n                        }\n                    });\n                }\n            })();\n        };\n    };\n\n\n    var doParallel = function (fn) {\n        return function () {\n            var args = Array.prototype.slice.call(arguments);\n            return fn.apply(null, [async.each].concat(args));\n        };\n    };\n    var doParallelLimit = function(limit, fn) {\n        return function () {\n            var args = Array.prototype.slice.call(arguments);\n            return fn.apply(null, [_eachLimit(limit)].concat(args));\n        };\n    };\n    var doSeries = function (fn) {\n        return function () {\n            var args = Array.prototype.slice.call(arguments);\n            return fn.apply(null, [async.eachSeries].concat(args));\n        };\n    };\n\n\n    var _asyncMap = function (eachfn, arr, iterator, callback) {\n        var results = [];\n        arr = _map(arr, function (x, i) {\n            return {index: i, value: x};\n        });\n        eachfn(arr, function (x, callback) {\n            iterator(x.value, function (err, v) {\n                results[x.index] = v;\n                callback(err);\n            });\n        }, function (err) {\n            callback(err, results);\n        });\n    };\n    async.map = doParallel(_asyncMap);\n    async.mapSeries = doSeries(_asyncMap);\n    async.mapLimit = function (arr, limit, iterator, callback) {\n        return _mapLimit(limit)(arr, iterator, callback);\n    };\n\n    var _mapLimit = function(limit) {\n        return doParallelLimit(limit, _asyncMap);\n    };\n\n    // reduce only has a series version, as doing reduce in parallel won't\n    // work in many situations.\n    async.reduce = function (arr, memo, iterator, callback) {\n        async.eachSeries(arr, function (x, callback) {\n            iterator(memo, x, function (err, v) {\n                memo = v;\n                callback(err);\n            });\n        }, function (err) {\n            callback(err, memo);\n        });\n    };\n    // inject alias\n    async.inject = async.reduce;\n    // foldl alias\n    async.foldl = async.reduce;\n\n    async.reduceRight = function (arr, memo, iterator, callback) {\n        var reversed = _map(arr, function (x) {\n            return x;\n        }).reverse();\n        async.reduce(reversed, memo, iterator, callback);\n    };\n    // foldr alias\n    async.foldr = async.reduceRight;\n\n    var _filter = function (eachfn, arr, iterator, callback) {\n        var results = [];\n        arr = _map(arr, function (x, i) {\n            return {index: i, value: x};\n        });\n        eachfn(arr, function (x, callback) {\n            iterator(x.value, function (v) {\n                if (v) {\n                    results.push(x);\n                }\n                callback();\n            });\n        }, function (err) {\n            callback(_map(results.sort(function (a, b) {\n                return a.index - b.index;\n            }), function (x) {\n                return x.value;\n            }));\n        });\n    };\n    async.filter = doParallel(_filter);\n    async.filterSeries = doSeries(_filter);\n    // select alias\n    async.select = async.filter;\n    async.selectSeries = async.filterSeries;\n\n    var _reject = function (eachfn, arr, iterator, callback) {\n        var results = [];\n        arr = _map(arr, function (x, i) {\n            return {index: i, value: x};\n        });\n        eachfn(arr, function (x, callback) {\n            iterator(x.value, function (v) {\n                if (!v) {\n                    results.push(x);\n                }\n                callback();\n            });\n        }, function (err) {\n            callback(_map(results.sort(function (a, b) {\n                return a.index - b.index;\n            }), function (x) {\n                return x.value;\n            }));\n        });\n    };\n    async.reject = doParallel(_reject);\n    async.rejectSeries = doSeries(_reject);\n\n    var _detect = function (eachfn, arr, iterator, main_callback) {\n        eachfn(arr, function (x, callback) {\n            iterator(x, function (result) {\n                if (result) {\n                    main_callback(x);\n                    main_callback = function () {};\n                }\n                else {\n                    callback();\n                }\n            });\n        }, function (err) {\n            main_callback();\n        });\n    };\n    async.detect = doParallel(_detect);\n    async.detectSeries = doSeries(_detect);\n\n    async.some = function (arr, iterator, main_callback) {\n        async.each(arr, function (x, callback) {\n            iterator(x, function (v) {\n                if (v) {\n                    main_callback(true);\n                    main_callback = function () {};\n                }\n                callback();\n            });\n        }, function (err) {\n            main_callback(false);\n        });\n    };\n    // any alias\n    async.any = async.some;\n\n    async.every = function (arr, iterator, main_callback) {\n        async.each(arr, function (x, callback) {\n            iterator(x, function (v) {\n                if (!v) {\n                    main_callback(false);\n                    main_callback = function () {};\n                }\n                callback();\n            });\n        }, function (err) {\n            main_callback(true);\n        });\n    };\n    // all alias\n    async.all = async.every;\n\n    async.sortBy = function (arr, iterator, callback) {\n        async.map(arr, function (x, callback) {\n            iterator(x, function (err, criteria) {\n                if (err) {\n                    callback(err);\n                }\n                else {\n                    callback(null, {value: x, criteria: criteria});\n                }\n            });\n        }, function (err, results) {\n            if (err) {\n                return callback(err);\n            }\n            else {\n                var fn = function (left, right) {\n                    var a = left.criteria, b = right.criteria;\n                    return a < b ? -1 : a > b ? 1 : 0;\n                };\n                callback(null, _map(results.sort(fn), function (x) {\n                    return x.value;\n                }));\n            }\n        });\n    };\n\n    async.auto = function (tasks, callback) {\n        callback = callback || function () {};\n        var keys = _keys(tasks);\n        if (!keys.length) {\n            return callback(null);\n        }\n\n        var results = {};\n\n        var listeners = [];\n        var addListener = function (fn) {\n            listeners.unshift(fn);\n        };\n        var removeListener = function (fn) {\n            for (var i = 0; i < listeners.length; i += 1) {\n                if (listeners[i] === fn) {\n                    listeners.splice(i, 1);\n                    return;\n                }\n            }\n        };\n        var taskComplete = function () {\n            _each(listeners.slice(0), function (fn) {\n                fn();\n            });\n        };\n\n        addListener(function () {\n            if (_keys(results).length === keys.length) {\n                callback(null, results);\n                callback = function () {};\n            }\n        });\n\n        _each(keys, function (k) {\n            var task = (tasks[k] instanceof Function) ? [tasks[k]]: tasks[k];\n            var taskCallback = function (err) {\n                var args = Array.prototype.slice.call(arguments, 1);\n                if (args.length <= 1) {\n                    args = args[0];\n                }\n                if (err) {\n                    var safeResults = {};\n                    _each(_keys(results), function(rkey) {\n                        safeResults[rkey] = results[rkey];\n                    });\n                    safeResults[k] = args;\n                    callback(err, safeResults);\n                    // stop subsequent errors hitting callback multiple times\n                    callback = function () {};\n                }\n                else {\n                    results[k] = args;\n                    async.setImmediate(taskComplete);\n                }\n            };\n            var requires = task.slice(0, Math.abs(task.length - 1)) || [];\n            var ready = function () {\n                return _reduce(requires, function (a, x) {\n                    return (a && results.hasOwnProperty(x));\n                }, true) && !results.hasOwnProperty(k);\n            };\n            if (ready()) {\n                task[task.length - 1](taskCallback, results);\n            }\n            else {\n                var listener = function () {\n                    if (ready()) {\n                        removeListener(listener);\n                        task[task.length - 1](taskCallback, results);\n                    }\n                };\n                addListener(listener);\n            }\n        });\n    };\n\n    async.waterfall = function (tasks, callback) {\n        callback = callback || function () {};\n        if (tasks.constructor !== Array) {\n          var err = new Error('First argument to waterfall must be an array of functions');\n          return callback(err);\n        }\n        if (!tasks.length) {\n            return callback();\n        }\n        var wrapIterator = function (iterator) {\n            return function (err) {\n                if (err) {\n                    callback.apply(null, arguments);\n                    callback = function () {};\n                }\n                else {\n                    var args = Array.prototype.slice.call(arguments, 1);\n                    var next = iterator.next();\n                    if (next) {\n                        args.push(wrapIterator(next));\n                    }\n                    else {\n                        args.push(callback);\n                    }\n                    async.setImmediate(function () {\n                        iterator.apply(null, args);\n                    });\n                }\n            };\n        };\n        wrapIterator(async.iterator(tasks))();\n    };\n\n    var _parallel = function(eachfn, tasks, callback) {\n        callback = callback || function () {};\n        if (tasks.constructor === Array) {\n            eachfn.map(tasks, function (fn, callback) {\n                if (fn) {\n                    fn(function (err) {\n                        var args = Array.prototype.slice.call(arguments, 1);\n                        if (args.length <= 1) {\n                            args = args[0];\n                        }\n                        callback.call(null, err, args);\n                    });\n                }\n            }, callback);\n        }\n        else {\n            var results = {};\n            eachfn.each(_keys(tasks), function (k, callback) {\n                tasks[k](function (err) {\n                    var args = Array.prototype.slice.call(arguments, 1);\n                    if (args.length <= 1) {\n                        args = args[0];\n                    }\n                    results[k] = args;\n                    callback(err);\n                });\n            }, function (err) {\n                callback(err, results);\n            });\n        }\n    };\n\n    async.parallel = function (tasks, callback) {\n        _parallel({ map: async.map, each: async.each }, tasks, callback);\n    };\n\n    async.parallelLimit = function(tasks, limit, callback) {\n        _parallel({ map: _mapLimit(limit), each: _eachLimit(limit) }, tasks, callback);\n    };\n\n    async.series = function (tasks, callback) {\n        callback = callback || function () {};\n        if (tasks.constructor === Array) {\n            async.mapSeries(tasks, function (fn, callback) {\n                if (fn) {\n                    fn(function (err) {\n                        var args = Array.prototype.slice.call(arguments, 1);\n                        if (args.length <= 1) {\n                            args = args[0];\n                        }\n                        callback.call(null, err, args);\n                    });\n                }\n            }, callback);\n        }\n        else {\n            var results = {};\n            async.eachSeries(_keys(tasks), function (k, callback) {\n                tasks[k](function (err) {\n                    var args = Array.prototype.slice.call(arguments, 1);\n                    if (args.length <= 1) {\n                        args = args[0];\n                    }\n                    results[k] = args;\n                    callback(err);\n                });\n            }, function (err) {\n                callback(err, results);\n            });\n        }\n    };\n\n    async.iterator = function (tasks) {\n        var makeCallback = function (index) {\n            var fn = function () {\n                if (tasks.length) {\n                    tasks[index].apply(null, arguments);\n                }\n                return fn.next();\n            };\n            fn.next = function () {\n                return (index < tasks.length - 1) ? makeCallback(index + 1): null;\n            };\n            return fn;\n        };\n        return makeCallback(0);\n    };\n\n    async.apply = function (fn) {\n        var args = Array.prototype.slice.call(arguments, 1);\n        return function () {\n            return fn.apply(\n                null, args.concat(Array.prototype.slice.call(arguments))\n            );\n        };\n    };\n\n    var _concat = function (eachfn, arr, fn, callback) {\n        var r = [];\n        eachfn(arr, function (x, cb) {\n            fn(x, function (err, y) {\n                r = r.concat(y || []);\n                cb(err);\n            });\n        }, function (err) {\n            callback(err, r);\n        });\n    };\n    async.concat = doParallel(_concat);\n    async.concatSeries = doSeries(_concat);\n\n    async.whilst = function (test, iterator, callback) {\n        if (test()) {\n            iterator(function (err) {\n                if (err) {\n                    return callback(err);\n                }\n                async.whilst(test, iterator, callback);\n            });\n        }\n        else {\n            callback();\n        }\n    };\n\n    async.doWhilst = function (iterator, test, callback) {\n        iterator(function (err) {\n            if (err) {\n                return callback(err);\n            }\n            if (test()) {\n                async.doWhilst(iterator, test, callback);\n            }\n            else {\n                callback();\n            }\n        });\n    };\n\n    async.until = function (test, iterator, callback) {\n        if (!test()) {\n            iterator(function (err) {\n                if (err) {\n                    return callback(err);\n                }\n                async.until(test, iterator, callback);\n            });\n        }\n        else {\n            callback();\n        }\n    };\n\n    async.doUntil = function (iterator, test, callback) {\n        iterator(function (err) {\n            if (err) {\n                return callback(err);\n            }\n            if (!test()) {\n                async.doUntil(iterator, test, callback);\n            }\n            else {\n                callback();\n            }\n        });\n    };\n\n    async.queue = function (worker, concurrency) {\n        if (concurrency === undefined) {\n            concurrency = 1;\n        }\n        function _insert(q, data, pos, callback) {\n          if(data.constructor !== Array) {\n              data = [data];\n          }\n          _each(data, function(task) {\n              var item = {\n                  data: task,\n                  callback: typeof callback === 'function' ? callback : null\n              };\n\n              if (pos) {\n                q.tasks.unshift(item);\n              } else {\n                q.tasks.push(item);\n              }\n\n              if (q.saturated && q.tasks.length === concurrency) {\n                  q.saturated();\n              }\n              async.setImmediate(q.process);\n          });\n        }\n\n        var workers = 0;\n        var q = {\n            tasks: [],\n            concurrency: concurrency,\n            saturated: null,\n            empty: null,\n            drain: null,\n            push: function (data, callback) {\n              _insert(q, data, false, callback);\n            },\n            unshift: function (data, callback) {\n              _insert(q, data, true, callback);\n            },\n            process: function () {\n                if (workers < q.concurrency && q.tasks.length) {\n                    var task = q.tasks.shift();\n                    if (q.empty && q.tasks.length === 0) {\n                        q.empty();\n                    }\n                    workers += 1;\n                    var next = function () {\n                        workers -= 1;\n                        if (task.callback) {\n                            task.callback.apply(task, arguments);\n                        }\n                        if (q.drain && q.tasks.length + workers === 0) {\n                            q.drain();\n                        }\n                        q.process();\n                    };\n                    var cb = only_once(next);\n                    worker(task.data, cb);\n                }\n            },\n            length: function () {\n                return q.tasks.length;\n            },\n            running: function () {\n                return workers;\n            }\n        };\n        return q;\n    };\n\n    async.cargo = function (worker, payload) {\n        var working     = false,\n            tasks       = [];\n\n        var cargo = {\n            tasks: tasks,\n            payload: payload,\n            saturated: null,\n            empty: null,\n            drain: null,\n            push: function (data, callback) {\n                if(data.constructor !== Array) {\n                    data = [data];\n                }\n                _each(data, function(task) {\n                    tasks.push({\n                        data: task,\n                        callback: typeof callback === 'function' ? callback : null\n                    });\n                    if (cargo.saturated && tasks.length === payload) {\n                        cargo.saturated();\n                    }\n                });\n                async.setImmediate(cargo.process);\n            },\n            process: function process() {\n                if (working) return;\n                if (tasks.length === 0) {\n                    if(cargo.drain) cargo.drain();\n                    return;\n                }\n\n                var ts = typeof payload === 'number'\n                            ? tasks.splice(0, payload)\n                            : tasks.splice(0);\n\n                var ds = _map(ts, function (task) {\n                    return task.data;\n                });\n\n                if(cargo.empty) cargo.empty();\n                working = true;\n                worker(ds, function () {\n                    working = false;\n\n                    var args = arguments;\n                    _each(ts, function (data) {\n                        if (data.callback) {\n                            data.callback.apply(null, args);\n                        }\n                    });\n\n                    process();\n                });\n            },\n            length: function () {\n                return tasks.length;\n            },\n            running: function () {\n                return working;\n            }\n        };\n        return cargo;\n    };\n\n    var _console_fn = function (name) {\n        return function (fn) {\n            var args = Array.prototype.slice.call(arguments, 1);\n            fn.apply(null, args.concat([function (err) {\n                var args = Array.prototype.slice.call(arguments, 1);\n                if (typeof console !== 'undefined') {\n                    if (err) {\n                        if (console.error) {\n                            console.error(err);\n                        }\n                    }\n                    else if (console[name]) {\n                        _each(args, function (x) {\n                            console[name](x);\n                        });\n                    }\n                }\n            }]));\n        };\n    };\n    async.log = _console_fn('log');\n    async.dir = _console_fn('dir');\n    /*async.info = _console_fn('info');\n    async.warn = _console_fn('warn');\n    async.error = _console_fn('error');*/\n\n    async.memoize = function (fn, hasher) {\n        var memo = {};\n        var queues = {};\n        hasher = hasher || function (x) {\n            return x;\n        };\n        var memoized = function () {\n            var args = Array.prototype.slice.call(arguments);\n            var callback = args.pop();\n            var key = hasher.apply(null, args);\n            if (key in memo) {\n                callback.apply(null, memo[key]);\n            }\n            else if (key in queues) {\n                queues[key].push(callback);\n            }\n            else {\n                queues[key] = [callback];\n                fn.apply(null, args.concat([function () {\n                    memo[key] = arguments;\n                    var q = queues[key];\n                    delete queues[key];\n                    for (var i = 0, l = q.length; i < l; i++) {\n                      q[i].apply(null, arguments);\n                    }\n                }]));\n            }\n        };\n        memoized.memo = memo;\n        memoized.unmemoized = fn;\n        return memoized;\n    };\n\n    async.unmemoize = function (fn) {\n      return function () {\n        return (fn.unmemoized || fn).apply(null, arguments);\n      };\n    };\n\n    async.times = function (count, iterator, callback) {\n        var counter = [];\n        for (var i = 0; i < count; i++) {\n            counter.push(i);\n        }\n        return async.map(counter, iterator, callback);\n    };\n\n    async.timesSeries = function (count, iterator, callback) {\n        var counter = [];\n        for (var i = 0; i < count; i++) {\n            counter.push(i);\n        }\n        return async.mapSeries(counter, iterator, callback);\n    };\n\n    async.compose = function (/* functions... */) {\n        var fns = Array.prototype.reverse.call(arguments);\n        return function () {\n            var that = this;\n            var args = Array.prototype.slice.call(arguments);\n            var callback = args.pop();\n            async.reduce(fns, args, function (newargs, fn, cb) {\n                fn.apply(that, newargs.concat([function () {\n                    var err = arguments[0];\n                    var nextargs = Array.prototype.slice.call(arguments, 1);\n                    cb(err, nextargs);\n                }]))\n            },\n            function (err, results) {\n                callback.apply(that, [err].concat(results));\n            });\n        };\n    };\n\n    var _applyEach = function (eachfn, fns /*args...*/) {\n        var go = function () {\n            var that = this;\n            var args = Array.prototype.slice.call(arguments);\n            var callback = args.pop();\n            return eachfn(fns, function (fn, cb) {\n                fn.apply(that, args.concat([cb]));\n            },\n            callback);\n        };\n        if (arguments.length > 2) {\n            var args = Array.prototype.slice.call(arguments, 2);\n            return go.apply(this, args);\n        }\n        else {\n            return go;\n        }\n    };\n    async.applyEach = doParallel(_applyEach);\n    async.applyEachSeries = doSeries(_applyEach);\n\n    async.forever = function (fn, callback) {\n        function next(err) {\n            if (err) {\n                if (callback) {\n                    return callback(err);\n                }\n                throw err;\n            }\n            fn(next);\n        }\n        next();\n    };\n\n    // AMD / RequireJS\n    if (typeof define !== 'undefined' && define.amd) {\n        define([], function () {\n            return async;\n        });\n    }\n    // Node.js\n    else if (typeof module !== 'undefined' && module.exports) {\n        module.exports = async;\n    }\n    // included directly via <script> tag\n    else {\n        root.async = async;\n    }\n\n}());\n","module.exports = isexe\nisexe.sync = sync\n\nvar fs = require('fs')\n\nfunction isexe (path, options, cb) {\n  fs.stat(path, function (er, stat) {\n    cb(er, er ? false : checkStat(stat, options))\n  })\n}\n\nfunction sync (path, options) {\n  return checkStat(fs.statSync(path), options)\n}\n\nfunction checkStat (stat, options) {\n  return stat.isFile() && checkMode(stat, options)\n}\n\nfunction checkMode (stat, options) {\n  var mod = stat.mode\n  var uid = stat.uid\n  var gid = stat.gid\n\n  var myUid = options.uid !== undefined ?\n    options.uid : process.getuid && process.getuid()\n  var myGid = options.gid !== undefined ?\n    options.gid : process.getgid && process.getgid()\n\n  var u = parseInt('100', 8)\n  var g = parseInt('010', 8)\n  var o = parseInt('001', 8)\n  var ug = u | g\n\n  var ret = (mod & o) ||\n    (mod & g) && gid === myGid ||\n    (mod & u) && uid === myUid ||\n    (mod & ug) && myUid === 0\n\n  return ret\n}\n","/*jshint node:true*/\n'use strict';\n\nvar utils = require('../utils');\n\n\n/*\n *! Video-related methods\n */\n\nmodule.exports = function(proto) {\n  /**\n   * Disable video in the output\n   *\n   * @method FfmpegCommand#noVideo\n   * @category Video\n   * @aliases withNoVideo\n   *\n   * @return FfmpegCommand\n   */\n  proto.withNoVideo =\n  proto.noVideo = function() {\n    this._currentOutput.video.clear();\n    this._currentOutput.videoFilters.clear();\n    this._currentOutput.video('-vn');\n\n    return this;\n  };\n\n\n  /**\n   * Specify video codec\n   *\n   * @method FfmpegCommand#videoCodec\n   * @category Video\n   * @aliases withVideoCodec\n   *\n   * @param {String} codec video codec name\n   * @return FfmpegCommand\n   */\n  proto.withVideoCodec =\n  proto.videoCodec = function(codec) {\n    this._currentOutput.video('-vcodec', codec);\n    return this;\n  };\n\n\n  /**\n   * Specify video bitrate\n   *\n   * @method FfmpegCommand#videoBitrate\n   * @category Video\n   * @aliases withVideoBitrate\n   *\n   * @param {String|Number} bitrate video bitrate in kbps (with an optional 'k' suffix)\n   * @param {Boolean} [constant=false] enforce constant bitrate\n   * @return FfmpegCommand\n   */\n  proto.withVideoBitrate =\n  proto.videoBitrate = function(bitrate, constant) {\n    bitrate = ('' + bitrate).replace(/k?$/, 'k');\n\n    this._currentOutput.video('-b:v', bitrate);\n    if (constant) {\n      this._currentOutput.video(\n        '-maxrate', bitrate,\n        '-minrate', bitrate,\n        '-bufsize', '3M'\n      );\n    }\n\n    return this;\n  };\n\n\n  /**\n   * Specify custom video filter(s)\n   *\n   * Can be called both with one or many filters, or a filter array.\n   *\n   * @example\n   * command.videoFilters('filter1');\n   *\n   * @example\n   * command.videoFilters('filter1', 'filter2=param1=value1:param2=value2');\n   *\n   * @example\n   * command.videoFilters(['filter1', 'filter2']);\n   *\n   * @example\n   * command.videoFilters([\n   *   {\n   *     filter: 'filter1'\n   *   },\n   *   {\n   *     filter: 'filter2',\n   *     options: 'param=value:param=value'\n   *   }\n   * ]);\n   *\n   * @example\n   * command.videoFilters(\n   *   {\n   *     filter: 'filter1',\n   *     options: ['value1', 'value2']\n   *   },\n   *   {\n   *     filter: 'filter2',\n   *     options: { param1: 'value1', param2: 'value2' }\n   *   }\n   * );\n   *\n   * @method FfmpegCommand#videoFilters\n   * @category Video\n   * @aliases withVideoFilter,withVideoFilters,videoFilter\n   *\n   * @param {...String|String[]|Object[]} filters video filter strings, string array or\n   *   filter specification array, each with the following properties:\n   * @param {String} filters.filter filter name\n   * @param {String|String[]|Object} [filters.options] filter option string, array, or object\n   * @return FfmpegCommand\n   */\n  proto.withVideoFilter =\n  proto.withVideoFilters =\n  proto.videoFilter =\n  proto.videoFilters = function(filters) {\n    if (arguments.length > 1) {\n      filters = [].slice.call(arguments);\n    }\n\n    if (!Array.isArray(filters)) {\n      filters = [filters];\n    }\n\n    this._currentOutput.videoFilters(utils.makeFilterStrings(filters));\n\n    return this;\n  };\n\n\n  /**\n   * Specify output FPS\n   *\n   * @method FfmpegCommand#fps\n   * @category Video\n   * @aliases withOutputFps,withOutputFPS,withFpsOutput,withFPSOutput,withFps,withFPS,outputFPS,outputFps,fpsOutput,FPSOutput,FPS\n   *\n   * @param {Number} fps output FPS\n   * @return FfmpegCommand\n   */\n  proto.withOutputFps =\n  proto.withOutputFPS =\n  proto.withFpsOutput =\n  proto.withFPSOutput =\n  proto.withFps =\n  proto.withFPS =\n  proto.outputFPS =\n  proto.outputFps =\n  proto.fpsOutput =\n  proto.FPSOutput =\n  proto.fps =\n  proto.FPS = function(fps) {\n    this._currentOutput.video('-r', fps);\n    return this;\n  };\n\n\n  /**\n   * Only transcode a certain number of frames\n   *\n   * @method FfmpegCommand#frames\n   * @category Video\n   * @aliases takeFrames,withFrames\n   *\n   * @param {Number} frames frame count\n   * @return FfmpegCommand\n   */\n  proto.takeFrames =\n  proto.withFrames =\n  proto.frames = function(frames) {\n    this._currentOutput.video('-vframes', frames);\n    return this;\n  };\n};\n","module.exports = which\nwhich.sync = whichSync\n\nvar isWindows = process.platform === 'win32' ||\n    process.env.OSTYPE === 'cygwin' ||\n    process.env.OSTYPE === 'msys'\n\nvar path = require('path')\nvar COLON = isWindows ? ';' : ':'\nvar isexe = require('isexe')\n\nfunction getNotFoundError (cmd) {\n  var er = new Error('not found: ' + cmd)\n  er.code = 'ENOENT'\n\n  return er\n}\n\nfunction getPathInfo (cmd, opt) {\n  var colon = opt.colon || COLON\n  var pathEnv = opt.path || process.env.PATH || ''\n  var pathExt = ['']\n\n  pathEnv = pathEnv.split(colon)\n\n  var pathExtExe = ''\n  if (isWindows) {\n    pathEnv.unshift(process.cwd())\n    pathExtExe = (opt.pathExt || process.env.PATHEXT || '.EXE;.CMD;.BAT;.COM')\n    pathExt = pathExtExe.split(colon)\n\n\n    // Always test the cmd itself first.  isexe will check to make sure\n    // it's found in the pathExt set.\n    if (cmd.indexOf('.') !== -1 && pathExt[0] !== '')\n      pathExt.unshift('')\n  }\n\n  // If it has a slash, then we don't bother searching the pathenv.\n  // just check the file itself, and that's it.\n  if (cmd.match(/\\//) || isWindows && cmd.match(/\\\\/))\n    pathEnv = ['']\n\n  return {\n    env: pathEnv,\n    ext: pathExt,\n    extExe: pathExtExe\n  }\n}\n\nfunction which (cmd, opt, cb) {\n  if (typeof opt === 'function') {\n    cb = opt\n    opt = {}\n  }\n\n  var info = getPathInfo(cmd, opt)\n  var pathEnv = info.env\n  var pathExt = info.ext\n  var pathExtExe = info.extExe\n  var found = []\n\n  ;(function F (i, l) {\n    if (i === l) {\n      if (opt.all && found.length)\n        return cb(null, found)\n      else\n        return cb(getNotFoundError(cmd))\n    }\n\n    var pathPart = pathEnv[i]\n    if (pathPart.charAt(0) === '\"' && pathPart.slice(-1) === '\"')\n      pathPart = pathPart.slice(1, -1)\n\n    var p = path.join(pathPart, cmd)\n    if (!pathPart && (/^\\.[\\\\\\/]/).test(cmd)) {\n      p = cmd.slice(0, 2) + p\n    }\n    ;(function E (ii, ll) {\n      if (ii === ll) return F(i + 1, l)\n      var ext = pathExt[ii]\n      isexe(p + ext, { pathExt: pathExtExe }, function (er, is) {\n        if (!er && is) {\n          if (opt.all)\n            found.push(p + ext)\n          else\n            return cb(null, p + ext)\n        }\n        return E(ii + 1, ll)\n      })\n    })(0, pathExt.length)\n  })(0, pathEnv.length)\n}\n\nfunction whichSync (cmd, opt) {\n  opt = opt || {}\n\n  var info = getPathInfo(cmd, opt)\n  var pathEnv = info.env\n  var pathExt = info.ext\n  var pathExtExe = info.extExe\n  var found = []\n\n  for (var i = 0, l = pathEnv.length; i < l; i ++) {\n    var pathPart = pathEnv[i]\n    if (pathPart.charAt(0) === '\"' && pathPart.slice(-1) === '\"')\n      pathPart = pathPart.slice(1, -1)\n\n    var p = path.join(pathPart, cmd)\n    if (!pathPart && /^\\.[\\\\\\/]/.test(cmd)) {\n      p = cmd.slice(0, 2) + p\n    }\n    for (var j = 0, ll = pathExt.length; j < ll; j ++) {\n      var cur = p + pathExt[j]\n      var is\n      try {\n        is = isexe.sync(cur, { pathExt: pathExtExe })\n        if (is) {\n          if (opt.all)\n            found.push(cur)\n          else\n            return cur\n        }\n      } catch (ex) {}\n    }\n  }\n\n  if (opt.all && found.length)\n    return found\n\n  if (opt.nothrow)\n    return null\n\n  throw getNotFoundError(cmd)\n}\n","/*jshint node:true, laxcomma:true*/\n'use strict';\n\nvar spawn = require('child_process').spawn;\n\n\nfunction legacyTag(key) { return key.match(/^TAG:/); }\nfunction legacyDisposition(key) { return key.match(/^DISPOSITION:/); }\n\nfunction parseFfprobeOutput(out) {\n  var lines = out.split(/\\r\\n|\\r|\\n/);\n\n  lines = lines.filter(function (line) {\n    return line.length > 0;\n  });\n\n  var data = {\n    streams: [],\n    format: {},\n    chapters: []\n  };\n\n  function parseBlock(name) {\n    var data = {};\n\n    var line = lines.shift();\n    while (typeof line !== 'undefined') {\n      if (line.toLowerCase() == '[/'+name+']') {\n        return data;\n      } else if (line.match(/^\\[/)) {\n        line = lines.shift();\n        continue;\n      }\n\n      var kv = line.match(/^([^=]+)=(.*)$/);\n      if (kv) {\n        if (!(kv[1].match(/^TAG:/)) && kv[2].match(/^[0-9]+(\\.[0-9]+)?$/)) {\n          data[kv[1]] = Number(kv[2]);\n        } else {\n          data[kv[1]] = kv[2];\n        }\n      }\n\n      line = lines.shift();\n    }\n\n    return data;\n  }\n\n  var line = lines.shift();\n  while (typeof line !== 'undefined') {\n    if (line.match(/^\\[stream/i)) {\n      var stream = parseBlock('stream');\n      data.streams.push(stream);\n    } else if (line.match(/^\\[chapter/i)) {\n      var chapter = parseBlock('chapter');\n      data.chapters.push(chapter);\n    } else if (line.toLowerCase() === '[format]') {\n      data.format = parseBlock('format');\n    }\n\n    line = lines.shift();\n  }\n\n  return data;\n}\n\n\n\nmodule.exports = function(proto) {\n  /**\n   * A callback passed to the {@link FfmpegCommand#ffprobe} method.\n   *\n   * @callback FfmpegCommand~ffprobeCallback\n   *\n   * @param {Error|null} err error object or null if no error happened\n   * @param {Object} ffprobeData ffprobe output data; this object\n   *   has the same format as what the following command returns:\n   *\n   *     `ffprobe -print_format json -show_streams -show_format INPUTFILE`\n   * @param {Array} ffprobeData.streams stream information\n   * @param {Object} ffprobeData.format format information\n   */\n\n  /**\n   * Run ffprobe on last specified input\n   *\n   * @method FfmpegCommand#ffprobe\n   * @category Metadata\n   *\n   * @param {?Number} [index] 0-based index of input to probe (defaults to last input)\n   * @param {?String[]} [options] array of output options to return\n   * @param {FfmpegCommand~ffprobeCallback} callback callback function\n   *\n   */\n  proto.ffprobe = function() {\n    var input, index = null, options = [], callback;\n\n    // the last argument should be the callback\n    var callback = arguments[arguments.length - 1];\n\n    var ended = false\n    function handleCallback(err, data) {\n      if (!ended) {\n        ended = true;\n        callback(err, data);\n      }\n    };\n\n    // map the arguments to the correct variable names\n    switch (arguments.length) {\n      case 3:\n        index = arguments[0];\n        options = arguments[1];\n        break;\n      case 2:\n        if (typeof arguments[0] === 'number') {\n          index = arguments[0];\n        } else if (Array.isArray(arguments[0])) {\n          options = arguments[0];\n        }\n        break;\n    }\n\n\n    if (index === null) {\n      if (!this._currentInput) {\n        return handleCallback(new Error('No input specified'));\n      }\n\n      input = this._currentInput;\n    } else {\n      input = this._inputs[index];\n\n      if (!input) {\n        return handleCallback(new Error('Invalid input index'));\n      }\n    }\n\n    // Find ffprobe\n    this._getFfprobePath(function(err, path) {\n      if (err) {\n        return handleCallback(err);\n      } else if (!path) {\n        return handleCallback(new Error('Cannot find ffprobe'));\n      }\n\n      var stdout = '';\n      var stdoutClosed = false;\n      var stderr = '';\n      var stderrClosed = false;\n\n      // Spawn ffprobe\n      var src = input.isStream ? 'pipe:0' : input.source;\n      var ffprobe = spawn(path, ['-show_streams', '-show_format'].concat(options, src), {windowsHide: true});\n\n      if (input.isStream) {\n        // Skip errors on stdin. These get thrown when ffprobe is complete and\n        // there seems to be no way hook in and close stdin before it throws.\n        ffprobe.stdin.on('error', function(err) {\n          if (['ECONNRESET', 'EPIPE', 'EOF'].indexOf(err.code) >= 0) { return; }\n          handleCallback(err);\n        });\n\n        // Once ffprobe's input stream closes, we need no more data from the\n        // input\n        ffprobe.stdin.on('close', function() {\n            input.source.pause();\n            input.source.unpipe(ffprobe.stdin);\n        });\n\n        input.source.pipe(ffprobe.stdin);\n      }\n\n      ffprobe.on('error', callback);\n\n      // Ensure we wait for captured streams to end before calling callback\n      var exitError = null;\n      function handleExit(err) {\n        if (err) {\n          exitError = err;\n        }\n\n        if (processExited && stdoutClosed && stderrClosed) {\n          if (exitError) {\n            if (stderr) {\n              exitError.message += '\\n' + stderr;\n            }\n\n            return handleCallback(exitError);\n          }\n\n          // Process output\n          var data = parseFfprobeOutput(stdout);\n\n          // Handle legacy output with \"TAG:x\" and \"DISPOSITION:x\" keys\n          [data.format].concat(data.streams).forEach(function(target) {\n            if (target) {\n              var legacyTagKeys = Object.keys(target).filter(legacyTag);\n\n              if (legacyTagKeys.length) {\n                target.tags = target.tags || {};\n\n                legacyTagKeys.forEach(function(tagKey) {\n                  target.tags[tagKey.substr(4)] = target[tagKey];\n                  delete target[tagKey];\n                });\n              }\n\n              var legacyDispositionKeys = Object.keys(target).filter(legacyDisposition);\n\n              if (legacyDispositionKeys.length) {\n                target.disposition = target.disposition || {};\n\n                legacyDispositionKeys.forEach(function(dispositionKey) {\n                  target.disposition[dispositionKey.substr(12)] = target[dispositionKey];\n                  delete target[dispositionKey];\n                });\n              }\n            }\n          });\n\n          handleCallback(null, data);\n        }\n      }\n\n      // Handle ffprobe exit\n      var processExited = false;\n      ffprobe.on('exit', function(code, signal) {\n        processExited = true;\n\n        if (code) {\n          handleExit(new Error('ffprobe exited with code ' + code));\n        } else if (signal) {\n          handleExit(new Error('ffprobe was killed with signal ' + signal));\n        } else {\n          handleExit();\n        }\n      });\n\n      // Handle stdout/stderr streams\n      ffprobe.stdout.on('data', function(data) {\n        stdout += data;\n      });\n\n      ffprobe.stdout.on('close', function() {\n        stdoutClosed = true;\n        handleExit();\n      });\n\n      ffprobe.stderr.on('data', function(data) {\n        stderr += data;\n      });\n\n      ffprobe.stderr.on('close', function() {\n        stderrClosed = true;\n        handleExit();\n      });\n    });\n  };\n};\n","const path = require('path');\nconst ffmpeg = require('fluent-ffmpeg');\nconst { getFfmpegBinaryPath, getFfprobeBinaryPath } = require('./utils/ffmpegPath');\nconst fs = require('fs');\nconst os = require('os');\n\n// Configure FFmpeg paths\nffmpeg.setFfmpegPath(getFfmpegBinaryPath());\nffmpeg.setFfprobePath(getFfprobeBinaryPath());\n\n/**\n * Error types for consistent error handling\n */\nconst ERROR_TYPES = {\n  FFMPEG_ERROR: 'FFMPEG_ERROR',\n  CORRUPT_VIDEO: 'CORRUPT_VIDEO',\n  FILE_NOT_FOUND: 'FILE_NOT_FOUND',\n  PERMISSION_DENIED: 'PERMISSION_DENIED',\n  INVALID_FORMAT: 'INVALID_FORMAT'\n};\n\n/**\n * Create a timeout promise\n * @param {number} ms - Timeout in milliseconds\n * @returns {Promise} Promise that rejects after timeout\n */\nfunction timeout(ms) {\n  return new Promise((_, reject) => \n    setTimeout(() => reject(new Error('TIMEOUT')), ms)\n  );\n}\n\n/**\n * Extract metadata from video file using ffprobe\n * @param {string} filePath - Absolute path to video file\n * @returns {Promise<Object>} Video metadata\n */\nasync function extractMetadata(filePath) {\n  return new Promise((resolve, reject) => {\n    console.debug('[Metadata] Starting ffprobe for', filePath);\n    ffmpeg.ffprobe(filePath, (err, data) => {\n      if (err) {\n        const errorMsg = err.message || '';\n        \n        // Classify the error type based on ffprobe output\n        let errorType = ERROR_TYPES.FFMPEG_ERROR;\n        let userMessage = 'Failed to read video file';\n        \n        if (errorMsg.includes('moov atom not found') || errorMsg.includes('Invalid data found')) {\n          errorType = ERROR_TYPES.CORRUPT_VIDEO;\n          userMessage = 'Video file is corrupted or incomplete. The file may not have finished uploading/downloading.';\n        } else if (errorMsg.includes('No such file') || errorMsg.includes('does not exist')) {\n          errorType = ERROR_TYPES.FILE_NOT_FOUND;\n          userMessage = 'Video file not found';\n        } else if (errorMsg.includes('Permission denied')) {\n          errorType = ERROR_TYPES.PERMISSION_DENIED;\n          userMessage = 'Permission denied when accessing video file';\n        } else if (errorMsg.includes('not a valid')) {\n          errorType = ERROR_TYPES.INVALID_FORMAT;\n          userMessage = 'Video format not supported';\n        }\n        \n        console.error('[Metadata] ffprobe error', {\n          errorType,\n          userMessage,\n          rawMessage: err.message,\n          code: err.code,\n          errno: err.errno,\n          path: err.path,\n          spawnargs: err.spawnargs\n        });\n        \n        const error = new Error(errorType);\n        error.userMessage = userMessage;\n        error.details = errorMsg;\n        error.raw = err;\n        reject(error);\n        return;\n      }\n      \n      // Find video stream\n      const videoStream = data.streams.find(s => s.codec_type === 'video');\n      if (!videoStream) {\n        console.warn('[Metadata] No video stream detected in ffprobe response');\n        const error = new Error(ERROR_TYPES.CORRUPT_VIDEO);\n        error.userMessage = 'No video stream found in file';\n        reject(error);\n        return;\n      }\n      \n      console.debug('[Metadata] ffprobe raw response snapshot', {\n        formatName: data.format?.format_name,\n        duration: data.format?.duration,\n        size: data.format?.size,\n        bitRate: data.format?.bit_rate,\n        videoCodec: videoStream.codec_name,\n        audioStreamCount: data.streams.filter(s => s.codec_type === 'audio').length\n      });\n\n      console.debug('[Metadata] ffprobe succeeded, video stream found', {\n        codec: videoStream.codec_name,\n        resolution: `${videoStream.width}x${videoStream.height}`,\n        duration: data.format.duration\n      });\n      \n      resolve({\n        duration: parseFloat(data.format.duration) || 0,\n        width: videoStream.width || 0,\n        height: videoStream.height || 0,\n        codec: videoStream.codec_name || 'unknown',\n        bitrate: parseInt(data.format.bit_rate) || 0,\n      });\n    });\n  });\n}\n\n/**\n * Generate thumbnail from video at specific timestamp\n * @param {string} filePath - Absolute path to video file\n * @param {string} timestamp - Timestamp (e.g., '00:00:01')\n * @returns {Promise<string>} Base64 encoded thumbnail\n */\nasync function generateThumbnailAtTime(filePath, timestamp) {\n  return new Promise((resolve, reject) => {\n    console.debug('[Thumbnail] Attempting screenshot', { filePath, timestamp });\n    const tempPath = path.join(os.tmpdir(), `thumb_${Date.now()}_${Math.random().toString(36).substr(2, 9)}.jpg`);\n    \n    ffmpeg(filePath)\n      .on('start', (cmdLine) => {\n        console.debug('[Thumbnail] ffmpeg command started', { timestamp, cmdLine });\n      })\n      .on('stderr', (line) => {\n        console.debug('[Thumbnail][stderr]', line.trim());\n      })\n      .screenshots({\n        timestamps: [timestamp],\n        filename: path.basename(tempPath),\n        folder: path.dirname(tempPath),\n        size: '320x180'\n      })\n      .on('end', () => {\n        try {\n          console.debug('[Thumbnail] Screenshot succeeded', { tempPath });\n          // Read file and convert to base64\n          const imageBuffer = fs.readFileSync(tempPath);\n          const base64 = imageBuffer.toString('base64');\n          \n          // Clean up temp file\n          fs.unlinkSync(tempPath);\n          \n          resolve(`data:image/jpeg;base64,${base64}`);\n        } catch (err) {\n          console.error('[Thumbnail] Error reading generated image', {\n            message: err.message,\n            code: err.code,\n            errno: err.errno,\n            path: err.path\n          });\n          reject(new Error(ERROR_TYPES.FFMPEG_ERROR));\n        }\n      })\n      .on('error', (err) => {\n        console.error('[Thumbnail] Generation error', {\n          message: err.message,\n          code: err.code,\n          errno: err.errno,\n          path: err.path,\n          spawnargs: err.spawnargs\n        });\n        // Clean up temp file if it exists\n        if (fs.existsSync(tempPath)) {\n          fs.unlinkSync(tempPath);\n        }\n        reject(new Error(ERROR_TYPES.FFMPEG_ERROR));\n      });\n  });\n}\n\n/**\n * Generate thumbnail with fallback timestamps\n * @param {string} filePath - Absolute path to video file\n * @returns {Promise<string>} Base64 encoded thumbnail\n */\nasync function generateThumbnail(filePath) {\n  const timestamps = ['00:00:01', '00:00:00', '00:00:05'];\n  \n  for (const timestamp of timestamps) {\n    try {\n      return await generateThumbnailAtTime(filePath, timestamp);\n    } catch (err) {\n      console.warn('[Thumbnail] Failed attempt, trying next timestamp', { timestamp, reason: err.message });\n      continue;\n    }\n  }\n  \n  // If all timestamps fail, return placeholder\n  throw new Error(ERROR_TYPES.FFMPEG_ERROR);\n}\n\n/**\n * Get complete metadata for a video file\n * @param {string} filePath - Absolute path to video file\n * @returns {Promise<Object>} Complete metadata including thumbnail\n */\nasync function getMetadata(filePath) {\n  try {\n    console.log('[Metadata] ========== Starting metadata extraction ==========');\n    console.log('[Metadata] File path:', filePath);\n    \n    // Validate file exists\n    if (!fs.existsSync(filePath)) {\n      console.warn('[Metadata] File not found at path', filePath);\n      throw new Error(ERROR_TYPES.FILE_NOT_FOUND);\n    }\n\n    // Get file stats for logging\n    try {\n      const stats = fs.statSync(filePath);\n      console.log('[Metadata] File info:', {\n        size: `${(stats.size / 1024 / 1024).toFixed(2)} MB`,\n        sizeBytes: stats.size,\n        modified: stats.mtime.toISOString(),\n        created: stats.birthtime.toISOString(),\n        isFile: stats.isFile(),\n        extension: path.extname(filePath)\n      });\n    } catch (err) {\n      console.warn('[Metadata] Could not read file stats:', err.message);\n    }\n\n    // Check file permissions\n    try {\n      fs.accessSync(filePath, fs.constants.R_OK);\n      console.log('[Metadata] File is readable ✓');\n    } catch (err) {\n      console.warn('[Metadata] Permission denied when accessing file', { filePath, err });\n      throw new Error(ERROR_TYPES.PERMISSION_DENIED);\n    }\n\n    // Extract metadata with timeout\n    const metadataPromise = extractMetadata(filePath);\n    const metadata = await Promise.race([\n      metadataPromise,\n      timeout(30000) // 30 second timeout\n    ]);\n\n    console.debug('[Metadata] Core data extracted', metadata);\n\n    // Generate thumbnail with timeout\n    const thumbnailPromise = generateThumbnail(filePath);\n    const thumbnail = await Promise.race([\n      thumbnailPromise,\n      timeout(30000) // 30 second timeout\n    ]);\n\n    console.log('[Metadata] Thumbnail generated successfully ✓');\n    console.log('[Metadata] ========== Metadata extraction complete ==========');\n    console.log('[Metadata] Final metadata package:', {\n      duration: metadata.duration,\n      width: metadata.width,\n      height: metadata.height,\n      codec: metadata.codec,\n      hasThumbnail: !!thumbnail\n    });\n\n    return {\n      ...metadata,\n      thumbnail\n    };\n  } catch (err) {\n    console.error('[Metadata] ========== Metadata extraction FAILED ==========');\n    console.error('[Metadata] Error details:', {\n      type: err.message,\n      userMessage: err.userMessage || 'Unknown error',\n      hasDetails: !!err.details,\n      details: err.details,\n      stack: err.stack\n    });\n    \n    // Re-throw with enhanced error info\n    throw err;\n  }\n}\n\nmodule.exports = { getMetadata };\n","/*jshint node:true*/\n'use strict';\n\nvar fs = require('fs');\nvar path = require('path');\nvar async = require('async');\nvar utils = require('./utils');\n\n/*\n *! Capability helpers\n */\n\nvar avCodecRegexp = /^\\s*([D ])([E ])([VAS])([S ])([D ])([T ]) ([^ ]+) +(.*)$/;\nvar ffCodecRegexp = /^\\s*([D\\.])([E\\.])([VAS])([I\\.])([L\\.])([S\\.]) ([^ ]+) +(.*)$/;\nvar ffEncodersRegexp = /\\(encoders:([^\\)]+)\\)/;\nvar ffDecodersRegexp = /\\(decoders:([^\\)]+)\\)/;\nvar encodersRegexp = /^\\s*([VAS\\.])([F\\.])([S\\.])([X\\.])([B\\.])([D\\.]) ([^ ]+) +(.*)$/;\nvar formatRegexp = /^\\s*([D ])([E ])\\s+([^ ]+)\\s+(.*)$/;\nvar lineBreakRegexp = /\\r\\n|\\r|\\n/;\nvar filterRegexp = /^(?: [T\\.][S\\.][C\\.] )?([^ ]+) +(AA?|VV?|\\|)->(AA?|VV?|\\|) +(.*)$/;\n\nvar cache = {};\n\nmodule.exports = function(proto) {\n  /**\n   * Manually define the ffmpeg binary full path.\n   *\n   * @method FfmpegCommand#setFfmpegPath\n   *\n   * @param {String} ffmpegPath The full path to the ffmpeg binary.\n   * @return FfmpegCommand\n   */\n  proto.setFfmpegPath = function(ffmpegPath) {\n    cache.ffmpegPath = ffmpegPath;\n    return this;\n  };\n\n  /**\n   * Manually define the ffprobe binary full path.\n   *\n   * @method FfmpegCommand#setFfprobePath\n   *\n   * @param {String} ffprobePath The full path to the ffprobe binary.\n   * @return FfmpegCommand\n   */\n  proto.setFfprobePath = function(ffprobePath) {\n    cache.ffprobePath = ffprobePath;\n    return this;\n  };\n\n  /**\n   * Manually define the flvtool2/flvmeta binary full path.\n   *\n   * @method FfmpegCommand#setFlvtoolPath\n   *\n   * @param {String} flvtool The full path to the flvtool2 or flvmeta binary.\n   * @return FfmpegCommand\n   */\n  proto.setFlvtoolPath = function(flvtool) {\n    cache.flvtoolPath = flvtool;\n    return this;\n  };\n\n  /**\n   * Forget executable paths\n   *\n   * (only used for testing purposes)\n   *\n   * @method FfmpegCommand#_forgetPaths\n   * @private\n   */\n  proto._forgetPaths = function() {\n    delete cache.ffmpegPath;\n    delete cache.ffprobePath;\n    delete cache.flvtoolPath;\n  };\n\n  /**\n   * Check for ffmpeg availability\n   *\n   * If the FFMPEG_PATH environment variable is set, try to use it.\n   * If it is unset or incorrect, try to find ffmpeg in the PATH instead.\n   *\n   * @method FfmpegCommand#_getFfmpegPath\n   * @param {Function} callback callback with signature (err, path)\n   * @private\n   */\n  proto._getFfmpegPath = function(callback) {\n    if ('ffmpegPath' in cache) {\n      return callback(null, cache.ffmpegPath);\n    }\n\n    async.waterfall([\n      // Try FFMPEG_PATH\n      function(cb) {\n        if (process.env.FFMPEG_PATH) {\n          fs.exists(process.env.FFMPEG_PATH, function(exists) {\n            if (exists) {\n              cb(null, process.env.FFMPEG_PATH);\n            } else {\n              cb(null, '');\n            }\n          });\n        } else {\n          cb(null, '');\n        }\n      },\n\n      // Search in the PATH\n      function(ffmpeg, cb) {\n        if (ffmpeg.length) {\n          return cb(null, ffmpeg);\n        }\n\n        utils.which('ffmpeg', function(err, ffmpeg) {\n          cb(err, ffmpeg);\n        });\n      }\n    ], function(err, ffmpeg) {\n      if (err) {\n        callback(err);\n      } else {\n        callback(null, cache.ffmpegPath = (ffmpeg || ''));\n      }\n    });\n  };\n\n\n  /**\n   * Check for ffprobe availability\n   *\n   * If the FFPROBE_PATH environment variable is set, try to use it.\n   * If it is unset or incorrect, try to find ffprobe in the PATH instead.\n   * If this still fails, try to find ffprobe in the same directory as ffmpeg.\n   *\n   * @method FfmpegCommand#_getFfprobePath\n   * @param {Function} callback callback with signature (err, path)\n   * @private\n   */\n  proto._getFfprobePath = function(callback) {\n    var self = this;\n\n    if ('ffprobePath' in cache) {\n      return callback(null, cache.ffprobePath);\n    }\n\n    async.waterfall([\n      // Try FFPROBE_PATH\n      function(cb) {\n        if (process.env.FFPROBE_PATH) {\n          fs.exists(process.env.FFPROBE_PATH, function(exists) {\n            cb(null, exists ? process.env.FFPROBE_PATH : '');\n          });\n        } else {\n          cb(null, '');\n        }\n      },\n\n      // Search in the PATH\n      function(ffprobe, cb) {\n        if (ffprobe.length) {\n          return cb(null, ffprobe);\n        }\n\n        utils.which('ffprobe', function(err, ffprobe) {\n          cb(err, ffprobe);\n        });\n      },\n\n      // Search in the same directory as ffmpeg\n      function(ffprobe, cb) {\n        if (ffprobe.length) {\n          return cb(null, ffprobe);\n        }\n\n        self._getFfmpegPath(function(err, ffmpeg) {\n          if (err) {\n            cb(err);\n          } else if (ffmpeg.length) {\n            var name = utils.isWindows ? 'ffprobe.exe' : 'ffprobe';\n            var ffprobe = path.join(path.dirname(ffmpeg), name);\n            fs.exists(ffprobe, function(exists) {\n              cb(null, exists ? ffprobe : '');\n            });\n          } else {\n            cb(null, '');\n          }\n        });\n      }\n    ], function(err, ffprobe) {\n      if (err) {\n        callback(err);\n      } else {\n        callback(null, cache.ffprobePath = (ffprobe || ''));\n      }\n    });\n  };\n\n\n  /**\n   * Check for flvtool2/flvmeta availability\n   *\n   * If the FLVTOOL2_PATH or FLVMETA_PATH environment variable are set, try to use them.\n   * If both are either unset or incorrect, try to find flvtool2 or flvmeta in the PATH instead.\n   *\n   * @method FfmpegCommand#_getFlvtoolPath\n   * @param {Function} callback callback with signature (err, path)\n   * @private\n   */\n   proto._getFlvtoolPath = function(callback) {\n    if ('flvtoolPath' in cache) {\n      return callback(null, cache.flvtoolPath);\n    }\n\n    async.waterfall([\n      // Try FLVMETA_PATH\n      function(cb) {\n        if (process.env.FLVMETA_PATH) {\n          fs.exists(process.env.FLVMETA_PATH, function(exists) {\n            cb(null, exists ? process.env.FLVMETA_PATH : '');\n          });\n        } else {\n          cb(null, '');\n        }\n      },\n\n      // Try FLVTOOL2_PATH\n      function(flvtool, cb) {\n        if (flvtool.length) {\n          return cb(null, flvtool);\n        }\n\n        if (process.env.FLVTOOL2_PATH) {\n          fs.exists(process.env.FLVTOOL2_PATH, function(exists) {\n            cb(null, exists ? process.env.FLVTOOL2_PATH : '');\n          });\n        } else {\n          cb(null, '');\n        }\n      },\n\n      // Search for flvmeta in the PATH\n      function(flvtool, cb) {\n        if (flvtool.length) {\n          return cb(null, flvtool);\n        }\n\n        utils.which('flvmeta', function(err, flvmeta) {\n          cb(err, flvmeta);\n        });\n      },\n\n      // Search for flvtool2 in the PATH\n      function(flvtool, cb) {\n        if (flvtool.length) {\n          return cb(null, flvtool);\n        }\n\n        utils.which('flvtool2', function(err, flvtool2) {\n          cb(err, flvtool2);\n        });\n      },\n    ], function(err, flvtool) {\n      if (err) {\n        callback(err);\n      } else {\n        callback(null, cache.flvtoolPath = (flvtool || ''));\n      }\n    });\n  };\n\n\n  /**\n   * A callback passed to {@link FfmpegCommand#availableFilters}.\n   *\n   * @callback FfmpegCommand~filterCallback\n   * @param {Error|null} err error object or null if no error happened\n   * @param {Object} filters filter object with filter names as keys and the following\n   *   properties for each filter:\n   * @param {String} filters.description filter description\n   * @param {String} filters.input input type, one of 'audio', 'video' and 'none'\n   * @param {Boolean} filters.multipleInputs whether the filter supports multiple inputs\n   * @param {String} filters.output output type, one of 'audio', 'video' and 'none'\n   * @param {Boolean} filters.multipleOutputs whether the filter supports multiple outputs\n   */\n\n  /**\n   * Query ffmpeg for available filters\n   *\n   * @method FfmpegCommand#availableFilters\n   * @category Capabilities\n   * @aliases getAvailableFilters\n   *\n   * @param {FfmpegCommand~filterCallback} callback callback function\n   */\n  proto.availableFilters =\n  proto.getAvailableFilters = function(callback) {\n    if ('filters' in cache) {\n      return callback(null, cache.filters);\n    }\n\n    this._spawnFfmpeg(['-filters'], { captureStdout: true, stdoutLines: 0 }, function (err, stdoutRing) {\n      if (err) {\n        return callback(err);\n      }\n\n      var stdout = stdoutRing.get();\n      var lines = stdout.split('\\n');\n      var data = {};\n      var types = { A: 'audio', V: 'video', '|': 'none' };\n\n      lines.forEach(function(line) {\n        var match = line.match(filterRegexp);\n        if (match) {\n          data[match[1]] = {\n            description: match[4],\n            input: types[match[2].charAt(0)],\n            multipleInputs: match[2].length > 1,\n            output: types[match[3].charAt(0)],\n            multipleOutputs: match[3].length > 1\n          };\n        }\n      });\n\n      callback(null, cache.filters = data);\n    });\n  };\n\n\n  /**\n   * A callback passed to {@link FfmpegCommand#availableCodecs}.\n   *\n   * @callback FfmpegCommand~codecCallback\n   * @param {Error|null} err error object or null if no error happened\n   * @param {Object} codecs codec object with codec names as keys and the following\n   *   properties for each codec (more properties may be available depending on the\n   *   ffmpeg version used):\n   * @param {String} codecs.description codec description\n   * @param {Boolean} codecs.canDecode whether the codec is able to decode streams\n   * @param {Boolean} codecs.canEncode whether the codec is able to encode streams\n   */\n\n  /**\n   * Query ffmpeg for available codecs\n   *\n   * @method FfmpegCommand#availableCodecs\n   * @category Capabilities\n   * @aliases getAvailableCodecs\n   *\n   * @param {FfmpegCommand~codecCallback} callback callback function\n   */\n  proto.availableCodecs =\n  proto.getAvailableCodecs = function(callback) {\n    if ('codecs' in cache) {\n      return callback(null, cache.codecs);\n    }\n\n    this._spawnFfmpeg(['-codecs'], { captureStdout: true, stdoutLines: 0 }, function(err, stdoutRing) {\n      if (err) {\n        return callback(err);\n      }\n\n      var stdout = stdoutRing.get();\n      var lines = stdout.split(lineBreakRegexp);\n      var data = {};\n\n      lines.forEach(function(line) {\n        var match = line.match(avCodecRegexp);\n        if (match && match[7] !== '=') {\n          data[match[7]] = {\n            type: { 'V': 'video', 'A': 'audio', 'S': 'subtitle' }[match[3]],\n            description: match[8],\n            canDecode: match[1] === 'D',\n            canEncode: match[2] === 'E',\n            drawHorizBand: match[4] === 'S',\n            directRendering: match[5] === 'D',\n            weirdFrameTruncation: match[6] === 'T'\n          };\n        }\n\n        match = line.match(ffCodecRegexp);\n        if (match && match[7] !== '=') {\n          var codecData = data[match[7]] = {\n            type: { 'V': 'video', 'A': 'audio', 'S': 'subtitle' }[match[3]],\n            description: match[8],\n            canDecode: match[1] === 'D',\n            canEncode: match[2] === 'E',\n            intraFrameOnly: match[4] === 'I',\n            isLossy: match[5] === 'L',\n            isLossless: match[6] === 'S'\n          };\n\n          var encoders = codecData.description.match(ffEncodersRegexp);\n          encoders = encoders ? encoders[1].trim().split(' ') : [];\n\n          var decoders = codecData.description.match(ffDecodersRegexp);\n          decoders = decoders ? decoders[1].trim().split(' ') : [];\n\n          if (encoders.length || decoders.length) {\n            var coderData = {};\n            utils.copy(codecData, coderData);\n            delete coderData.canEncode;\n            delete coderData.canDecode;\n\n            encoders.forEach(function(name) {\n              data[name] = {};\n              utils.copy(coderData, data[name]);\n              data[name].canEncode = true;\n            });\n\n            decoders.forEach(function(name) {\n              if (name in data) {\n                data[name].canDecode = true;\n              } else {\n                data[name] = {};\n                utils.copy(coderData, data[name]);\n                data[name].canDecode = true;\n              }\n            });\n          }\n        }\n      });\n\n      callback(null, cache.codecs = data);\n    });\n  };\n\n\n  /**\n   * A callback passed to {@link FfmpegCommand#availableEncoders}.\n   *\n   * @callback FfmpegCommand~encodersCallback\n   * @param {Error|null} err error object or null if no error happened\n   * @param {Object} encoders encoders object with encoder names as keys and the following\n   *   properties for each encoder:\n   * @param {String} encoders.description codec description\n   * @param {Boolean} encoders.type \"audio\", \"video\" or \"subtitle\"\n   * @param {Boolean} encoders.frameMT whether the encoder is able to do frame-level multithreading\n   * @param {Boolean} encoders.sliceMT whether the encoder is able to do slice-level multithreading\n   * @param {Boolean} encoders.experimental whether the encoder is experimental\n   * @param {Boolean} encoders.drawHorizBand whether the encoder supports draw_horiz_band\n   * @param {Boolean} encoders.directRendering whether the encoder supports direct encoding method 1\n   */\n\n  /**\n   * Query ffmpeg for available encoders\n   *\n   * @method FfmpegCommand#availableEncoders\n   * @category Capabilities\n   * @aliases getAvailableEncoders\n   *\n   * @param {FfmpegCommand~encodersCallback} callback callback function\n   */\n  proto.availableEncoders =\n  proto.getAvailableEncoders = function(callback) {\n    if ('encoders' in cache) {\n      return callback(null, cache.encoders);\n    }\n\n    this._spawnFfmpeg(['-encoders'], { captureStdout: true, stdoutLines: 0 }, function(err, stdoutRing) {\n      if (err) {\n        return callback(err);\n      }\n\n      var stdout = stdoutRing.get();\n      var lines = stdout.split(lineBreakRegexp);\n      var data = {};\n\n      lines.forEach(function(line) {\n        var match = line.match(encodersRegexp);\n        if (match && match[7] !== '=') {\n          data[match[7]] = {\n            type: { 'V': 'video', 'A': 'audio', 'S': 'subtitle' }[match[1]],\n            description: match[8],\n            frameMT: match[2] === 'F',\n            sliceMT: match[3] === 'S',\n            experimental: match[4] === 'X',\n            drawHorizBand: match[5] === 'B',\n            directRendering: match[6] === 'D'\n          };\n        }\n      });\n\n      callback(null, cache.encoders = data);\n    });\n  };\n\n\n  /**\n   * A callback passed to {@link FfmpegCommand#availableFormats}.\n   *\n   * @callback FfmpegCommand~formatCallback\n   * @param {Error|null} err error object or null if no error happened\n   * @param {Object} formats format object with format names as keys and the following\n   *   properties for each format:\n   * @param {String} formats.description format description\n   * @param {Boolean} formats.canDemux whether the format is able to demux streams from an input file\n   * @param {Boolean} formats.canMux whether the format is able to mux streams into an output file\n   */\n\n  /**\n   * Query ffmpeg for available formats\n   *\n   * @method FfmpegCommand#availableFormats\n   * @category Capabilities\n   * @aliases getAvailableFormats\n   *\n   * @param {FfmpegCommand~formatCallback} callback callback function\n   */\n  proto.availableFormats =\n  proto.getAvailableFormats = function(callback) {\n    if ('formats' in cache) {\n      return callback(null, cache.formats);\n    }\n\n    // Run ffmpeg -formats\n    this._spawnFfmpeg(['-formats'], { captureStdout: true, stdoutLines: 0 }, function (err, stdoutRing) {\n      if (err) {\n        return callback(err);\n      }\n\n      // Parse output\n      var stdout = stdoutRing.get();\n      var lines = stdout.split(lineBreakRegexp);\n      var data = {};\n\n      lines.forEach(function(line) {\n        var match = line.match(formatRegexp);\n        if (match) {\n          match[3].split(',').forEach(function(format) {\n            if (!(format in data)) {\n              data[format] = {\n                description: match[4],\n                canDemux: false,\n                canMux: false\n              };\n            }\n\n            if (match[1] === 'D') {\n              data[format].canDemux = true;\n            }\n            if (match[2] === 'E') {\n              data[format].canMux = true;\n            }\n          });\n        }\n      });\n\n      callback(null, cache.formats = data);\n    });\n  };\n\n\n  /**\n   * Check capabilities before executing a command\n   *\n   * Checks whether all used codecs and formats are indeed available\n   *\n   * @method FfmpegCommand#_checkCapabilities\n   * @param {Function} callback callback with signature (err)\n   * @private\n   */\n  proto._checkCapabilities = function(callback) {\n    var self = this;\n    async.waterfall([\n      // Get available formats\n      function(cb) {\n        self.availableFormats(cb);\n      },\n\n      // Check whether specified formats are available\n      function(formats, cb) {\n        var unavailable;\n\n        // Output format(s)\n        unavailable = self._outputs\n          .reduce(function(fmts, output) {\n            var format = output.options.find('-f', 1);\n            if (format) {\n              if (!(format[0] in formats) || !(formats[format[0]].canMux)) {\n                fmts.push(format);\n              }\n            }\n\n            return fmts;\n          }, []);\n\n        if (unavailable.length === 1) {\n          return cb(new Error('Output format ' + unavailable[0] + ' is not available'));\n        } else if (unavailable.length > 1) {\n          return cb(new Error('Output formats ' + unavailable.join(', ') + ' are not available'));\n        }\n\n        // Input format(s)\n        unavailable = self._inputs\n          .reduce(function(fmts, input) {\n            var format = input.options.find('-f', 1);\n            if (format) {\n              if (!(format[0] in formats) || !(formats[format[0]].canDemux)) {\n                fmts.push(format[0]);\n              }\n            }\n\n            return fmts;\n          }, []);\n\n        if (unavailable.length === 1) {\n          return cb(new Error('Input format ' + unavailable[0] + ' is not available'));\n        } else if (unavailable.length > 1) {\n          return cb(new Error('Input formats ' + unavailable.join(', ') + ' are not available'));\n        }\n\n        cb();\n      },\n\n      // Get available codecs\n      function(cb) {\n        self.availableEncoders(cb);\n      },\n\n      // Check whether specified codecs are available and add strict experimental options if needed\n      function(encoders, cb) {\n        var unavailable;\n\n        // Audio codec(s)\n        unavailable = self._outputs.reduce(function(cdcs, output) {\n          var acodec = output.audio.find('-acodec', 1);\n          if (acodec && acodec[0] !== 'copy') {\n            if (!(acodec[0] in encoders) || encoders[acodec[0]].type !== 'audio') {\n              cdcs.push(acodec[0]);\n            }\n          }\n\n          return cdcs;\n        }, []);\n\n        if (unavailable.length === 1) {\n          return cb(new Error('Audio codec ' + unavailable[0] + ' is not available'));\n        } else if (unavailable.length > 1) {\n          return cb(new Error('Audio codecs ' + unavailable.join(', ') + ' are not available'));\n        }\n\n        // Video codec(s)\n        unavailable = self._outputs.reduce(function(cdcs, output) {\n          var vcodec = output.video.find('-vcodec', 1);\n          if (vcodec && vcodec[0] !== 'copy') {\n            if (!(vcodec[0] in encoders) || encoders[vcodec[0]].type !== 'video') {\n              cdcs.push(vcodec[0]);\n            }\n          }\n\n          return cdcs;\n        }, []);\n\n        if (unavailable.length === 1) {\n          return cb(new Error('Video codec ' + unavailable[0] + ' is not available'));\n        } else if (unavailable.length > 1) {\n          return cb(new Error('Video codecs ' + unavailable.join(', ') + ' are not available'));\n        }\n\n        cb();\n      }\n    ], callback);\n  };\n};\n","const ffmpeg = require('fluent-ffmpeg');\nconst { getFfmpegBinaryPath, getFfprobeBinaryPath } = require('./utils/ffmpegPath');\nconst fs = require('fs');\nconst path = require('path');\nconst os = require('os');\n\n// Configure FFmpeg path\nffmpeg.setFfmpegPath(getFfmpegBinaryPath());\nffmpeg.setFfprobePath(getFfprobeBinaryPath());\n\n/**\n * Error mapping for user-friendly messages\n */\nconst ERROR_MAP = {\n  'ENOSPC': 'Not enough disk space',\n  'EACCES': 'Permission denied. Check file permissions.',\n  'ENOENT': 'Output directory not found',\n  'ffmpeg': 'Video processing failed',\n  'TIMEOUT': 'Export timed out. Try a shorter video.',\n  'INVALID_CLIPS': 'No clips to export',\n  'EXPORT_FAILED': 'Export failed'\n};\n\n/**\n * Create a timeout promise\n * @param {number} ms - Timeout in milliseconds\n * @returns {Promise} Promise that rejects after timeout\n */\nfunction timeout(ms) {\n  return new Promise((_, reject) => \n    setTimeout(() => reject(new Error('TIMEOUT')), ms)\n  );\n}\n\n/**\n * Extract trimmed segment from a clip with resolution normalization\n * @param {Object} clip - Clip object with filePath, trimStart, trimEnd\n * @param {string} outputPath - Path for the trimmed segment\n * @param {Object} targetResolution - Target resolution {width, height}\n * @returns {Promise<void>}\n */\nasync function extractTrimmedSegment(clip, outputPath, targetResolution, onProgress) {\n  return new Promise((resolve, reject) => {\n    const trimDuration = clip.trimEnd - clip.trimStart;\n    let lastProgress = 0;\n    \n    console.log(`[Export] Extracting segment: ${clip.fileName} (${clip.trimStart}s - ${clip.trimEnd}s)`);\n    \n    ffmpeg(clip.filePath)\n      .on('start', (cmdLine) => {\n        console.log('[Export] FFmpeg command:', cmdLine);\n      })\n      .on('stderr', (line) => {\n        console.debug('[Export][stderr]', line.trim());\n      })\n      .on('progress', (progress) => {\n        const percent = Math.min(Math.round(progress.percent || 0), 100);\n        // Only report meaningful progress increases\n        if (percent > lastProgress + 2) {\n          lastProgress = percent;\n          onProgress(percent);\n        }\n      })\n      .on('end', () => {\n        console.log('[Export] Segment extraction complete:', outputPath);\n        resolve();\n      })\n      .on('error', (err) => {\n        console.error('[Export] Segment extraction failed:', err.message);\n        reject(err);\n      })\n      // Use input seeking for accuracy, then output seeking for precision\n      .seekInput(clip.trimStart)\n      .setDuration(trimDuration)\n      // Video filter: scale + pad + reset PTS to start at 0\n      .outputOptions([\n        '-vf', \n        `scale=${targetResolution.width}:${targetResolution.height}:force_original_aspect_ratio=decrease,pad=${targetResolution.width}:${targetResolution.height}:(ow-iw)/2:(oh-ih)/2,setpts=PTS-STARTPTS`\n      ])\n      // Audio filter: reset PTS to start at 0 and ensure sync\n      .outputOptions(['-af', 'asetpts=PTS-STARTPTS'])\n      // Video encoding\n      .outputOptions(['-c:v', 'libx264', '-preset', 'fast', '-crf', '23'])\n      // Audio: use PCM (no encoder delay) to avoid priming/gaps between segments\n      .outputOptions(['-c:a', 'pcm_s16le', '-ar', '48000', '-ac', '2'])\n      // Force constant frame rate at 30fps\n      .outputOptions(['-r', '30', '-vsync', 'cfr'])\n      // Generate proper timestamps and fix any A/V sync issues\n      .outputOptions(['-fflags', '+genpts', '-async', '1'])\n      // Ensure proper stream mapping\n      .outputOptions(['-map', '0:v:0', '-map', '0:a:0?'])\n      .output(outputPath)\n      .run();\n  });\n}\n\n\n/**\n * Concatenate segments into final output using filter_complex\n * This approach is more robust than concat demuxer for segments with different properties\n * @param {string[]} segmentPaths - Array of segment file paths\n * @param {string} outputPath - Final output path\n * @param {Function} onProgress - Progress callback\n * @returns {Promise<void>}\n */\nasync function concatenateSegments(segmentPaths, outputPath, onProgress) {\n  return new Promise((resolve, reject) => {\n    let lastProgress = 0;\n    \n    // Build filter_complex for concatenation\n    // Since segments are already normalized, we just concatenate them directly\n    const filterComplex = segmentPaths.map((_, index) => `[${index}:v][${index}:a]`).join('') +\n      `concat=n=${segmentPaths.length}:v=1:a=1[vcat][acat]`;\n    \n    console.log('[Export] Using filter_complex concatenation');\n    console.log('[Export] Filter:', filterComplex);\n    console.log('[Export] Segments to concatenate:', segmentPaths.length);\n    \n    let ffmpegCmd = ffmpeg();\n    \n    // Add all segment inputs\n    segmentPaths.forEach(segmentPath => {\n      ffmpegCmd = ffmpegCmd.input(segmentPath);\n    });\n    \n    ffmpegCmd\n      .on('start', (cmdLine) => {\n        console.log('[Export] Concat command:', cmdLine);\n        // Report initial progress when concatenation starts\n        onProgress(0);\n      })\n      .on('stderr', (line) => {\n        console.debug('[Export][concat stderr]', line.trim());\n      })\n      .on('progress', (progress) => {\n        const percent = Math.min(Math.round(progress.percent || 0), 100); // Cap at 100%\n        // Only report progress if it's a meaningful increase (at least 3%)\n        if (percent > lastProgress + 2) {\n          lastProgress = percent;\n          onProgress(percent);\n        }\n      })\n      .on('end', () => {\n        console.log('[Export] Concatenation complete');\n        // Ensure we report 100% completion\n        onProgress(100);\n        resolve();\n      })\n      .on('error', (err) => {\n        console.error('[Export] Concatenation failed:', err.message);\n        reject(err);\n      })\n      .complexFilter(filterComplex)\n      // Map concatenated outputs\n      .outputOptions(['-map', '[vcat]', '-map', '[acat]'])\n      // Final encode: h264 + AAC (one-time encoding, avoids AAC priming between clips)\n      .outputOptions(['-c:v', 'libx264', '-preset', 'fast', '-crf', '23'])\n      .outputOptions(['-c:a', 'aac', '-b:a', '192k', '-ar', '48000', '-ac', '2'])\n      .outputOptions(['-r', '30'])\n      // Ensure proper timing and avoid any PTS issues\n      .outputOptions(['-fflags', '+genpts', '-async', '1'])\n      .output(outputPath)\n      .run();\n  });\n}\n\n/**\n * Clean up temporary files\n * @param {string[]} tempFiles - Array of temporary file paths\n */\nfunction cleanupTempFiles(tempFiles) {\n  tempFiles.forEach(filePath => {\n    try {\n      if (fs.existsSync(filePath)) {\n        fs.unlinkSync(filePath);\n        console.log('[Export] Cleaned up temp file:', filePath);\n      }\n    } catch (err) {\n      console.warn('[Export] Failed to clean up temp file:', filePath, err.message);\n    }\n  });\n}\n\n/**\n * Export timeline to MP4\n * @param {Array} clips - Array of clip objects\n * @param {string} outputPath - Output file path\n * @param {Function} onProgress - Progress callback (0-100)\n * @returns {Promise<string>} Output path on success\n */\nasync function exportTimeline(clips, outputPath, onProgress = () => {}) {\n  if (!clips || clips.length === 0) {\n    throw new Error('INVALID_CLIPS');\n  }\n\n  console.log('[Export] ========== Starting timeline export ==========');\n  console.log('[Export] Clips count:', clips.length);\n  console.log('[Export] Output path:', outputPath);\n\n  // Sort clips by order\n  const sortedClips = [...clips].sort((a, b) => a.order - b.order);\n  console.log('[Export] Sorted clips by order:', sortedClips.map(c => ({ name: c.fileName, order: c.order })));\n\n  // Determine target resolution (use the highest resolution among all clips)\n  const targetResolution = sortedClips.reduce((max, clip) => {\n    const clipPixels = clip.width * clip.height;\n    const maxPixels = max.width * max.height;\n    return clipPixels > maxPixels ? { width: clip.width, height: clip.height } : max;\n  }, { width: sortedClips[0].width, height: sortedClips[0].height });\n  \n  console.log('[Export] Target resolution:', targetResolution);\n\n  const tempDir = os.tmpdir();\n  const tempFiles = [];\n  \n  try {\n    // Validate output directory is writable\n    const outputDir = path.dirname(outputPath);\n    try {\n      fs.accessSync(outputDir, fs.constants.W_OK);\n    } catch (err) {\n      throw new Error('EACCES');\n    }\n\n    // Step 1: Extract trimmed segments\n    console.log('[Export] Step 1: Extracting trimmed segments...');\n    onProgress(5);\n    const segmentPaths = [];\n    \n    for (let i = 0; i < sortedClips.length; i++) {\n      const clip = sortedClips[i];\n      const segmentPath = path.join(tempDir, `segment_${i}_${Date.now()}.mkv`);\n      tempFiles.push(segmentPath);\n      \n      console.log(`[Export] Processing clip ${i + 1}/${sortedClips.length}: ${clip.fileName}`);\n      \n      // Calculate progress range for this segment\n      const segmentStartProgress = 5 + (50 * i / sortedClips.length);\n      const segmentEndProgress = 5 + (50 * (i + 1) / sortedClips.length);\n      \n      await Promise.race([\n        extractTrimmedSegment(clip, segmentPath, targetResolution, (segmentPercent) => {\n          // Map segment progress to overall progress\n          const mappedProgress = segmentStartProgress + (segmentPercent * (segmentEndProgress - segmentStartProgress) / 100);\n          onProgress(Math.round(mappedProgress));\n        }),\n        timeout(60000) // 60 second timeout per segment\n      ]);\n      \n      segmentPaths.push(segmentPath);\n      \n      // Ensure we reach the end of this segment's progress range\n      onProgress(Math.round(segmentEndProgress));\n    }\n\n    // Step 2: Concatenate segments using filter_complex\n    console.log('[Export] Step 2: Concatenating segments...');\n    onProgress(55);\n    await Promise.race([\n      concatenateSegments(segmentPaths, outputPath, (percent) => {\n        // Map 0-100% to 55-90% (35% range for better granularity)\n        const mappedProgress = Math.min(55 + (percent * 0.35), 90);\n        onProgress(Math.round(mappedProgress));\n      }),\n      timeout(300000) // 5 minute timeout for concatenation\n    ]);\n\n    // Step 3: Finalization\n    console.log('[Export] Step 3: Finalizing export...');\n    onProgress(90);\n    \n    // Simulate finalization work with a small delay\n    await new Promise(resolve => setTimeout(resolve, 500));\n    \n    onProgress(100);\n    console.log('[Export] ========== Export completed successfully ==========');\n    console.log('[Export] Final output:', outputPath);\n    \n    return outputPath;\n    \n  } catch (err) {\n    console.error('[Export] ========== Export FAILED ==========');\n    console.error('[Export] Error:', err.message);\n    \n    // Clean up temp files\n    cleanupTempFiles(tempFiles);\n    \n    // Map error to user-friendly message\n    const errorCode = err.message || 'EXPORT_FAILED';\n    const userMessage = ERROR_MAP[errorCode] || ERROR_MAP['EXPORT_FAILED'];\n    \n    const exportError = new Error(errorCode);\n    exportError.userMessage = userMessage;\n    throw exportError;\n    \n  } finally {\n    // Always clean up temp files\n    cleanupTempFiles(tempFiles);\n  }\n}\n\nmodule.exports = { exportTimeline };\n","/*jshint node:true*/\n'use strict';\n\nvar exec = require('child_process').exec;\nvar isWindows = require('os').platform().match(/win(32|64)/);\nvar which = require('which');\n\nvar nlRegexp = /\\r\\n|\\r|\\n/g;\nvar streamRegexp = /^\\[?(.*?)\\]?$/;\nvar filterEscapeRegexp = /[,]/;\nvar whichCache = {};\n\n/**\n * Parse progress line from ffmpeg stderr\n *\n * @param {String} line progress line\n * @return progress object\n * @private\n */\nfunction parseProgressLine(line) {\n  var progress = {};\n\n  // Remove all spaces after = and trim\n  line  = line.replace(/=\\s+/g, '=').trim();\n  var progressParts = line.split(' ');\n\n  // Split every progress part by \"=\" to get key and value\n  for(var i = 0; i < progressParts.length; i++) {\n    var progressSplit = progressParts[i].split('=', 2);\n    var key = progressSplit[0];\n    var value = progressSplit[1];\n\n    // This is not a progress line\n    if(typeof value === 'undefined')\n      return null;\n\n    progress[key] = value;\n  }\n\n  return progress;\n}\n\n\nvar utils = module.exports = {\n  isWindows: isWindows,\n  streamRegexp: streamRegexp,\n\n\n  /**\n   * Copy an object keys into another one\n   *\n   * @param {Object} source source object\n   * @param {Object} dest destination object\n   * @private\n   */\n  copy: function(source, dest) {\n    Object.keys(source).forEach(function(key) {\n      dest[key] = source[key];\n    });\n  },\n\n\n  /**\n   * Create an argument list\n   *\n   * Returns a function that adds new arguments to the list.\n   * It also has the following methods:\n   * - clear() empties the argument list\n   * - get() returns the argument list\n   * - find(arg, count) finds 'arg' in the list and return the following 'count' items, or undefined if not found\n   * - remove(arg, count) remove 'arg' in the list as well as the following 'count' items\n   *\n   * @private\n   */\n  args: function() {\n    var list = [];\n\n    // Append argument(s) to the list\n    var argfunc = function() {\n      if (arguments.length === 1 && Array.isArray(arguments[0])) {\n        list = list.concat(arguments[0]);\n      } else {\n        list = list.concat([].slice.call(arguments));\n      }\n    };\n\n    // Clear argument list\n    argfunc.clear = function() {\n      list = [];\n    };\n\n    // Return argument list\n    argfunc.get = function() {\n      return list;\n    };\n\n    // Find argument 'arg' in list, and if found, return an array of the 'count' items that follow it\n    argfunc.find = function(arg, count) {\n      var index = list.indexOf(arg);\n      if (index !== -1) {\n        return list.slice(index + 1, index + 1 + (count || 0));\n      }\n    };\n\n    // Find argument 'arg' in list, and if found, remove it as well as the 'count' items that follow it\n    argfunc.remove = function(arg, count) {\n      var index = list.indexOf(arg);\n      if (index !== -1) {\n        list.splice(index, (count || 0) + 1);\n      }\n    };\n\n    // Clone argument list\n    argfunc.clone = function() {\n      var cloned = utils.args();\n      cloned(list);\n      return cloned;\n    };\n\n    return argfunc;\n  },\n\n\n  /**\n   * Generate filter strings\n   *\n   * @param {String[]|Object[]} filters filter specifications. When using objects,\n   *   each must have the following properties:\n   * @param {String} filters.filter filter name\n   * @param {String|Array} [filters.inputs] (array of) input stream specifier(s) for the filter,\n   *   defaults to ffmpeg automatically choosing the first unused matching streams\n   * @param {String|Array} [filters.outputs] (array of) output stream specifier(s) for the filter,\n   *   defaults to ffmpeg automatically assigning the output to the output file\n   * @param {Object|String|Array} [filters.options] filter options, can be omitted to not set any options\n   * @return String[]\n   * @private\n   */\n  makeFilterStrings: function(filters) {\n    return filters.map(function(filterSpec) {\n      if (typeof filterSpec === 'string') {\n        return filterSpec;\n      }\n\n      var filterString = '';\n\n      // Filter string format is:\n      // [input1][input2]...filter[output1][output2]...\n      // The 'filter' part can optionaly have arguments:\n      //   filter=arg1:arg2:arg3\n      //   filter=arg1=v1:arg2=v2:arg3=v3\n\n      // Add inputs\n      if (Array.isArray(filterSpec.inputs)) {\n        filterString += filterSpec.inputs.map(function(streamSpec) {\n          return streamSpec.replace(streamRegexp, '[$1]');\n        }).join('');\n      } else if (typeof filterSpec.inputs === 'string') {\n        filterString += filterSpec.inputs.replace(streamRegexp, '[$1]');\n      }\n\n      // Add filter\n      filterString += filterSpec.filter;\n\n      // Add options\n      if (filterSpec.options) {\n        if (typeof filterSpec.options === 'string' || typeof filterSpec.options === 'number') {\n          // Option string\n          filterString += '=' + filterSpec.options;\n        } else if (Array.isArray(filterSpec.options)) {\n          // Option array (unnamed options)\n          filterString += '=' + filterSpec.options.map(function(option) {\n            if (typeof option === 'string' && option.match(filterEscapeRegexp)) {\n              return '\\'' + option + '\\'';\n            } else {\n              return option;\n            }\n          }).join(':');\n        } else if (Object.keys(filterSpec.options).length) {\n          // Option object (named options)\n          filterString += '=' + Object.keys(filterSpec.options).map(function(option) {\n            var value = filterSpec.options[option];\n\n            if (typeof value === 'string' && value.match(filterEscapeRegexp)) {\n              value = '\\'' + value + '\\'';\n            }\n\n            return option + '=' + value;\n          }).join(':');\n        }\n      }\n\n      // Add outputs\n      if (Array.isArray(filterSpec.outputs)) {\n        filterString += filterSpec.outputs.map(function(streamSpec) {\n          return streamSpec.replace(streamRegexp, '[$1]');\n        }).join('');\n      } else if (typeof filterSpec.outputs === 'string') {\n        filterString += filterSpec.outputs.replace(streamRegexp, '[$1]');\n      }\n\n      return filterString;\n    });\n  },\n\n\n  /**\n   * Search for an executable\n   *\n   * Uses 'which' or 'where' depending on platform\n   *\n   * @param {String} name executable name\n   * @param {Function} callback callback with signature (err, path)\n   * @private\n   */\n  which: function(name, callback) {\n    if (name in whichCache) {\n      return callback(null, whichCache[name]);\n    }\n\n    which(name, function(err, result){\n      if (err) {\n        // Treat errors as not found\n        return callback(null, whichCache[name] = '');\n      }\n      callback(null, whichCache[name] = result);\n    });\n  },\n\n\n  /**\n   * Convert a [[hh:]mm:]ss[.xxx] timemark into seconds\n   *\n   * @param {String} timemark timemark string\n   * @return Number\n   * @private\n   */\n  timemarkToSeconds: function(timemark) {\n    if (typeof timemark === 'number') {\n      return timemark;\n    }\n\n    if (timemark.indexOf(':') === -1 && timemark.indexOf('.') >= 0) {\n      return Number(timemark);\n    }\n\n    var parts = timemark.split(':');\n\n    // add seconds\n    var secs = Number(parts.pop());\n\n    if (parts.length) {\n      // add minutes\n      secs += Number(parts.pop()) * 60;\n    }\n\n    if (parts.length) {\n      // add hours\n      secs += Number(parts.pop()) * 3600;\n    }\n\n    return secs;\n  },\n\n\n  /**\n   * Extract codec data from ffmpeg stderr and emit 'codecData' event if appropriate\n   * Call it with an initially empty codec object once with each line of stderr output until it returns true\n   *\n   * @param {FfmpegCommand} command event emitter\n   * @param {String} stderrLine ffmpeg stderr output line\n   * @param {Object} codecObject object used to accumulate codec data between calls\n   * @return {Boolean} true if codec data is complete (and event was emitted), false otherwise\n   * @private\n   */\n  extractCodecData: function(command, stderrLine, codecsObject) {\n    var inputPattern = /Input #[0-9]+, ([^ ]+),/;\n    var durPattern = /Duration\\: ([^,]+)/;\n    var audioPattern = /Audio\\: (.*)/;\n    var videoPattern = /Video\\: (.*)/;\n\n    if (!('inputStack' in codecsObject)) {\n      codecsObject.inputStack = [];\n      codecsObject.inputIndex = -1;\n      codecsObject.inInput = false;\n    }\n\n    var inputStack = codecsObject.inputStack;\n    var inputIndex = codecsObject.inputIndex;\n    var inInput = codecsObject.inInput;\n\n    var format, dur, audio, video;\n\n    if (format = stderrLine.match(inputPattern)) {\n      inInput = codecsObject.inInput = true;\n      inputIndex = codecsObject.inputIndex = codecsObject.inputIndex + 1;\n\n      inputStack[inputIndex] = { format: format[1], audio: '', video: '', duration: '' };\n    } else if (inInput && (dur = stderrLine.match(durPattern))) {\n      inputStack[inputIndex].duration = dur[1];\n    } else if (inInput && (audio = stderrLine.match(audioPattern))) {\n      audio = audio[1].split(', ');\n      inputStack[inputIndex].audio = audio[0];\n      inputStack[inputIndex].audio_details = audio;\n    } else if (inInput && (video = stderrLine.match(videoPattern))) {\n      video = video[1].split(', ');\n      inputStack[inputIndex].video = video[0];\n      inputStack[inputIndex].video_details = video;\n    } else if (/Output #\\d+/.test(stderrLine)) {\n      inInput = codecsObject.inInput = false;\n    } else if (/Stream mapping:|Press (\\[q\\]|ctrl-c) to stop/.test(stderrLine)) {\n      command.emit.apply(command, ['codecData'].concat(inputStack));\n      return true;\n    }\n\n    return false;\n  },\n\n\n  /**\n   * Extract progress data from ffmpeg stderr and emit 'progress' event if appropriate\n   *\n   * @param {FfmpegCommand} command event emitter\n   * @param {String} stderrLine ffmpeg stderr data\n   * @private\n   */\n  extractProgress: function(command, stderrLine) {\n    var progress = parseProgressLine(stderrLine);\n\n    if (progress) {\n      // build progress report object\n      var ret = {\n        frames: parseInt(progress.frame, 10),\n        currentFps: parseInt(progress.fps, 10),\n        currentKbps: progress.bitrate ? parseFloat(progress.bitrate.replace('kbits/s', '')) : 0,\n        targetSize: parseInt(progress.size || progress.Lsize, 10),\n        timemark: progress.time\n      };\n\n      // calculate percent progress using duration\n      if (command._ffprobeData && command._ffprobeData.format && command._ffprobeData.format.duration) {\n        var duration = Number(command._ffprobeData.format.duration);\n        if (!isNaN(duration))\n          ret.percent = (utils.timemarkToSeconds(ret.timemark) / duration) * 100;\n      }\n      command.emit('progress', ret);\n    }\n  },\n\n\n  /**\n   * Extract error message(s) from ffmpeg stderr\n   *\n   * @param {String} stderr ffmpeg stderr data\n   * @return {String}\n   * @private\n   */\n  extractError: function(stderr) {\n    // Only return the last stderr lines that don't start with a space or a square bracket\n    return stderr.split(nlRegexp).reduce(function(messages, message) {\n      if (message.charAt(0) === ' ' || message.charAt(0) === '[') {\n        return [];\n      } else {\n        messages.push(message);\n        return messages;\n      }\n    }, []).join('\\n');\n  },\n\n\n  /**\n   * Creates a line ring buffer object with the following methods:\n   * - append(str) : appends a string or buffer\n   * - get() : returns the whole string\n   * - close() : prevents further append() calls and does a last call to callbacks\n   * - callback(cb) : calls cb for each line (incl. those already in the ring)\n   *\n   * @param {Number} maxLines maximum number of lines to store (<= 0 for unlimited)\n   */\n  linesRing: function(maxLines) {\n    var cbs = [];\n    var lines = [];\n    var current = null;\n    var closed = false\n    var max = maxLines - 1;\n\n    function emit(line) {\n      cbs.forEach(function(cb) { cb(line); });\n    }\n\n    return {\n      callback: function(cb) {\n        lines.forEach(function(l) { cb(l); });\n        cbs.push(cb);\n      },\n\n      append: function(str) {\n        if (closed) return;\n        if (str instanceof Buffer) str = '' + str;\n        if (!str || str.length === 0) return;\n\n        var newLines = str.split(nlRegexp);\n\n        if (newLines.length === 1) {\n          if (current !== null) {\n            current = current + newLines.shift();\n          } else {\n            current = newLines.shift();\n          }\n        } else {\n          if (current !== null) {\n            current = current + newLines.shift();\n            emit(current);\n            lines.push(current);\n          }\n\n          current = newLines.pop();\n\n          newLines.forEach(function(l) {\n            emit(l);\n            lines.push(l);\n          });\n\n          if (max > -1 && lines.length > max) {\n            lines.splice(0, lines.length - max);\n          }\n        }\n      },\n\n      get: function() {\n        if (current !== null) {\n          return lines.concat([current]).join('\\n');\n        } else {\n          return lines.join('\\n');\n        }\n      },\n\n      close: function() {\n        if (closed) return;\n\n        if (current !== null) {\n          emit(current);\n          lines.push(current);\n\n          if (max > -1 && lines.length > max) {\n            lines.shift();\n          }\n\n          current = null;\n        }\n\n        closed = true;\n      }\n    };\n  }\n};\n","/*jshint node:true*/\n'use strict';\n\nvar spawn = require('child_process').spawn;\nvar path = require('path');\nvar fs = require('fs');\nvar async = require('async');\nvar utils = require('./utils');\n\n/*\n *! Processor methods\n */\n\n\n/**\n * Run ffprobe asynchronously and store data in command\n *\n * @param {FfmpegCommand} command\n * @private\n */\nfunction runFfprobe(command) {\n  const inputProbeIndex = 0;\n  if (command._inputs[inputProbeIndex].isStream) {\n    // Don't probe input streams as this will consume them\n    return;\n  }\n  command.ffprobe(inputProbeIndex, function(err, data) {\n    command._ffprobeData = data;\n  });\n}\n\n\nmodule.exports = function(proto) {\n  /**\n   * Emitted just after ffmpeg has been spawned.\n   *\n   * @event FfmpegCommand#start\n   * @param {String} command ffmpeg command line\n   */\n\n  /**\n   * Emitted when ffmpeg reports progress information\n   *\n   * @event FfmpegCommand#progress\n   * @param {Object} progress progress object\n   * @param {Number} progress.frames number of frames transcoded\n   * @param {Number} progress.currentFps current processing speed in frames per second\n   * @param {Number} progress.currentKbps current output generation speed in kilobytes per second\n   * @param {Number} progress.targetSize current output file size\n   * @param {String} progress.timemark current video timemark\n   * @param {Number} [progress.percent] processing progress (may not be available depending on input)\n   */\n\n  /**\n   * Emitted when ffmpeg outputs to stderr\n   *\n   * @event FfmpegCommand#stderr\n   * @param {String} line stderr output line\n   */\n\n  /**\n   * Emitted when ffmpeg reports input codec data\n   *\n   * @event FfmpegCommand#codecData\n   * @param {Object} codecData codec data object\n   * @param {String} codecData.format input format name\n   * @param {String} codecData.audio input audio codec name\n   * @param {String} codecData.audio_details input audio codec parameters\n   * @param {String} codecData.video input video codec name\n   * @param {String} codecData.video_details input video codec parameters\n   */\n\n  /**\n   * Emitted when an error happens when preparing or running a command\n   *\n   * @event FfmpegCommand#error\n   * @param {Error} error error object, with optional properties 'inputStreamError' / 'outputStreamError' for errors on their respective streams\n   * @param {String|null} stdout ffmpeg stdout, unless outputting to a stream\n   * @param {String|null} stderr ffmpeg stderr\n   */\n\n  /**\n   * Emitted when a command finishes processing\n   *\n   * @event FfmpegCommand#end\n   * @param {Array|String|null} [filenames|stdout] generated filenames when taking screenshots, ffmpeg stdout when not outputting to a stream, null otherwise\n   * @param {String|null} stderr ffmpeg stderr\n   */\n\n\n  /**\n   * Spawn an ffmpeg process\n   *\n   * The 'options' argument may contain the following keys:\n   * - 'niceness': specify process niceness, ignored on Windows (default: 0)\n   * - `cwd`: change working directory\n   * - 'captureStdout': capture stdout and pass it to 'endCB' as its 2nd argument (default: false)\n   * - 'stdoutLines': override command limit (default: use command limit)\n   *\n   * The 'processCB' callback, if present, is called as soon as the process is created and\n   * receives a nodejs ChildProcess object.  It may not be called at all if an error happens\n   * before spawning the process.\n   *\n   * The 'endCB' callback is called either when an error occurs or when the ffmpeg process finishes.\n   *\n   * @method FfmpegCommand#_spawnFfmpeg\n   * @param {Array} args ffmpeg command line argument list\n   * @param {Object} [options] spawn options (see above)\n   * @param {Function} [processCB] callback called with process object and stdout/stderr ring buffers when process has been created\n   * @param {Function} endCB callback called with error (if applicable) and stdout/stderr ring buffers when process finished\n   * @private\n   */\n  proto._spawnFfmpeg = function(args, options, processCB, endCB) {\n    // Enable omitting options\n    if (typeof options === 'function') {\n      endCB = processCB;\n      processCB = options;\n      options = {};\n    }\n\n    // Enable omitting processCB\n    if (typeof endCB === 'undefined') {\n      endCB = processCB;\n      processCB = function() {};\n    }\n\n    var maxLines = 'stdoutLines' in options ? options.stdoutLines : this.options.stdoutLines;\n\n    // Find ffmpeg\n    this._getFfmpegPath(function(err, command) {\n      if (err) {\n        return endCB(err);\n      } else if (!command || command.length === 0) {\n        return endCB(new Error('Cannot find ffmpeg'));\n      }\n\n      // Apply niceness\n      if (options.niceness && options.niceness !== 0 && !utils.isWindows) {\n        args.unshift('-n', options.niceness, command);\n        command = 'nice';\n      }\n\n      var stdoutRing = utils.linesRing(maxLines);\n      var stdoutClosed = false;\n\n      var stderrRing = utils.linesRing(maxLines);\n      var stderrClosed = false;\n\n      // Spawn process\n      var ffmpegProc = spawn(command, args, options);\n\n      if (ffmpegProc.stderr) {\n        ffmpegProc.stderr.setEncoding('utf8');\n      }\n\n      ffmpegProc.on('error', function(err) {\n        endCB(err);\n      });\n\n      // Ensure we wait for captured streams to end before calling endCB\n      var exitError = null;\n      function handleExit(err) {\n        if (err) {\n          exitError = err;\n        }\n\n        if (processExited && (stdoutClosed || !options.captureStdout) && stderrClosed) {\n          endCB(exitError, stdoutRing, stderrRing);\n        }\n      }\n\n      // Handle process exit\n      var processExited = false;\n      ffmpegProc.on('exit', function(code, signal) {\n        processExited = true;\n\n        if (signal) {\n          handleExit(new Error('ffmpeg was killed with signal ' + signal));\n        } else if (code) {\n          handleExit(new Error('ffmpeg exited with code ' + code));\n        } else {\n          handleExit();\n        }\n      });\n\n      // Capture stdout if specified\n      if (options.captureStdout) {\n        ffmpegProc.stdout.on('data', function(data) {\n          stdoutRing.append(data);\n        });\n\n        ffmpegProc.stdout.on('close', function() {\n          stdoutRing.close();\n          stdoutClosed = true;\n          handleExit();\n        });\n      }\n\n      // Capture stderr if specified\n      ffmpegProc.stderr.on('data', function(data) {\n        stderrRing.append(data);\n      });\n\n      ffmpegProc.stderr.on('close', function() {\n        stderrRing.close();\n        stderrClosed = true;\n        handleExit();\n      });\n\n      // Call process callback\n      processCB(ffmpegProc, stdoutRing, stderrRing);\n    });\n  };\n\n\n  /**\n   * Build the argument list for an ffmpeg command\n   *\n   * @method FfmpegCommand#_getArguments\n   * @return argument list\n   * @private\n   */\n  proto._getArguments = function() {\n    var complexFilters = this._complexFilters.get();\n\n    var fileOutput = this._outputs.some(function(output) {\n      return output.isFile;\n    });\n\n    return [].concat(\n        // Inputs and input options\n        this._inputs.reduce(function(args, input) {\n          var source = (typeof input.source === 'string') ? input.source : 'pipe:0';\n\n          // For each input, add input options, then '-i <source>'\n          return args.concat(\n            input.options.get(),\n            ['-i', source]\n          );\n        }, []),\n\n        // Global options\n        this._global.get(),\n\n        // Overwrite if we have file outputs\n        fileOutput ? ['-y'] : [],\n\n        // Complex filters\n        complexFilters,\n\n        // Outputs, filters and output options\n        this._outputs.reduce(function(args, output) {\n          var sizeFilters = utils.makeFilterStrings(output.sizeFilters.get());\n          var audioFilters = output.audioFilters.get();\n          var videoFilters = output.videoFilters.get().concat(sizeFilters);\n          var outputArg;\n\n          if (!output.target) {\n            outputArg = [];\n          } else if (typeof output.target === 'string') {\n            outputArg = [output.target];\n          } else {\n            outputArg = ['pipe:1'];\n          }\n\n          return args.concat(\n            output.audio.get(),\n            audioFilters.length ? ['-filter:a', audioFilters.join(',')] : [],\n            output.video.get(),\n            videoFilters.length ? ['-filter:v', videoFilters.join(',')] : [],\n            output.options.get(),\n            outputArg\n          );\n        }, [])\n      );\n  };\n\n\n  /**\n   * Prepare execution of an ffmpeg command\n   *\n   * Checks prerequisites for the execution of the command (codec/format availability, flvtool...),\n   * then builds the argument list for ffmpeg and pass them to 'callback'.\n   *\n   * @method FfmpegCommand#_prepare\n   * @param {Function} callback callback with signature (err, args)\n   * @param {Boolean} [readMetadata=false] read metadata before processing\n   * @private\n   */\n  proto._prepare = function(callback, readMetadata) {\n    var self = this;\n\n    async.waterfall([\n      // Check codecs and formats\n      function(cb) {\n        self._checkCapabilities(cb);\n      },\n\n      // Read metadata if required\n      function(cb) {\n        if (!readMetadata) {\n          return cb();\n        }\n\n        self.ffprobe(0, function(err, data) {\n          if (!err) {\n            self._ffprobeData = data;\n          }\n\n          cb();\n        });\n      },\n\n      // Check for flvtool2/flvmeta if necessary\n      function(cb) {\n        var flvmeta = self._outputs.some(function(output) {\n          // Remove flvmeta flag on non-file output\n          if (output.flags.flvmeta && !output.isFile) {\n            self.logger.warn('Updating flv metadata is only supported for files');\n            output.flags.flvmeta = false;\n          }\n\n          return output.flags.flvmeta;\n        });\n\n        if (flvmeta) {\n          self._getFlvtoolPath(function(err) {\n            cb(err);\n          });\n        } else {\n          cb();\n        }\n      },\n\n      // Build argument list\n      function(cb) {\n        var args;\n        try {\n          args = self._getArguments();\n        } catch(e) {\n          return cb(e);\n        }\n\n        cb(null, args);\n      },\n\n      // Add \"-strict experimental\" option where needed\n      function(args, cb) {\n        self.availableEncoders(function(err, encoders) {\n          for (var i = 0; i < args.length; i++) {\n            if (args[i] === '-acodec' || args[i] === '-vcodec') {\n              i++;\n\n              if ((args[i] in encoders) && encoders[args[i]].experimental) {\n                args.splice(i + 1, 0, '-strict', 'experimental');\n                i += 2;\n              }\n            }\n          }\n\n          cb(null, args);\n        });\n      }\n    ], callback);\n\n    if (!readMetadata) {\n      // Read metadata as soon as 'progress' listeners are added\n\n      if (this.listeners('progress').length > 0) {\n        // Read metadata in parallel\n        runFfprobe(this);\n      } else {\n        // Read metadata as soon as the first 'progress' listener is added\n        this.once('newListener', function(event) {\n          if (event === 'progress') {\n            runFfprobe(this);\n          }\n        });\n      }\n    }\n  };\n\n\n  /**\n   * Run ffmpeg command\n   *\n   * @method FfmpegCommand#run\n   * @category Processing\n   * @aliases exec,execute\n   */\n  proto.exec =\n  proto.execute =\n  proto.run = function() {\n    var self = this;\n\n    // Check if at least one output is present\n    var outputPresent = this._outputs.some(function(output) {\n      return 'target' in output;\n    });\n\n    if (!outputPresent) {\n      throw new Error('No output specified');\n    }\n\n    // Get output stream if any\n    var outputStream = this._outputs.filter(function(output) {\n      return typeof output.target !== 'string';\n    })[0];\n\n    // Get input stream if any\n    var inputStream = this._inputs.filter(function(input) {\n      return typeof input.source !== 'string';\n    })[0];\n\n    // Ensure we send 'end' or 'error' only once\n    var ended = false;\n    function emitEnd(err, stdout, stderr) {\n      if (!ended) {\n        ended = true;\n\n        if (err) {\n          self.emit('error', err, stdout, stderr);\n        } else {\n          self.emit('end', stdout, stderr);\n        }\n      }\n    }\n\n    self._prepare(function(err, args) {\n      if (err) {\n        return emitEnd(err);\n      }\n\n      // Run ffmpeg\n      self._spawnFfmpeg(\n        args,\n        {\n          captureStdout: !outputStream,\n          niceness: self.options.niceness,\n          cwd: self.options.cwd,\n          windowsHide: true\n        }, \n\n        function processCB(ffmpegProc, stdoutRing, stderrRing) {\n          self.ffmpegProc = ffmpegProc;\n          self.emit('start', 'ffmpeg ' + args.join(' '));\n\n          // Pipe input stream if any\n          if (inputStream) {\n            inputStream.source.on('error', function(err) {\n              var reportingErr = new Error('Input stream error: ' + err.message);\n              reportingErr.inputStreamError = err;\n              emitEnd(reportingErr);\n              ffmpegProc.kill();\n            });\n\n            inputStream.source.resume();\n            inputStream.source.pipe(ffmpegProc.stdin);\n\n            // Set stdin error handler on ffmpeg (prevents nodejs catching the error, but\n            // ffmpeg will fail anyway, so no need to actually handle anything)\n            ffmpegProc.stdin.on('error', function() {});\n          }\n\n          // Setup timeout if requested\n          if (self.options.timeout) {\n            self.processTimer = setTimeout(function() {\n              var msg = 'process ran into a timeout (' + self.options.timeout + 's)';\n\n              emitEnd(new Error(msg), stdoutRing.get(), stderrRing.get());\n              ffmpegProc.kill();\n            }, self.options.timeout * 1000);\n          }\n\n\n          if (outputStream) {\n            // Pipe ffmpeg stdout to output stream\n            ffmpegProc.stdout.pipe(outputStream.target, outputStream.pipeopts);\n\n            // Handle output stream events\n            outputStream.target.on('close', function() {\n              self.logger.debug('Output stream closed, scheduling kill for ffmpeg process');\n\n              // Don't kill process yet, to give a chance to ffmpeg to\n              // terminate successfully first  This is necessary because\n              // under load, the process 'exit' event sometimes happens\n              // after the output stream 'close' event.\n              setTimeout(function() {\n                emitEnd(new Error('Output stream closed'));\n                ffmpegProc.kill();\n              }, 20);\n            });\n\n            outputStream.target.on('error', function(err) {\n              self.logger.debug('Output stream error, killing ffmpeg process');\n              var reportingErr = new Error('Output stream error: ' + err.message);\n              reportingErr.outputStreamError = err;\n              emitEnd(reportingErr, stdoutRing.get(), stderrRing.get());\n              ffmpegProc.kill('SIGKILL');\n            });\n          }\n\n          // Setup stderr handling\n          if (stderrRing) {\n\n            // 'stderr' event\n            if (self.listeners('stderr').length) {\n              stderrRing.callback(function(line) {\n                self.emit('stderr', line);\n              });\n            }\n\n            // 'codecData' event\n            if (self.listeners('codecData').length) {\n              var codecDataSent = false;\n              var codecObject = {};\n\n              stderrRing.callback(function(line) {\n                if (!codecDataSent)\n                  codecDataSent = utils.extractCodecData(self, line, codecObject);\n              });\n            }\n\n            // 'progress' event\n            if (self.listeners('progress').length) {\n              stderrRing.callback(function(line) {\n                utils.extractProgress(self, line);\n              });\n            }\n          }\n        },\n\n        function endCB(err, stdoutRing, stderrRing) {\n          clearTimeout(self.processTimer);\n          delete self.ffmpegProc;\n\n          if (err) {\n            if (err.message.match(/ffmpeg exited with code/)) {\n              // Add ffmpeg error message\n              err.message += ': ' + utils.extractError(stderrRing.get());\n            }\n\n            emitEnd(err, stdoutRing.get(), stderrRing.get());\n          } else {\n            // Find out which outputs need flv metadata\n            var flvmeta = self._outputs.filter(function(output) {\n              return output.flags.flvmeta;\n            });\n\n            if (flvmeta.length) {\n              self._getFlvtoolPath(function(err, flvtool) {\n                if (err) {\n                  return emitEnd(err);\n                }\n\n                async.each(\n                  flvmeta,\n                  function(output, cb) {\n                    spawn(flvtool, ['-U', output.target], {windowsHide: true})\n                      .on('error', function(err) {\n                        cb(new Error('Error running ' + flvtool + ' on ' + output.target + ': ' + err.message));\n                      })\n                      .on('exit', function(code, signal) {\n                        if (code !== 0 || signal) {\n                          cb(\n                            new Error(flvtool + ' ' +\n                              (signal ? 'received signal ' + signal\n                                      : 'exited with code ' + code)) +\n                              ' when running on ' + output.target\n                          );\n                        } else {\n                          cb();\n                        }\n                      });\n                  },\n                  function(err) {\n                    if (err) {\n                      emitEnd(err);\n                    } else {\n                      emitEnd(null, stdoutRing.get(), stderrRing.get());\n                    }\n                  }\n                );\n              });\n            } else {\n              emitEnd(null, stdoutRing.get(), stderrRing.get());\n            }\n          }\n        }\n      );\n    });\n\n    return this;\n  };\n\n\n  /**\n   * Renice current and/or future ffmpeg processes\n   *\n   * Ignored on Windows platforms.\n   *\n   * @method FfmpegCommand#renice\n   * @category Processing\n   *\n   * @param {Number} [niceness=0] niceness value between -20 (highest priority) and 20 (lowest priority)\n   * @return FfmpegCommand\n   */\n  proto.renice = function(niceness) {\n    if (!utils.isWindows) {\n      niceness = niceness || 0;\n\n      if (niceness < -20 || niceness > 20) {\n        this.logger.warn('Invalid niceness value: ' + niceness + ', must be between -20 and 20');\n      }\n\n      niceness = Math.min(20, Math.max(-20, niceness));\n      this.options.niceness = niceness;\n\n      if (this.ffmpegProc) {\n        var logger = this.logger;\n        var pid = this.ffmpegProc.pid;\n        var renice = spawn('renice', [niceness, '-p', pid], {windowsHide: true});\n\n        renice.on('error', function(err) {\n          logger.warn('could not renice process ' + pid + ': ' + err.message);\n        });\n\n        renice.on('exit', function(code, signal) {\n          if (signal) {\n            logger.warn('could not renice process ' + pid + ': renice was killed by signal ' + signal);\n          } else if (code) {\n            logger.warn('could not renice process ' + pid + ': renice exited with ' + code);\n          } else {\n            logger.info('successfully reniced process ' + pid + ' to ' + niceness + ' niceness');\n          }\n        });\n      }\n    }\n\n    return this;\n  };\n\n\n  /**\n   * Kill current ffmpeg process, if any\n   *\n   * @method FfmpegCommand#kill\n   * @category Processing\n   *\n   * @param {String} [signal=SIGKILL] signal name\n   * @return FfmpegCommand\n   */\n  proto.kill = function(signal) {\n    if (!this.ffmpegProc) {\n      this.logger.warn('No running ffmpeg process, cannot send signal');\n    } else {\n      this.ffmpegProc.kill(signal || 'SIGKILL');\n    }\n\n    return this;\n  };\n};\n","/*jshint node:true*/\n'use strict';\n\nvar utils = require('../utils');\n\n/*\n *! Input-related methods\n */\n\nmodule.exports = function(proto) {\n  /**\n   * Add an input to command\n   *\n   * Also switches \"current input\", that is the input that will be affected\n   * by subsequent input-related methods.\n   *\n   * Note: only one stream input is supported for now.\n   *\n   * @method FfmpegCommand#input\n   * @category Input\n   * @aliases mergeAdd,addInput\n   *\n   * @param {String|Readable} source input file path or readable stream\n   * @return FfmpegCommand\n   */\n  proto.mergeAdd =\n  proto.addInput =\n  proto.input = function(source) {\n    var isFile = false;\n    var isStream = false;\n\n    if (typeof source !== 'string') {\n      if (!('readable' in source) || !(source.readable)) {\n        throw new Error('Invalid input');\n      }\n\n      var hasInputStream = this._inputs.some(function(input) {\n        return input.isStream;\n      });\n\n      if (hasInputStream) {\n        throw new Error('Only one input stream is supported');\n      }\n\n      isStream = true;\n      source.pause();\n    } else {\n      var protocol = source.match(/^([a-z]{2,}):/i);\n      isFile = !protocol || protocol[0] === 'file';\n    }\n\n    this._inputs.push(this._currentInput = {\n      source: source,\n      isFile: isFile,\n      isStream: isStream,\n      options: utils.args()\n    });\n\n    return this;\n  };\n\n\n  /**\n   * Specify input format for the last specified input\n   *\n   * @method FfmpegCommand#inputFormat\n   * @category Input\n   * @aliases withInputFormat,fromFormat\n   *\n   * @param {String} format input format\n   * @return FfmpegCommand\n   */\n  proto.withInputFormat =\n  proto.inputFormat =\n  proto.fromFormat = function(format) {\n    if (!this._currentInput) {\n      throw new Error('No input specified');\n    }\n\n    this._currentInput.options('-f', format);\n    return this;\n  };\n\n\n  /**\n   * Specify input FPS for the last specified input\n   * (only valid for raw video formats)\n   *\n   * @method FfmpegCommand#inputFps\n   * @category Input\n   * @aliases withInputFps,withInputFPS,withFpsInput,withFPSInput,inputFPS,inputFps,fpsInput\n   *\n   * @param {Number} fps input FPS\n   * @return FfmpegCommand\n   */\n  proto.withInputFps =\n  proto.withInputFPS =\n  proto.withFpsInput =\n  proto.withFPSInput =\n  proto.inputFPS =\n  proto.inputFps =\n  proto.fpsInput =\n  proto.FPSInput = function(fps) {\n    if (!this._currentInput) {\n      throw new Error('No input specified');\n    }\n\n    this._currentInput.options('-r', fps);\n    return this;\n  };\n\n\n  /**\n   * Use native framerate for the last specified input\n   *\n   * @method FfmpegCommand#native\n   * @category Input\n   * @aliases nativeFramerate,withNativeFramerate\n   *\n   * @return FfmmegCommand\n   */\n  proto.nativeFramerate =\n  proto.withNativeFramerate =\n  proto.native = function() {\n    if (!this._currentInput) {\n      throw new Error('No input specified');\n    }\n\n    this._currentInput.options('-re');\n    return this;\n  };\n\n\n  /**\n   * Specify input seek time for the last specified input\n   *\n   * @method FfmpegCommand#seekInput\n   * @category Input\n   * @aliases setStartTime,seekTo\n   *\n   * @param {String|Number} seek seek time in seconds or as a '[hh:[mm:]]ss[.xxx]' string\n   * @return FfmpegCommand\n   */\n  proto.setStartTime =\n  proto.seekInput = function(seek) {\n    if (!this._currentInput) {\n      throw new Error('No input specified');\n    }\n\n    this._currentInput.options('-ss', seek);\n\n    return this;\n  };\n\n\n  /**\n   * Loop over the last specified input\n   *\n   * @method FfmpegCommand#loop\n   * @category Input\n   *\n   * @param {String|Number} [duration] loop duration in seconds or as a '[[hh:]mm:]ss[.xxx]' string\n   * @return FfmpegCommand\n   */\n  proto.loop = function(duration) {\n    if (!this._currentInput) {\n      throw new Error('No input specified');\n    }\n\n    this._currentInput.options('-loop', '1');\n\n    if (typeof duration !== 'undefined') {\n      this.duration(duration);\n    }\n\n    return this;\n  };\n};\n","module.exports = require(\"node:path\");",null,"var fs = require('fs')\nvar core\nif (process.platform === 'win32' || global.TESTING_WINDOWS) {\n  core = require('./windows.js')\n} else {\n  core = require('./mode.js')\n}\n\nmodule.exports = isexe\nisexe.sync = sync\n\nfunction isexe (path, options, cb) {\n  if (typeof options === 'function') {\n    cb = options\n    options = {}\n  }\n\n  if (!cb) {\n    if (typeof Promise !== 'function') {\n      throw new TypeError('callback not provided')\n    }\n\n    return new Promise(function (resolve, reject) {\n      isexe(path, options || {}, function (er, is) {\n        if (er) {\n          reject(er)\n        } else {\n          resolve(is)\n        }\n      })\n    })\n  }\n\n  core(path, options || {}, function (er, is) {\n    // ignore EACCES because that just means we aren't allowed to run it\n    if (er) {\n      if (er.code === 'EACCES' || options && options.ignoreErrors) {\n        er = null\n        is = false\n      }\n    }\n    cb(er, is)\n  })\n}\n\nfunction sync (path, options) {\n  // my kingdom for a filtered catch\n  try {\n    return core.sync(path, options || {})\n  } catch (er) {\n    if (options && options.ignoreErrors || er.code === 'EACCES') {\n      return false\n    } else {\n      throw er\n    }\n  }\n}\n","module.exports = isexe\nisexe.sync = sync\n\nvar fs = require('fs')\n\nfunction checkPathExt (path, options) {\n  var pathext = options.pathExt !== undefined ?\n    options.pathExt : process.env.PATHEXT\n\n  if (!pathext) {\n    return true\n  }\n\n  pathext = pathext.split(';')\n  if (pathext.indexOf('') !== -1) {\n    return true\n  }\n  for (var i = 0; i < pathext.length; i++) {\n    var p = pathext[i].toLowerCase()\n    if (p && path.substr(-p.length).toLowerCase() === p) {\n      return true\n    }\n  }\n  return false\n}\n\nfunction checkStat (stat, path, options) {\n  if (!stat.isSymbolicLink() && !stat.isFile()) {\n    return false\n  }\n  return checkPathExt(path, options)\n}\n\nfunction isexe (path, options, cb) {\n  fs.stat(path, function (er, stat) {\n    cb(er, er ? false : checkStat(stat, path, options))\n  })\n}\n\nfunction sync (path, options) {\n  return checkStat(fs.statSync(path), path, options)\n}\n","module.exports = require(\"os\");","module.exports = require(\"fs\");","module.exports = require(\"path\");","/*jshint node:true*/\n'use strict';\n\nvar fs = require('fs');\nvar path = require('path');\nvar PassThrough = require('stream').PassThrough;\nvar async = require('async');\nvar utils = require('./utils');\n\n\n/*\n * Useful recipes for commands\n */\n\nmodule.exports = function recipes(proto) {\n  /**\n   * Execute ffmpeg command and save output to a file\n   *\n   * @method FfmpegCommand#save\n   * @category Processing\n   * @aliases saveToFile\n   *\n   * @param {String} output file path\n   * @return FfmpegCommand\n   */\n  proto.saveToFile =\n  proto.save = function(output) {\n    this.output(output).run();\n    return this;\n  };\n\n\n  /**\n   * Execute ffmpeg command and save output to a stream\n   *\n   * If 'stream' is not specified, a PassThrough stream is created and returned.\n   * 'options' will be used when piping ffmpeg output to the output stream\n   * (@see http://nodejs.org/api/stream.html#stream_readable_pipe_destination_options)\n   *\n   * @method FfmpegCommand#pipe\n   * @category Processing\n   * @aliases stream,writeToStream\n   *\n   * @param {stream.Writable} [stream] output stream\n   * @param {Object} [options={}] pipe options\n   * @return Output stream\n   */\n  proto.writeToStream =\n  proto.pipe =\n  proto.stream = function(stream, options) {\n    if (stream && !('writable' in stream)) {\n      options = stream;\n      stream = undefined;\n    }\n\n    if (!stream) {\n      if (process.version.match(/v0\\.8\\./)) {\n        throw new Error('PassThrough stream is not supported on node v0.8');\n      }\n\n      stream = new PassThrough();\n    }\n\n    this.output(stream, options).run();\n    return stream;\n  };\n\n\n  /**\n   * Generate images from a video\n   *\n   * Note: this method makes the command emit a 'filenames' event with an array of\n   * the generated image filenames.\n   *\n   * @method FfmpegCommand#screenshots\n   * @category Processing\n   * @aliases takeScreenshots,thumbnail,thumbnails,screenshot\n   *\n   * @param {Number|Object} [config=1] screenshot count or configuration object with\n   *   the following keys:\n   * @param {Number} [config.count] number of screenshots to take; using this option\n   *   takes screenshots at regular intervals (eg. count=4 would take screens at 20%, 40%,\n   *   60% and 80% of the video length).\n   * @param {String} [config.folder='.'] output folder\n   * @param {String} [config.filename='tn.png'] output filename pattern, may contain the following\n   *   tokens:\n   *   - '%s': offset in seconds\n   *   - '%w': screenshot width\n   *   - '%h': screenshot height\n   *   - '%r': screenshot resolution (same as '%wx%h')\n   *   - '%f': input filename\n   *   - '%b': input basename (filename w/o extension)\n   *   - '%i': index of screenshot in timemark array (can be zero-padded by using it like `%000i`)\n   * @param {Number[]|String[]} [config.timemarks] array of timemarks to take screenshots\n   *   at; each timemark may be a number of seconds, a '[[hh:]mm:]ss[.xxx]' string or a\n   *   'XX%' string.  Overrides 'count' if present.\n   * @param {Number[]|String[]} [config.timestamps] alias for 'timemarks'\n   * @param {Boolean} [config.fastSeek] use fast seek (less accurate)\n   * @param {String} [config.size] screenshot size, with the same syntax as {@link FfmpegCommand#size}\n   * @param {String} [folder] output folder (legacy alias for 'config.folder')\n   * @return FfmpegCommand\n   */\n  proto.takeScreenshots =\n  proto.thumbnail =\n  proto.thumbnails =\n  proto.screenshot =\n  proto.screenshots = function(config, folder) {\n    var self = this;\n    var source = this._currentInput.source;\n    config = config || { count: 1 };\n\n    // Accept a number of screenshots instead of a config object\n    if (typeof config === 'number') {\n      config = {\n        count: config\n      };\n    }\n\n    // Accept a second 'folder' parameter instead of config.folder\n    if (!('folder' in config)) {\n      config.folder = folder || '.';\n    }\n\n    // Accept 'timestamps' instead of 'timemarks'\n    if ('timestamps' in config) {\n      config.timemarks = config.timestamps;\n    }\n\n    // Compute timemarks from count if not present\n    if (!('timemarks' in config)) {\n      if (!config.count) {\n        throw new Error('Cannot take screenshots: neither a count nor a timemark list are specified');\n      }\n\n      var interval = 100 / (1 + config.count);\n      config.timemarks = [];\n      for (var i = 0; i < config.count; i++) {\n        config.timemarks.push((interval * (i + 1)) + '%');\n      }\n    }\n\n    // Parse size option\n    if ('size' in config) {\n      var fixedSize = config.size.match(/^(\\d+)x(\\d+)$/);\n      var fixedWidth = config.size.match(/^(\\d+)x\\?$/);\n      var fixedHeight = config.size.match(/^\\?x(\\d+)$/);\n      var percentSize = config.size.match(/^(\\d+)%$/);\n\n      if (!fixedSize && !fixedWidth && !fixedHeight && !percentSize) {\n        throw new Error('Invalid size parameter: ' + config.size);\n      }\n    }\n\n    // Metadata helper\n    var metadata;\n    function getMetadata(cb) {\n      if (metadata) {\n        cb(null, metadata);\n      } else {\n        self.ffprobe(function(err, meta) {\n          metadata = meta;\n          cb(err, meta);\n        });\n      }\n    }\n\n    async.waterfall([\n      // Compute percent timemarks if any\n      function computeTimemarks(next) {\n        if (config.timemarks.some(function(t) { return ('' + t).match(/^[\\d.]+%$/); })) {\n          if (typeof source !== 'string') {\n            return next(new Error('Cannot compute screenshot timemarks with an input stream, please specify fixed timemarks'));\n          }\n\n          getMetadata(function(err, meta) {\n            if (err) {\n              next(err);\n            } else {\n              // Select video stream with the highest resolution\n              var vstream = meta.streams.reduce(function(biggest, stream) {\n                if (stream.codec_type === 'video' && stream.width * stream.height > biggest.width * biggest.height) {\n                  return stream;\n                } else {\n                  return biggest;\n                }\n              }, { width: 0, height: 0 });\n\n              if (vstream.width === 0) {\n                return next(new Error('No video stream in input, cannot take screenshots'));\n              }\n\n              var duration = Number(vstream.duration);\n              if (isNaN(duration)) {\n                duration = Number(meta.format.duration);\n              }\n\n              if (isNaN(duration)) {\n                return next(new Error('Could not get input duration, please specify fixed timemarks'));\n              }\n\n              config.timemarks = config.timemarks.map(function(mark) {\n                if (('' + mark).match(/^([\\d.]+)%$/)) {\n                  return duration * parseFloat(mark) / 100;\n                } else {\n                  return mark;\n                }\n              });\n\n              next();\n            }\n          });\n        } else {\n          next();\n        }\n      },\n\n      // Turn all timemarks into numbers and sort them\n      function normalizeTimemarks(next) {\n        config.timemarks = config.timemarks.map(function(mark) {\n          return utils.timemarkToSeconds(mark);\n        }).sort(function(a, b) { return a - b; });\n\n        next();\n      },\n\n      // Add '_%i' to pattern when requesting multiple screenshots and no variable token is present\n      function fixPattern(next) {\n        var pattern = config.filename || 'tn.png';\n\n        if (pattern.indexOf('.') === -1) {\n          pattern += '.png';\n        }\n\n        if (config.timemarks.length > 1 && !pattern.match(/%(s|0*i)/)) {\n          var ext = path.extname(pattern);\n          pattern = path.join(path.dirname(pattern), path.basename(pattern, ext) + '_%i' + ext);\n        }\n\n        next(null, pattern);\n      },\n\n      // Replace filename tokens (%f, %b) in pattern\n      function replaceFilenameTokens(pattern, next) {\n        if (pattern.match(/%[bf]/)) {\n          if (typeof source !== 'string') {\n            return next(new Error('Cannot replace %f or %b when using an input stream'));\n          }\n\n          pattern = pattern\n            .replace(/%f/g, path.basename(source))\n            .replace(/%b/g, path.basename(source, path.extname(source)));\n        }\n\n        next(null, pattern);\n      },\n\n      // Compute size if needed\n      function getSize(pattern, next) {\n        if (pattern.match(/%[whr]/)) {\n          if (fixedSize) {\n            return next(null, pattern, fixedSize[1], fixedSize[2]);\n          }\n\n          getMetadata(function(err, meta) {\n            if (err) {\n              return next(new Error('Could not determine video resolution to replace %w, %h or %r'));\n            }\n\n            var vstream = meta.streams.reduce(function(biggest, stream) {\n              if (stream.codec_type === 'video' && stream.width * stream.height > biggest.width * biggest.height) {\n                return stream;\n              } else {\n                return biggest;\n              }\n            }, { width: 0, height: 0 });\n\n            if (vstream.width === 0) {\n              return next(new Error('No video stream in input, cannot replace %w, %h or %r'));\n            }\n\n            var width = vstream.width;\n            var height = vstream.height;\n\n            if (fixedWidth) {\n              height = height * Number(fixedWidth[1]) / width;\n              width = Number(fixedWidth[1]);\n            } else if (fixedHeight) {\n              width = width * Number(fixedHeight[1]) / height;\n              height = Number(fixedHeight[1]);\n            } else if (percentSize) {\n              width = width * Number(percentSize[1]) / 100;\n              height = height * Number(percentSize[1]) / 100;\n            }\n\n            next(null, pattern, Math.round(width / 2) * 2, Math.round(height / 2) * 2);\n          });\n        } else {\n          next(null, pattern, -1, -1);\n        }\n      },\n\n      // Replace size tokens (%w, %h, %r) in pattern\n      function replaceSizeTokens(pattern, width, height, next) {\n        pattern = pattern\n          .replace(/%r/g, '%wx%h')\n          .replace(/%w/g, width)\n          .replace(/%h/g, height);\n\n        next(null, pattern);\n      },\n\n      // Replace variable tokens in pattern (%s, %i) and generate filename list\n      function replaceVariableTokens(pattern, next) {\n        var filenames = config.timemarks.map(function(t, i) {\n          return pattern\n            .replace(/%s/g, utils.timemarkToSeconds(t))\n            .replace(/%(0*)i/g, function(match, padding) {\n              var idx = '' + (i + 1);\n              return padding.substr(0, Math.max(0, padding.length + 1 - idx.length)) + idx;\n            });\n        });\n\n        self.emit('filenames', filenames);\n        next(null, filenames);\n      },\n\n      // Create output directory\n      function createDirectory(filenames, next) {\n        fs.exists(config.folder, function(exists) {\n          if (!exists) {\n            fs.mkdir(config.folder, function(err) {\n              if (err) {\n                next(err);\n              } else {\n                next(null, filenames);\n              }\n            });\n          } else {\n            next(null, filenames);\n          }\n        });\n      }\n    ], function runCommand(err, filenames) {\n      if (err) {\n        return self.emit('error', err);\n      }\n\n      var count = config.timemarks.length;\n      var split;\n      var filters = [split = {\n        filter: 'split',\n        options: count,\n        outputs: []\n      }];\n\n      if ('size' in config) {\n        // Set size to generate size filters\n        self.size(config.size);\n\n        // Get size filters and chain them with 'sizeN' stream names\n        var sizeFilters =  self._currentOutput.sizeFilters.get().map(function(f, i) {\n          if (i > 0) {\n            f.inputs = 'size' + (i - 1);\n          }\n\n          f.outputs = 'size' + i;\n\n          return f;\n        });\n\n        // Input last size filter output into split filter\n        split.inputs = 'size' + (sizeFilters.length - 1);\n\n        // Add size filters in front of split filter\n        filters = sizeFilters.concat(filters);\n\n        // Remove size filters\n        self._currentOutput.sizeFilters.clear();\n      }\n\n      var first = 0;\n      for (var i = 0; i < count; i++) {\n        var stream = 'screen' + i;\n        split.outputs.push(stream);\n\n        if (i === 0) {\n          first = config.timemarks[i];\n          self.seekInput(first);\n        }\n\n        self.output(path.join(config.folder, filenames[i]))\n          .frames(1)\n          .map(stream);\n\n        if (i > 0) {\n          self.seek(config.timemarks[i] - first);\n        }\n      }\n\n      self.complexFilter(filters);\n      self.run();\n    });\n\n    return this;\n  };\n\n\n  /**\n   * Merge (concatenate) inputs to a single file\n   *\n   * @method FfmpegCommand#concat\n   * @category Processing\n   * @aliases concatenate,mergeToFile\n   *\n   * @param {String|Writable} target output file or writable stream\n   * @param {Object} [options] pipe options (only used when outputting to a writable stream)\n   * @return FfmpegCommand\n   */\n  proto.mergeToFile =\n  proto.concatenate =\n  proto.concat = function(target, options) {\n    // Find out which streams are present in the first non-stream input\n    var fileInput = this._inputs.filter(function(input) {\n      return !input.isStream;\n    })[0];\n\n    var self = this;\n    this.ffprobe(this._inputs.indexOf(fileInput), function(err, data) {\n      if (err) {\n        return self.emit('error', err);\n      }\n\n      var hasAudioStreams = data.streams.some(function(stream) {\n        return stream.codec_type === 'audio';\n      });\n\n      var hasVideoStreams = data.streams.some(function(stream) {\n        return stream.codec_type === 'video';\n      });\n\n      // Setup concat filter and start processing\n      self.output(target, options)\n        .complexFilter({\n          filter: 'concat',\n          options: {\n            n: self._inputs.length,\n            v: hasVideoStreams ? 1 : 0,\n            a: hasAudioStreams ? 1 : 0\n          }\n        })\n        .run();\n    });\n\n    return this;\n  };\n};\n","/*jshint node:true*/\n'use strict';\n\nvar utils = require('../utils');\n\n\n/*\n *! Audio-related methods\n */\n\nmodule.exports = function(proto) {\n  /**\n   * Disable audio in the output\n   *\n   * @method FfmpegCommand#noAudio\n   * @category Audio\n   * @aliases withNoAudio\n   * @return FfmpegCommand\n   */\n  proto.withNoAudio =\n  proto.noAudio = function() {\n    this._currentOutput.audio.clear();\n    this._currentOutput.audioFilters.clear();\n    this._currentOutput.audio('-an');\n\n    return this;\n  };\n\n\n  /**\n   * Specify audio codec\n   *\n   * @method FfmpegCommand#audioCodec\n   * @category Audio\n   * @aliases withAudioCodec\n   *\n   * @param {String} codec audio codec name\n   * @return FfmpegCommand\n   */\n  proto.withAudioCodec =\n  proto.audioCodec = function(codec) {\n    this._currentOutput.audio('-acodec', codec);\n\n    return this;\n  };\n\n\n  /**\n   * Specify audio bitrate\n   *\n   * @method FfmpegCommand#audioBitrate\n   * @category Audio\n   * @aliases withAudioBitrate\n   *\n   * @param {String|Number} bitrate audio bitrate in kbps (with an optional 'k' suffix)\n   * @return FfmpegCommand\n   */\n  proto.withAudioBitrate =\n  proto.audioBitrate = function(bitrate) {\n    this._currentOutput.audio('-b:a', ('' + bitrate).replace(/k?$/, 'k'));\n    return this;\n  };\n\n\n  /**\n   * Specify audio channel count\n   *\n   * @method FfmpegCommand#audioChannels\n   * @category Audio\n   * @aliases withAudioChannels\n   *\n   * @param {Number} channels channel count\n   * @return FfmpegCommand\n   */\n  proto.withAudioChannels =\n  proto.audioChannels = function(channels) {\n    this._currentOutput.audio('-ac', channels);\n    return this;\n  };\n\n\n  /**\n   * Specify audio frequency\n   *\n   * @method FfmpegCommand#audioFrequency\n   * @category Audio\n   * @aliases withAudioFrequency\n   *\n   * @param {Number} freq audio frequency in Hz\n   * @return FfmpegCommand\n   */\n  proto.withAudioFrequency =\n  proto.audioFrequency = function(freq) {\n    this._currentOutput.audio('-ar', freq);\n    return this;\n  };\n\n\n  /**\n   * Specify audio quality\n   *\n   * @method FfmpegCommand#audioQuality\n   * @category Audio\n   * @aliases withAudioQuality\n   *\n   * @param {Number} quality audio quality factor\n   * @return FfmpegCommand\n   */\n  proto.withAudioQuality =\n  proto.audioQuality = function(quality) {\n    this._currentOutput.audio('-aq', quality);\n    return this;\n  };\n\n\n  /**\n   * Specify custom audio filter(s)\n   *\n   * Can be called both with one or many filters, or a filter array.\n   *\n   * @example\n   * command.audioFilters('filter1');\n   *\n   * @example\n   * command.audioFilters('filter1', 'filter2=param1=value1:param2=value2');\n   *\n   * @example\n   * command.audioFilters(['filter1', 'filter2']);\n   *\n   * @example\n   * command.audioFilters([\n   *   {\n   *     filter: 'filter1'\n   *   },\n   *   {\n   *     filter: 'filter2',\n   *     options: 'param=value:param=value'\n   *   }\n   * ]);\n   *\n   * @example\n   * command.audioFilters(\n   *   {\n   *     filter: 'filter1',\n   *     options: ['value1', 'value2']\n   *   },\n   *   {\n   *     filter: 'filter2',\n   *     options: { param1: 'value1', param2: 'value2' }\n   *   }\n   * );\n   *\n   * @method FfmpegCommand#audioFilters\n   * @aliases withAudioFilter,withAudioFilters,audioFilter\n   * @category Audio\n   *\n   * @param {...String|String[]|Object[]} filters audio filter strings, string array or\n   *   filter specification array, each with the following properties:\n   * @param {String} filters.filter filter name\n   * @param {String|String[]|Object} [filters.options] filter option string, array, or object\n   * @return FfmpegCommand\n   */\n  proto.withAudioFilter =\n  proto.withAudioFilters =\n  proto.audioFilter =\n  proto.audioFilters = function(filters) {\n    if (arguments.length > 1) {\n      filters = [].slice.call(arguments);\n    }\n\n    if (!Array.isArray(filters)) {\n      filters = [filters];\n    }\n\n    this._currentOutput.audioFilters(utils.makeFilterStrings(filters));\n    return this;\n  };\n};\n","var path = require('path');\nvar spawn = require('child_process').spawn;\nvar debug = require('debug')('electron-squirrel-startup');\nvar app = require('electron').app;\n\nvar run = function(args, done) {\n  var updateExe = path.resolve(path.dirname(process.execPath), '..', 'Update.exe');\n  debug('Spawning `%s` with args `%s`', updateExe, args);\n  spawn(updateExe, args, {\n    detached: true\n  }).on('close', done);\n};\n\nvar check = function() {\n  if (process.platform === 'win32') {\n    var cmd = process.argv[1];\n    debug('processing squirrel command `%s`', cmd);\n    var target = path.basename(process.execPath);\n\n    if (cmd === '--squirrel-install' || cmd === '--squirrel-updated') {\n      run(['--createShortcut=' + target + ''], app.quit);\n      return true;\n    }\n    if (cmd === '--squirrel-uninstall') {\n      run(['--removeShortcut=' + target + ''], app.quit);\n      return true;\n    }\n    if (cmd === '--squirrel-obsolete') {\n      app.quit();\n      return true;\n    }\n  }\n  return false;\n};\n\nmodule.exports = check();\n","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","\nif (typeof __webpack_require__ !== 'undefined') __webpack_require__.ab = __dirname + \"/native_modules/\";","const { app, BrowserWindow, ipcMain, dialog, session, protocol } = require('electron');\nconst fs = require('node:fs');\nconst path = require('node:path');\n\n// Handle creating/removing shortcuts on Windows when installing/uninstalling.\nif (require('electron-squirrel-startup')) {\n  app.quit();\n}\n\nlet mainWindow;\n\n// Register custom protocol before app is ready\nprotocol.registerSchemesAsPrivileged([\n  {\n    scheme: 'local-media',\n    privileges: {\n      standard: true,\n      secure: true,\n      stream: true,\n      supportFetchAPI: true,\n      corsEnabled: true,\n    },\n  },\n]);\n\nconst createWindow = () => {\n  // Create the browser window.\n  mainWindow = new BrowserWindow({\n    width: 1400,\n    height: 900,\n    minWidth: 1000,\n    minHeight: 600,\n    webPreferences: {\n      preload: MAIN_WINDOW_PRELOAD_WEBPACK_ENTRY,\n      contextIsolation: true,\n      nodeIntegration: false,\n    },\n  });\n\n  // Configure CSP to allow loading local media files\n  session.defaultSession.webRequest.onHeadersReceived((details, callback) => {\n    const headers = { ...details.responseHeaders };\n    // Remove any existing CSP header regardless of case to avoid duplicates\n    for (const key of Object.keys(headers)) {\n      if (key.toLowerCase() === 'content-security-policy') {\n        delete headers[key];\n      }\n    }\n    const csp = \"default-src 'self' 'unsafe-inline' data:; \" +\n      \"media-src 'self' local-media: file: data: blob:; \" +\n      \"img-src 'self' local-media: file: data: blob:; \" +\n      \"script-src 'self' 'unsafe-inline' 'unsafe-eval'; \" +\n      \"style-src 'self' 'unsafe-inline';\";\n    headers['Content-Security-Policy'] = [csp];\n    if (details.resourceType === 'mainFrame') {\n      console.log('[CSP] Applied CSP to mainFrame:', csp);\n    }\n    callback({ responseHeaders: headers });\n  });\n\n  // and load the index.html of the app.\n  mainWindow.loadURL(MAIN_WINDOW_WEBPACK_ENTRY);\n\n  // Open the DevTools.\n  mainWindow.webContents.openDevTools();\n\n  mainWindow.on('closed', () => {\n    mainWindow = null;\n  });\n};\n\n// Import fileManager and mediaProcessor\nconst fileManager = require('../electron/fileManager');\nconst mediaProcessor = require('../electron/mediaProcessor');\n\n// Register IPC handlers\nipcMain.handle('read-metadata', async (event, filePath) => {\n  try {\n    console.log('[IPC] read-metadata request received for:', filePath);\n    const metadata = await fileManager.getMetadata(filePath);\n    console.log('[IPC] Metadata extracted successfully, returning to renderer');\n    return { success: true, data: metadata };\n  } catch (err) {\n    console.error('[IPC] Error reading metadata:', {\n      errorType: err.message,\n      userMessage: err.userMessage,\n      filePath\n    });\n    \n    // Return error info to renderer instead of throwing\n    // This gives the UI more control over error handling\n    return {\n      success: false,\n      error: {\n        type: err.message || 'UNKNOWN_ERROR',\n        message: err.userMessage || 'Failed to read video file',\n        details: err.details || err.message\n      }\n    };\n  }\n});\n\nipcMain.handle('select-file', async (event) => {\n  const result = await dialog.showOpenDialog(mainWindow, {\n    properties: ['openFile', 'multiSelections'],\n    filters: [\n      { name: 'Videos', extensions: ['mp4', 'mov', 'webm'] },\n      { name: 'All Files', extensions: ['*'] },\n    ],\n  });\n\n  if (result.canceled) {\n    return [];\n  } else {\n    return result.filePaths;\n  }\n});\n\nipcMain.handle('export-timeline', async (event, { clips, outputPath }) => {\n  try {\n    console.log('[IPC] export-timeline request received', {\n      clipsCount: clips.length,\n      outputPath\n    });\n    \n    await mediaProcessor.exportTimeline(clips, outputPath, (progress) => {\n      // Send progress updates to renderer\n      mainWindow.webContents.send('export-progress', progress);\n    });\n    \n    console.log('[IPC] Export completed successfully');\n    return { success: true, outputPath };\n  } catch (err) {\n    console.error('[IPC] Export failed:', {\n      errorType: err.message,\n      userMessage: err.userMessage,\n      outputPath\n    });\n    \n    // Return error info to renderer instead of throwing\n    return {\n      success: false,\n      error: {\n        type: err.message || 'EXPORT_FAILED',\n        message: err.userMessage || 'Export failed',\n        details: err.details || err.message\n      }\n    };\n  }\n});\n\nipcMain.handle('select-save-location', async () => {\n  try {\n    const result = await dialog.showSaveDialog(mainWindow, {\n      title: 'Save Video As',\n      defaultPath: 'ClipForge_Export.mp4',\n      filters: [\n        { name: 'MP4 Video', extensions: ['mp4'] },\n        { name: 'All Files', extensions: ['*'] },\n      ],\n    });\n\n    if (result.canceled) {\n      return { canceled: true };\n    }\n\n    return { canceled: false, filePath: result.filePath };\n  } catch (err) {\n    console.error('[IPC] Save dialog error:', err);\n    return { canceled: true, error: err.message };\n  }\n});\n\n// This method will be called when Electron has finished\n// initialization and is ready to create browser windows.\n// Some APIs can only be used after this event occurs.\napp.whenReady().then(() => {\n  // Register handler for local-media:// protocol\n  try {\n    protocol.registerFileProtocol('local-media', (request, callback) => {\n      const url = request.url || '';\n      const filePath = decodeURIComponent(url.replace('local-media://', ''));\n      const exists = fs.existsSync(filePath);\n      console.log('[Protocol][local-media] Request', { url, filePath, exists });\n      if (!exists) {\n        console.error('[Protocol][local-media] File does not exist', filePath);\n      }\n      callback({ path: filePath });\n    });\n    console.log('[Protocol][local-media] Protocol registered');\n  } catch (e) {\n    console.error('[Protocol][local-media] Registration failed', e);\n  }\n\n  // Test FFmpeg availability\n  try {\n    const ffmpeg = require('fluent-ffmpeg');\n    const { getFFmpegPath, getFFprobePath } = require('../electron/utils/ffmpegPath');\n    \n    const ffmpegPath = getFFmpegPath();\n    const ffprobePath = getFFprobePath();\n\n    console.log('[FFmpeg] Resolved binary paths', { ffmpegPath, ffprobePath });\n\n    ffmpeg.setFfmpegPath(ffmpegPath);\n    ffmpeg.setFfprobePath(ffprobePath);\n    \n    console.log('[FFmpeg] Paths configured successfully');\n    \n    // Quick test\n    ffmpeg.getAvailableFormats((err, formats) => {\n      if (err) {\n        console.error('[FFmpeg] Availability check failed', {\n          message: err.message,\n          code: err.code,\n          errno: err.errno,\n          path: err.path,\n          spawnargs: err.spawnargs\n        });\n\n        return;\n      }\n\n      const totalFormats = Object.keys(formats).length;\n      const sample = Object.keys(formats).slice(0, 5);\n\n      console.log('[FFmpeg] Formats available', totalFormats);\n      console.debug('[FFmpeg] Sample formats', sample);\n    });\n  } catch (err) {\n    console.error('[FFmpeg] Setup failed', {\n      message: err.message,\n      stack: err.stack,\n      code: err.code\n    });\n  }\n\n  createWindow();\n\n  // On OS X it's common to re-create a window in the app when the\n  // dock icon is clicked and there are no other windows open.\n  app.on('activate', () => {\n    if (BrowserWindow.getAllWindows().length === 0) {\n      createWindow();\n    }\n  });\n});\n\n// Quit when all windows are closed, except on macOS. There, it's common\n// for applications and their menu bar to stay active until the user quits\n// explicitly with Cmd + Q.\napp.on('window-all-closed', () => {\n  if (process.platform !== 'darwin') {\n    app.quit();\n  }\n});\n\n// In this file you can include the rest of your app's specific main process\n// code. You can also put them in separate files and import them here.\n"],"names":["utils","module","exports","proto","addOutput","output","target","pipeopts","isFile","this","_currentOutput","Error","protocol","match","_outputs","some","push","flags","self","forEach","key","args","seekOutput","seek","options","withDuration","setDuration","duration","toFormat","withOutputFormat","outputFormat","format","map","spec","replace","streamRegexp","updateFlvMetadata","flvmeta","require","process","type","addInputOption","addInputOptions","withInputOption","withInputOptions","inputOption","inputOptions","_currentInput","doSplit","arguments","length","slice","call","Array","isArray","reduce","option","split","String","addOutputOption","addOutputOptions","addOption","addOptions","withOutputOption","withOutputOptions","withOption","withOptions","outputOption","outputOptions","filterGraph","complexFilter","_complexFilters","clear","makeFilterStrings","join","streamSpec","path","arch","platform","fs","ensureExecutable","binaryPath","label","accessSync","constants","X_OK","err","code","chmodSync","console","info","chmodErr","warn","getFfmpegBinaryPath","resourcesPath","log","getFfprobeBinaryPath","getScalePadFilters","width","height","aspect","color","filter","w","h","x","y","createSizeFilters","value","data","sizeData","fixedSize","size","fixedWidth","fixedHeight","percentRatio","ratio","Number","Math","round","pad","keepPixelAspect","keepDisplayAspect","keepDisplayAspectRatio","keepDAR","videoFilters","withSize","setSize","filters","sizeFilters","withAspect","withAspectRatio","setAspect","setAspectRatio","aspectRatio","a","isNaN","applyAutopadding","applyAutoPadding","applyAutopad","applyAutoPad","withAutopadding","withAutoPadding","withAutopad","withAutoPad","autoPad","autopad","tty","util","init","debug","inspectOpts","keys","Object","i","stream","write","apply","formatArgs","name","namespace","useColors","c","prefix","humanize","diff","Date","toUTCString","save","namespaces","env","DEBUG","load","Boolean","colors","isatty","fd","test","obj","prop","substring","toLowerCase","_","k","toUpperCase","val","parseInt","DEBUG_FD","deprecate","stdout","stderr","binding","guessHandleType","WriteStream","_type","_handle","unref","SyncWriteStream","autoClose","Socket","readable","writable","read","_isStdio","createWritableStdioStream","formatters","o","v","inspect","str","trim","O","enable","r","storage","e","Function","prototype","splice","index","lastC","removeItem","window","document","documentElement","style","WebkitAppearance","firebug","exception","table","navigator","userAgent","RegExp","$1","chrome","local","localStorage","localstorage","j","JSON","stringify","message","s","m","d","plural","ms","n","floor","ceil","exec","parseFloat","parse","long","fmtShort","prevTime","createDebug","enabled","curr","prev","coerce","unshift","formatter","bind","hash","charCodeAt","abs","selectColor","stack","disable","names","skips","len","substr","root","previous_async","async","only_once","fn","called","noConflict","_each","arr","iterator","_map","results","_keys","hasOwnProperty","nextTick","setImmediate","setTimeout","each","callback","completed","eachSeries","iterate","forEachSeries","eachLimit","limit","_eachLimit","forEachLimit","started","running","replenish","doParallel","concat","doSeries","_asyncMap","eachfn","mapSeries","mapLimit","_mapLimit","doParallelLimit","memo","inject","foldl","reduceRight","reversed","reverse","foldr","_filter","sort","b","filterSeries","select","selectSeries","_reject","reject","rejectSeries","_detect","main_callback","result","detect","detectSeries","any","every","all","sortBy","criteria","left","right","auto","tasks","listeners","addListener","taskComplete","task","taskCallback","safeResults","rkey","requires","ready","listener","removeListener","waterfall","constructor","wrapIterator","next","_parallel","parallel","parallelLimit","series","makeCallback","_concat","cb","concatSeries","whilst","doWhilst","until","doUntil","queue","worker","concurrency","_insert","q","pos","item","saturated","undefined","workers","empty","drain","shift","cargo","payload","working","ts","ds","_console_fn","error","dir","memoize","hasher","queues","memoized","pop","l","unmemoized","unmemoize","times","count","counter","timesSeries","compose","fns","that","newargs","nextargs","_applyEach","go","applyEach","applyEachSeries","forever","define","amd","isexe","sync","checkStat","statSync","stat","er","mod","mode","uid","gid","myUid","getuid","myGid","getgid","u","g","checkMode","withNoVideo","noVideo","video","withVideoCodec","videoCodec","codec","withVideoBitrate","videoBitrate","bitrate","constant","withVideoFilter","withVideoFilters","videoFilter","withOutputFps","withOutputFPS","withFpsOutput","withFPSOutput","withFps","withFPS","outputFPS","outputFps","fpsOutput","FPSOutput","fps","FPS","takeFrames","withFrames","frames","which","cmd","opt","getPathInfo","pathEnv","pathExt","ext","pathExtExe","extExe","found","pathPart","charAt","p","ll","cur","ex","nothrow","getNotFoundError","isWindows","OSTYPE","COLON","colon","PATH","cwd","PATHEXT","indexOf","F","E","ii","is","spawn","legacyTag","legacyDisposition","ffprobe","input","ended","handleCallback","_inputs","_getFfprobePath","stdoutClosed","stderrClosed","src","isStream","source","windowsHide","stdin","on","pause","unpipe","pipe","exitError","handleExit","processExited","out","lines","line","streams","chapters","parseBlock","kv","chapter","parseFfprobeOutput","legacyTagKeys","tags","tagKey","legacyDispositionKeys","disposition","dispositionKey","signal","ffmpeg","os","setFfmpegPath","setFfprobePath","ERROR_TYPES","timeout","Promise","generateThumbnailAtTime","filePath","timestamp","resolve","tempPath","tmpdir","now","random","toString","cmdLine","screenshots","timestamps","filename","basename","folder","dirname","base64","readFileSync","unlinkSync","errno","spawnargs","existsSync","getMetadata","stats","toFixed","sizeBytes","modified","mtime","toISOString","created","birthtime","extension","extname","R_OK","metadataPromise","errorMsg","errorType","userMessage","includes","rawMessage","details","raw","videoStream","find","codec_type","formatName","format_name","bitRate","bit_rate","codec_name","audioStreamCount","resolution","extractMetadata","metadata","race","thumbnailPromise","reason","generateThumbnail","thumbnail","hasThumbnail","hasDetails","avCodecRegexp","ffCodecRegexp","ffEncodersRegexp","ffDecodersRegexp","encodersRegexp","formatRegexp","lineBreakRegexp","filterRegexp","cache","ffmpegPath","ffprobePath","setFlvtoolPath","flvtool","flvtoolPath","_forgetPaths","_getFfmpegPath","FFMPEG_PATH","exists","FFPROBE_PATH","_getFlvtoolPath","FLVMETA_PATH","FLVTOOL2_PATH","flvtool2","availableFilters","getAvailableFilters","_spawnFfmpeg","captureStdout","stdoutLines","stdoutRing","get","types","A","V","description","multipleInputs","multipleOutputs","availableCodecs","getAvailableCodecs","codecs","canDecode","canEncode","drawHorizBand","directRendering","weirdFrameTruncation","codecData","intraFrameOnly","isLossy","isLossless","encoders","decoders","coderData","copy","availableEncoders","getAvailableEncoders","frameMT","sliceMT","experimental","availableFormats","getAvailableFormats","formats","canDemux","canMux","_checkCapabilities","unavailable","fmts","cdcs","acodec","audio","vcodec","ERROR_MAP","extractTrimmedSegment","clip","outputPath","targetResolution","onProgress","trimDuration","trimEnd","trimStart","lastProgress","fileName","progress","percent","min","seekInput","run","concatenateSegments","segmentPaths","filterComplex","ffmpegCmd","segmentPath","cleanupTempFiles","tempFiles","exportTimeline","clips","sortedClips","order","max","tempDir","outputDir","W_OK","segmentStartProgress","segmentEndProgress","segmentPercent","mappedProgress","errorCode","exportError","nlRegexp","filterEscapeRegexp","whichCache","dest","list","argfunc","arg","remove","clone","cloned","filterSpec","filterString","inputs","outputs","timemarkToSeconds","timemark","parts","secs","extractCodecData","command","stderrLine","codecsObject","inputStack","inputIndex","inInput","dur","audio_details","video_details","emit","extractProgress","progressParts","progressSplit","parseProgressLine","ret","frame","currentFps","currentKbps","targetSize","Lsize","time","_ffprobeData","extractError","messages","linesRing","maxLines","cbs","current","closed","append","Buffer","newLines","close","runFfprobe","processCB","endCB","niceness","stderrRing","ffmpegProc","setEncoding","_getArguments","complexFilters","fileOutput","_global","outputArg","audioFilters","_prepare","readMetadata","logger","once","event","execute","outputStream","inputStream","emitEnd","reportingErr","inputStreamError","kill","resume","processTimer","msg","outputStreamError","codecDataSent","codecObject","clearTimeout","renice","pid","mergeAdd","addInput","withInputFormat","inputFormat","fromFormat","withInputFps","withInputFPS","withFpsInput","withFPSInput","inputFPS","inputFps","fpsInput","FPSInput","nativeFramerate","withNativeFramerate","native","setStartTime","loop","core","TypeError","ignoreErrors","global","TESTING_WINDOWS","isSymbolicLink","pathext","checkPathExt","PassThrough","saveToFile","writeToStream","version","takeScreenshots","thumbnails","screenshot","config","timemarks","interval","percentSize","meta","t","vstream","biggest","mark","pattern","filenames","padding","idx","mkdir","f","first","mergeToFile","concatenate","fileInput","hasAudioStreams","hasVideoStreams","withNoAudio","noAudio","withAudioCodec","audioCodec","withAudioBitrate","audioBitrate","withAudioChannels","audioChannels","channels","withAudioFrequency","audioFrequency","freq","withAudioQuality","audioQuality","quality","withAudioFilter","withAudioFilters","audioFilter","app","done","updateExe","execPath","detached","argv","quit","check","__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","__webpack_modules__","ab","__dirname","BrowserWindow","ipcMain","dialog","session","mainWindow","registerSchemesAsPrivileged","scheme","privileges","standard","secure","supportFetchAPI","corsEnabled","createWindow","minWidth","minHeight","webPreferences","preload","MAIN_WINDOW_PRELOAD_WEBPACK_ENTRY","contextIsolation","nodeIntegration","defaultSession","webRequest","onHeadersReceived","headers","responseHeaders","csp","resourceType","loadURL","MAIN_WINDOW_WEBPACK_ENTRY","webContents","openDevTools","fileManager","mediaProcessor","handle","success","showOpenDialog","properties","extensions","canceled","filePaths","clipsCount","send","showSaveDialog","title","defaultPath","whenReady","then","registerFileProtocol","request","url","decodeURIComponent","getFFmpegPath","getFFprobePath","totalFormats","sample","getAllWindows"],"sourceRoot":""}